<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yongtao&#39;s Blog</title>
  
  <subtitle>坚守 无畏 宽容 进取</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2022-06-19T02:50:10.360Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>wangyt</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CentOS 7安装Mysql5.7 (yum方式)</title>
    <link href="http://yoursite.com/2022/06/18/Linux%E4%B8%8B%E5%AE%89%E8%A3%85Mysql/"/>
    <id>http://yoursite.com/2022/06/18/Linux下安装Mysql/</id>
    <published>2022-06-18T18:40:00.000Z</published>
    <updated>2022-06-19T02:50:10.360Z</updated>
    
    <content type="html"><![CDATA[<h2 id="禁用linux防火墙-amp-seLinux"><a href="#禁用linux防火墙-amp-seLinux" class="headerlink" title="禁用linux防火墙 &amp; seLinux"></a>禁用linux防火墙 &amp; seLinux</h2><p><a href="./linux下关闭防火墙%20&amp;%20selinux.md">linux下关闭【防火墙 &amp; seLinux】</a> </p><h2 id="安装Mysql"><a href="#安装Mysql" class="headerlink" title="安装Mysql"></a>安装Mysql</h2><h3 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a>系统信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster ~]<span class="comment"># cat /etc/redhat-release </span></span><br><span class="line">CentOS Linux release 7.9.2009 (Core)</span><br><span class="line">[root@pseudo-cluster ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="查看当前系统是否已经安装Mysql"><a href="#查看当前系统是否已经安装Mysql" class="headerlink" title="查看当前系统是否已经安装Mysql"></a>查看当前系统是否已经安装Mysql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum list installed | grep mysql</span></span><br><span class="line">mysql.x86_64            5.1.73-8.el6_8  @base</span><br></pre></td></tr></table></figure><h3 id="删除自带Mysql"><a href="#删除自带Mysql" class="headerlink" title="删除自带Mysql"></a>删除自带Mysql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum -y remove mysql.x86_64</span></span><br></pre></td></tr></table></figure><h3 id="删除mariadb"><a href="#删除mariadb" class="headerlink" title="删除mariadb"></a>删除mariadb</h3><p>如果系统安装了mariadb，需要移除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum list installed |grep mariadb</span></span><br></pre></td></tr></table></figure><h3 id="查看yum库上mysql版本"><a href="#查看yum库上mysql版本" class="headerlink" title="查看yum库上mysql版本"></a>查看yum库上mysql版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum list | grep mysql</span></span><br><span class="line">mysql.x86_64                               5.1.73-8.el6_8                @base  </span><br><span class="line">mysql-devel.x86_64                         5.1.73-8.el6_8                @base  </span><br><span class="line">mysql-libs.x86_64                          5.1.73-8.el6_8                @base  </span><br><span class="line">mysql-server.x86_64                        5.1.73-8.el6_8                @base  </span><br><span class="line">...</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="yum安装Mysql"><a href="#yum安装Mysql" class="headerlink" title="yum安装Mysql"></a>yum安装Mysql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">wget https://repo.mysql.com//mysql80-community-release-el7-6.noarch.rpm</span><br><span class="line">yum localinstall yum localinstall mysql80-community-release-el7-6.noarch.rpm </span><br><span class="line">yum repolist enabled | grep <span class="string">"mysql.*-community.*"</span></span><br><span class="line">yum repolist all | grep mysql</span><br><span class="line">yum repolist enabled | grep mysql</span><br><span class="line">yum-config-manager --<span class="built_in">disable</span> mysql80-community</span><br><span class="line">yum repolist enabled | grep mysql</span><br><span class="line">yum repolist all | grep mysql</span><br><span class="line">yum-config-manager --<span class="built_in">enable</span> mysql57-community</span><br><span class="line">yum repolist all | grep mysql</span><br><span class="line">yum repolist enabled | grep mysql</span><br><span class="line">yum install mysql-community-server</span><br><span class="line">yum --enablerepo=mysql57-community clean metadata</span><br><span class="line">yum install mysql-community-server</span><br><span class="line">yum -y install mysql-community-server</span><br><span class="line">service mysqld start</span><br><span class="line">grep <span class="string">'temporary password'</span> /var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line">vim /var/<span class="built_in">log</span>/mysqld.log </span><br><span class="line">grep <span class="string">'temporary password'</span> /var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line">grep <span class="string">'password'</span> /var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line">service mysqld restart</span><br><span class="line">grep <span class="string">'password'</span> /var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line">mysql -uroot -p</span><br><span class="line">ps -elf | grep mysqld</span><br><span class="line">cat /var/run/mysqld/mysql.pid</span><br><span class="line">cat /var/run/mysqld/mysqld.pid</span><br><span class="line"><span class="built_in">cd</span> /var/lib/mysql</span><br><span class="line">mysql -uroot -p</span><br><span class="line">service mysqld status</span><br><span class="line">mysql -uroot</span><br><span class="line">mysql -uroot -p</span><br><span class="line">yum list installed | grep mysql</span><br></pre></td></tr></table></figure><h3 id="查看安装后的Mysql信息"><a href="#查看安装后的Mysql信息" class="headerlink" title="查看安装后的Mysql信息"></a>查看安装后的Mysql信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ yum list installed | grep  mysql</span><br><span class="line">Repodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast</span><br><span class="line">mysql-community-client.x86_64        5.7.38-1.el7             @mysql57-community</span><br><span class="line">mysql-community-common.x86_64        5.7.38-1.el7             @mysql57-community</span><br><span class="line">mysql-community-libs.x86_64          5.7.38-1.el7             @mysql57-community</span><br><span class="line">mysql-community-server.x86_64        5.7.38-1.el7             @mysql57-community</span><br><span class="line">mysql80-community-release.noarch     el7-6                    @/mysql80-community-release-el7-6.noarch</span><br></pre></td></tr></table></figure><h2 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h2><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">use mysql;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">update user <span class="built_in">set</span> host = <span class="string">'%'</span> <span class="built_in">where</span> user = <span class="string">'root'</span>;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">select host, user from user;</span></span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON *.* to root@'%' IDENTIFIED BY '123456' WITH GRANT OPTION;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://dev.mysql.com/doc/refman/5.7/en/linux-installation-yum-repo.html" target="_blank" rel="noopener">2.5.1 Installing MySQL on Linux Using the MySQL Yum Repository</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;禁用linux防火墙-amp-seLinux&quot;&gt;&lt;a href=&quot;#禁用linux防火墙-amp-seLinux&quot; class=&quot;headerlink&quot; title=&quot;禁用linux防火墙 &amp;amp; seLinux&quot;&gt;&lt;/a&gt;禁用linux防火墙 &amp;amp; seLinux&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;./linux下关闭防火墙%20&amp;amp;%20selinux.md&quot;&gt;linux下关闭【防火墙 &amp;amp; seLinux】&lt;/a&gt; &lt;/p&gt;
&lt;h2 id=&quot;安装Mysql&quot;&gt;&lt;a href=&quot;#安装Mysql&quot; class=&quot;headerlink&quot; title=&quot;安装Mysql&quot;&gt;&lt;/a&gt;安装Mysql&lt;/h2&gt;&lt;h3 id=&quot;系统信息&quot;&gt;&lt;a href=&quot;#系统信息&quot; class=&quot;headerlink&quot; title=&quot;系统信息&quot;&gt;&lt;/a&gt;系统信息&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster ~]&lt;span class=&quot;comment&quot;&gt;# cat /etc/redhat-release &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CentOS Linux release 7.9.2009 (Core)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster ~]&lt;span class=&quot;comment&quot;&gt;#&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;查看当前系统是否已经安装Mysql&quot;&gt;&lt;a href=&quot;#查看当前系统是否已经安装Mysql&quot; class=&quot;headerlink&quot; title=&quot;查看当前系统是否已经安装Mysql&quot;&gt;&lt;/a&gt;查看当前系统是否已经安装Mysql&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]&lt;span class=&quot;comment&quot;&gt;# yum list installed | grep mysql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql.x86_64            5.1.73-8.el6_8  @base&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;删除自带Mysql&quot;&gt;&lt;a href=&quot;#删除自带Mysql&quot; class=&quot;headerlink&quot; title=&quot;删除自带Mysql&quot;&gt;&lt;/a&gt;删除自带Mysql&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]&lt;span class=&quot;comment&quot;&gt;# yum -y remove mysql.x86_64&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;删除mariadb&quot;&gt;&lt;a href=&quot;#删除mariadb&quot; class=&quot;headerlink&quot; title=&quot;删除mariadb&quot;&gt;&lt;/a&gt;删除mariadb&lt;/h3&gt;&lt;p&gt;如果系统安装了mariadb，需要移除&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]&lt;span class=&quot;comment&quot;&gt;# yum list installed |grep mariadb&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;查看yum库上mysql版本&quot;&gt;&lt;a href=&quot;#查看yum库上mysql版本&quot; class=&quot;headerlink&quot; title=&quot;查看yum库上mysql版本&quot;&gt;&lt;/a&gt;查看yum库上mysql版本&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]&lt;span class=&quot;comment&quot;&gt;# yum list | grep mysql&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql.x86_64                               5.1.73-8.el6_8                @base  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql-devel.x86_64                         5.1.73-8.el6_8                @base  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql-libs.x86_64                          5.1.73-8.el6_8                @base  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysql-server.x86_64                        5.1.73-8.el6_8                @base  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="数据库" scheme="http://yoursite.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
      <category term="MySQL" scheme="http://yoursite.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="MySQL" scheme="http://yoursite.com/tags/MySQL/"/>
    
      <category term="数据库" scheme="http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>EFK日志收集方案简单搭建</title>
    <link href="http://yoursite.com/2022/06/12/EFK%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E6%96%B9%E6%A1%88%E7%AE%80%E5%8D%95%E6%90%AD%E5%BB%BA/"/>
    <id>http://yoursite.com/2022/06/12/EFK日志收集方案简单搭建/</id>
    <published>2022-06-12T22:18:00.000Z</published>
    <updated>2022-06-19T02:50:10.356Z</updated>
    
    <content type="html"><![CDATA[<h3 id="示例应用"><a href="#示例应用" class="headerlink" title="示例应用"></a>示例应用</h3><p>示例应用<code>app-samp-foo</code>，spring-boot项目，主要配置如下：</p><h4 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h4><p>bootstrap.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">app-samp-foo</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line"><span class="attr">  file:</span></span><br><span class="line"><span class="attr">    max-history:</span> <span class="number">7</span></span><br><span class="line"><span class="attr">  config:</span> <span class="attr">classpath:logback-spring.xml</span></span><br><span class="line"><span class="attr">  home:</span> <span class="string">/data/app/logs/$&#123;spring.application.name&#125;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>logback-spring.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;include resource="org/springframework/boot/logging/logback/base.xml"/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 避免生成spring.log --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">"org/springframework/boot/logging/logback/defaults.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">"org/springframework/boot/logging/logback/console-appender.xml"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">jmxConfigurator</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">"context"</span> <span class="attr">name</span>=<span class="string">"springAppName"</span> <span class="attr">source</span>=<span class="string">"spring.application.name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">"context"</span> <span class="attr">name</span>=<span class="string">"logPath"</span> <span class="attr">source</span>=<span class="string">"logging.home"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">"context"</span> <span class="attr">name</span>=<span class="string">"maxHistory"</span> <span class="attr">source</span>=<span class="string">"logging.file.max-history"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"infoAppender"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;logPath&#125;/$&#123;springAppName&#125;.info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;logPath&#125;/%d&#123;yyyy-MM-dd&#125;-$&#123;springAppName&#125;-%i.info.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>$&#123;maxHistory:-7&#125;<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>50MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>10GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.encoder.LayoutWrappingEncoder"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">"org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度 %msg：日志消息，%n是换行符--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 异常堆栈信息会被自动追踪打印 ref: https://logback.qos.ch/manual/layouts.html --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS,Asia/Shanghai&#125; [%tid] [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"errAppender"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;logPath&#125;/$&#123;springAppName&#125;.err.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;logPath&#125;/%d&#123;yyyy-MM-dd&#125;-$&#123;springAppName&#125;-%i.err.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>$&#123;maxHistory:-7&#125;<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>50MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>10GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.encoder.LayoutWrappingEncoder"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">"org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度 %msg：日志消息，%n是换行符--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 异常堆栈信息会被自动追踪打印 ref: https://logback.qos.ch/manual/layouts.html --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS,Asia/Shanghai&#125; [%tid] [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- add converter for %tid --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">"tid"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">converterClass</span>=<span class="string">"org.apache.skywalking.apm.toolkit.log.logback.v1.x.LogbackPatternConverter"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"infoAppenderJson"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;logPath&#125;/$&#123;springAppName&#125;.info.json<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;logPath&#125;/%d&#123;yyyy-MM-dd&#125;-$&#123;springAppName&#125;-%i.info.json<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>$&#123;maxHistory:-7&#125;<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>50MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>10GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">"net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">providers</span> <span class="attr">class</span>=<span class="string">"net.logstash.logback.composite.loggingevent.LoggingEventJsonProviders"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                        &#123;</span><br><span class="line">                        "date":"%date&#123;yyyy-MM-dd HH:mm:ss.SSS,Asia/Shanghai&#125;",</span><br><span class="line">                        "level":"%level",</span><br><span class="line">                        "tid": "%tid",</span><br><span class="line">                        "appName":"$&#123;springAppName&#125;",</span><br><span class="line">                        "thread":"%thread",</span><br><span class="line">                        "class": "%logger&#123;1.&#125;:%L",</span><br><span class="line">                        "message": "%message",</span><br><span class="line">                        "stackTrace":"%xThrowable&#123;full&#125;"</span><br><span class="line">                        &#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">providers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"errAppenderJson"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;logPath&#125;/$&#123;springAppName&#125;.err.json<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;logPath&#125;/%d&#123;yyyy-MM-dd&#125;-$&#123;springAppName&#125;-%i.err.json<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>$&#123;maxHistory:-7&#125;<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>50MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>10GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">"net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">providers</span> <span class="attr">class</span>=<span class="string">"net.logstash.logback.composite.loggingevent.LoggingEventJsonProviders"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                        &#123;</span><br><span class="line">                        "date":"%date&#123;yyyy-MM-dd HH:mm:ss.SSS,Asia/Shanghai&#125;",</span><br><span class="line">                        "level":"%level",</span><br><span class="line">                        "tid": "%tid",</span><br><span class="line">                        "appName":"$&#123;springAppName&#125;",</span><br><span class="line">                        "thread":"%thread",</span><br><span class="line">                        "class": "%logger&#123;1.&#125;:%L",</span><br><span class="line">                        "message": "%message",</span><br><span class="line">                        "stackTrace":"%xThrowable&#123;full&#125;"</span><br><span class="line">                        &#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">providers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"infoAppender"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"errAppender"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"infoAppenderJson"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"errAppenderJson"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意以上日志配置，加入了skywalking tid输出和日志增加了json格式，需要再pom中加入以下依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.skywalking<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>apm-toolkit-logback-1.x<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.logstash.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logstash-logback-encoder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Filebeat配置"><a href="#Filebeat配置" class="headerlink" title="Filebeat配置"></a>Filebeat配置</h4><p>filebeat.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">filebeat.inputs:</span></span><br><span class="line"><span class="attr">- type:</span> <span class="string">log</span></span><br><span class="line"><span class="attr">  enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="attr">    - E:</span><span class="string">\data\app\logs\*\*.info.json</span></span><br><span class="line"><span class="attr">  json:</span> <span class="comment">#解析json日志配置，用法可参考同目录下filebeat.reference.yml文件</span></span><br><span class="line"><span class="attr">    message_key:</span> <span class="string">"message"</span> <span class="comment">#java输出json格式日志中代表日志内容的字段key</span></span><br><span class="line"><span class="attr">    keys_under_root:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    overwrite_keys:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    add_error_key:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#==================== Elasticsearch template setting ==========================</span></span><br><span class="line"></span><br><span class="line"><span class="string">setup.template.settings:</span></span><br><span class="line">  <span class="string">index.number_of_shards:</span> <span class="number">3</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#================================ Processors ==================================</span></span><br><span class="line"></span><br><span class="line"><span class="attr">processors:</span></span><br><span class="line"><span class="attr">  - drop_fields:</span></span><br><span class="line"><span class="attr">      fields:</span> <span class="string">["log",</span> <span class="string">"input"</span><span class="string">,"prospector"]</span> <span class="comment"># 移除非必要字段</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#================================ Outputs =====================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------- Elasticsearch output ------------------------------</span></span><br><span class="line"><span class="string">output.elasticsearch:</span></span><br><span class="line"><span class="attr">  hosts:</span> <span class="string">["localhost:9200"]</span></span><br><span class="line"><span class="attr">  index:</span> <span class="string">"app-log-<span class="template-variable">%&#123;+yyyy.MM.dd&#125;</span>"</span> <span class="comment"># 自定义索引名称必须同时修改setup.template.name &amp; setup.template.pattern</span></span><br><span class="line"></span><br><span class="line"><span class="attr">setup:</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">"app-log"</span></span><br><span class="line"><span class="attr">    pattern:</span> <span class="string">"app-log-*"</span></span><br><span class="line"><span class="attr">    enabled:</span> <span class="literal">false</span> <span class="comment">#关掉默认的模板配置</span></span><br><span class="line"><span class="attr">    overwrite:</span> <span class="literal">true</span> <span class="comment">#开启新设置的模板</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#----------------------------- Console output ---------------------------------</span></span><br><span class="line"><span class="comment"># 控制台输出配置示例,output只能同时打开一项</span></span><br><span class="line"><span class="comment">#output.console:</span></span><br><span class="line"><span class="comment">#  enabled: true</span></span><br><span class="line"><span class="comment">#  codec.json:</span></span><br><span class="line"><span class="comment">#    pretty: false</span></span><br><span class="line"><span class="comment">#    escape_html: true</span></span><br></pre></td></tr></table></figure><p>启动es和filebeat</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 启动es</span></span></span><br><span class="line">PS D:\dev_app\elasticsearch-6.8.23\bin&gt; pwd</span><br><span class="line"></span><br><span class="line">Path</span><br><span class="line">----</span><br><span class="line">D:\dev_app\elasticsearch-6.8.23\bin</span><br><span class="line"></span><br><span class="line">PS D:\dev_app\elasticsearch-6.8.23\bin&gt; .\elasticsearch.bat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 测试配置是否ok</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./filebeat.exe <span class="built_in">test</span> config</span></span><br><span class="line">Config OK</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 启动</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./filebeat.exe -e -c ./filebeat.yml</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;示例应用&quot;&gt;&lt;a href=&quot;#示例应用&quot; class=&quot;headerlink&quot; title=&quot;示例应用&quot;&gt;&lt;/a&gt;示例应用&lt;/h3&gt;&lt;p&gt;示例应用&lt;code&gt;app-samp-foo&lt;/code&gt;，spring-boot项目，主要配置如下：&lt;/p&gt;
&lt;h4 id=&quot;日志配置&quot;&gt;&lt;a href=&quot;#日志配置&quot; class=&quot;headerlink&quot; title=&quot;日志配置&quot;&gt;&lt;/a&gt;日志配置&lt;/h4&gt;&lt;p&gt;bootstrap.yml&lt;/p&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;spring:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;  application:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;    name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;app-samp-foo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;logging:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;  file:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;    max-history:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;  config:&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;classpath:logback-spring.xml&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;  home:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;/data/app/logs/$&amp;#123;spring.application.name&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="日志收集" scheme="http://yoursite.com/categories/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/"/>
    
    
      <category term="efl" scheme="http://yoursite.com/tags/efl/"/>
    
  </entry>
  
  <entry>
    <title>Kubesphere快速搭建k8s环境</title>
    <link href="http://yoursite.com/2022/05/04/Kubesphere%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAk8s%E7%8E%AF%E5%A2%83/"/>
    <id>http://yoursite.com/2022/05/04/Kubesphere快速搭建k8s环境/</id>
    <published>2022-05-04T10:20:00.000Z</published>
    <updated>2022-05-04T10:20:00.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="准备linux机器"><a href="#准备linux机器" class="headerlink" title="准备linux机器"></a>准备linux机器</h4><p>CentOS 7.x    2 核 CPU，4 GB 内存，40 GB 磁盘空间</p><h4 id="容器运行时"><a href="#容器运行时" class="headerlink" title="容器运行时"></a>容器运行时</h4><p>Docker    19.3.8 +</p><p>提前安装好</p><h4 id="依赖项要求"><a href="#依赖项要求" class="headerlink" title="依赖项要求"></a>依赖项要求</h4><p>需要安装<code>socat</code> &amp; <code>conntrack</code></p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y socat</span><br><span class="line">yum install -y conntrack</span><br></pre></td></tr></table></figure><h4 id="网络和-DNS-要求"><a href="#网络和-DNS-要求" class="headerlink" title="网络和 DNS 要求"></a>网络和 DNS 要求</h4><ul><li>请确保 /etc/resolv.conf 中的 DNS 地址可用，否则，可能会导致集群中的 DNS 出现问题</li></ul><a id="more"></a><h4 id="下载kubekey"><a href="#下载kubekey" class="headerlink" title="下载kubekey"></a>下载kubekey</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export KKZONE=cn</span><br><span class="line">curl -sfL https://get-kk.kubesphere.io | VERSION=v2.0.0 sh -</span><br><span class="line">chmod +x kk</span><br></pre></td></tr></table></figure><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>安装等待过程可能会很慢</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"> _   __      _          _   __           </span><br><span class="line">| | / /     | |        | | / /           </span><br><span class="line">| |/ / _   _| |__   ___| |/ /  ___ _   _ </span><br><span class="line">|    \| | | | '_ \ / _ \    \ / _ \ | | |</span><br><span class="line">| |\  \ |_| | |_) |  __/ |\  \  __/ |_| |</span><br><span class="line">\_| \_/\__,_|_.__/ \___\_| \_/\___|\__, |</span><br><span class="line">                                    __/ |</span><br><span class="line">                                   |___/</span><br><span class="line"></span><br><span class="line">02:01:26 CST [NodePreCheckModule] A pre-check on nodes</span><br><span class="line">02:01:28 CST success: [localhost.localdomain]</span><br><span class="line">02:01:28 CST [ConfirmModule] Display confirmation form</span><br><span class="line">+-----------------------+------+------+---------+----------+-------+-------+-----------+--------+----------+------------+-------------+------------------+--------------+</span><br><span class="line">| name                  | sudo | curl | openssl | ebtables | socat | ipset | conntrack | chrony | docker   | nfs client | ceph client | glusterfs client | time         |</span><br><span class="line">+-----------------------+------+------+---------+----------+-------+-------+-----------+--------+----------+------------+-------------+------------------+--------------+</span><br><span class="line">| localhost.localdomain | y    | y    | y       | y        | y     | y     | y         |        | 20.10.14 |            |             |                  | CST 02:01:28 |</span><br><span class="line">+-----------------------+------+------+---------+----------+-------+-------+-----------+--------+----------+------------+-------------+------------------+--------------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 检查完ok没问题输入yes确认安装</span></span></span><br><span class="line"></span><br><span class="line">[wangyt@localhost ~]$ sudo ./kk create cluster --with-kubernetes v1.21.5 --with-kubesphere v3.2.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">Alternatively, if you are the root user, you can run:</span><br><span class="line"></span><br><span class="line">  export KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##              Welcome to KubeSphere!           ###</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################################</span></span></span><br><span class="line"></span><br><span class="line">Console: http://192.168.101.120:30880</span><br><span class="line">Account: admin</span><br><span class="line">Password: P@88w0rd</span><br><span class="line"></span><br><span class="line">NOTES：</span><br><span class="line">  1. After you log into the console, please check the</span><br><span class="line">     monitoring status of service components in</span><br><span class="line">     "Cluster Management". If any service is not</span><br><span class="line">     ready, please wait patiently until all components </span><br><span class="line">     are up and running.</span><br><span class="line">  2. Please change the default password after login.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################################</span></span></span><br><span class="line">https://kubesphere.io             2022-05-03 02:20:17</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################################</span></span></span><br><span class="line">02:20:19 CST success: [localhost.localdomain]</span><br><span class="line">02:20:19 CST Pipeline[CreateClusterPipeline] execute successful</span><br><span class="line">Installation is complete.</span><br><span class="line"></span><br><span class="line">Please check the result using the command:</span><br><span class="line"></span><br><span class="line">        kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app=ks-install -o jsonpath='&#123;.items[0].metadata.name&#125;') -f</span><br></pre></td></tr></table></figure><p>安装完成后，如果<code>kubectl</code>命令找不到，需要执行下面命令：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure><p><a href="https://kubesphere.io/zh/docs/quick-start/all-in-one-on-linux/" target="_blank" rel="noopener">在 Linux 上以 All-in-One 模式安装 KubeSphere</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;准备linux机器&quot;&gt;&lt;a href=&quot;#准备linux机器&quot; class=&quot;headerlink&quot; title=&quot;准备linux机器&quot;&gt;&lt;/a&gt;准备linux机器&lt;/h4&gt;&lt;p&gt;CentOS 7.x    2 核 CPU，4 GB 内存，40 GB 磁盘空间&lt;/p&gt;
&lt;h4 id=&quot;容器运行时&quot;&gt;&lt;a href=&quot;#容器运行时&quot; class=&quot;headerlink&quot; title=&quot;容器运行时&quot;&gt;&lt;/a&gt;容器运行时&lt;/h4&gt;&lt;p&gt;Docker    19.3.8 +&lt;/p&gt;
&lt;p&gt;提前安装好&lt;/p&gt;
&lt;h4 id=&quot;依赖项要求&quot;&gt;&lt;a href=&quot;#依赖项要求&quot; class=&quot;headerlink&quot; title=&quot;依赖项要求&quot;&gt;&lt;/a&gt;依赖项要求&lt;/h4&gt;&lt;p&gt;需要安装&lt;code&gt;socat&lt;/code&gt; &amp;amp; &lt;code&gt;conntrack&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum install -y socat&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install -y conntrack&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;网络和-DNS-要求&quot;&gt;&lt;a href=&quot;#网络和-DNS-要求&quot; class=&quot;headerlink&quot; title=&quot;网络和 DNS 要求&quot;&gt;&lt;/a&gt;网络和 DNS 要求&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;请确保 /etc/resolv.conf 中的 DNS 地址可用，否则，可能会导致集群中的 DNS 出现问题&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="kubesphere" scheme="http://yoursite.com/categories/kubesphere/"/>
    
    
      <category term="k8s" scheme="http://yoursite.com/tags/k8s/"/>
    
      <category term="kubesphere" scheme="http://yoursite.com/tags/kubesphere/"/>
    
  </entry>
  
  <entry>
    <title>Helm chart开发指南</title>
    <link href="http://yoursite.com/2022/05/02/Helm%20chart%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/"/>
    <id>http://yoursite.com/2022/05/02/Helm chart开发指南/</id>
    <published>2022-05-02T13:23:00.000Z</published>
    <updated>2022-05-02T13:23:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>参考《<a href="https://helm.sh/zh/docs/topics/charts/" target="_blank" rel="noopener">Chart开发指南</a>》</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;参考《&lt;a href=&quot;https://helm.sh/zh/docs/topics/charts/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Chart开发指南&lt;/a&gt;》&lt;/p&gt;

      
    
    </summary>
    
      <category term="helm" scheme="http://yoursite.com/categories/helm/"/>
    
    
      <category term="k8s" scheme="http://yoursite.com/tags/k8s/"/>
    
      <category term="helm" scheme="http://yoursite.com/tags/helm/"/>
    
  </entry>
  
  <entry>
    <title>Helm入门</title>
    <link href="http://yoursite.com/2022/05/02/Helm%E5%85%A5%E9%97%A8/"/>
    <id>http://yoursite.com/2022/05/02/Helm入门/</id>
    <published>2022-05-02T13:23:00.000Z</published>
    <updated>2022-05-02T13:23:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Helm是k8s的包管理器，我们可以使用Helm来安装部署应用；一个Helm包被称作Chart，存储和发布Chart的仓库叫做Repository。</p><p>Helm 3 不再使用服务端。</p><a id="more"></a><h4 id="安装Helm"><a href="#安装Helm" class="headerlink" title="安装Helm"></a>安装Helm</h4><p>选择合适的安装包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster tmp]$ wget https://get.helm.sh/helm-v3.8.2-linux-amd64.tar.gz</span><br><span class="line">--2022-05-02 21:37:09--  https://get.helm.sh/helm-v3.8.2-linux-amd64.tar.gz</span><br><span class="line">Resolving get.helm.sh (get.helm.sh)... 152.199.39.108, 2606:2800:247:1cb7:261b:1f9c:2074:3c</span><br><span class="line">Connecting to get.helm.sh (get.helm.sh)|152.199.39.108|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 13633605 (13M) [application/x-tar]</span><br><span class="line">Saving to: ‘helm-v3.8.2-linux-amd64.tar.gz’</span><br><span class="line"></span><br><span class="line">100%[==================================================================================================================================================&gt;] 13,633,605  10.5MB/s   <span class="keyword">in</span> 1.2s   </span><br><span class="line"></span><br><span class="line">2022-05-02 21:37:11 (10.5 MB/s) - ‘helm-v3.8.2-linux-amd64.tar.gz’ saved [13633605/13633605]</span><br><span class="line"></span><br><span class="line">[wangyt@pseudo-cluster tmp]$ </span><br><span class="line">[wangyt@pseudo-cluster tmp]$ tar -zxvf helm-v3.8.2-linux-amd64.tar.gz </span><br><span class="line">linux-amd64/</span><br><span class="line">linux-amd64/helm</span><br><span class="line">linux-amd64/LICENSE</span><br><span class="line">linux-amd64/README.md</span><br><span class="line">[wangyt@pseudo-cluster tmp]$ ls -lh</span><br><span class="line">drwxr-xr-x 2 wangyt wangyt   50 Apr 14 01:56 linux-amd64</span><br><span class="line">[wangyt@pseudo-cluster tmp]$ </span><br><span class="line">[wangyt@pseudo-cluster tmp]$ sudo mv linux-amd64/helm /usr/<span class="built_in">local</span>/bin/helm</span><br><span class="line">[wangyt@pseudo-cluster tmp]$ helm <span class="built_in">help</span></span><br><span class="line">The Kubernetes package manager</span><br></pre></td></tr></table></figure><h4 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 添加仓库</span></span></span><br><span class="line">[wangyt@localhost ~]$ helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">"bitnami" has been added to your repositories</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 列出仓库</span></span></span><br><span class="line">[wangyt@localhost ~]$ helm repo list</span><br><span class="line">NAME            URL                                                </span><br><span class="line">skywalking      https://apache.jfrog.io/artifactory/skywalking-helm</span><br><span class="line">bitnami         https://charts.bitnami.com/bitnami                 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 搜索仓库</span></span></span><br><span class="line">[wangyt@localhost ~]$ helm search repo bitnami</span><br><span class="line">NAME                                            CHART VERSION   APP VERSION     DESCRIPTION                                       </span><br><span class="line">bitnami/bitnami-common                          0.0.9           0.0.9           DEPRECATED Chart with custom templates used in ...</span><br><span class="line">bitnami/airflow                                 12.2.1          2.2.5           Apache Airflow is a tool to express and execute...</span><br><span class="line">bitnami/apache                                  9.0.17          2.4.53          Apache HTTP Server is an open-source HTTP serve...</span><br><span class="line">bitnami/argo-cd                                 3.1.16          2.3.3           Argo CD is a continuous delivery tool for Kuber...</span><br><span class="line">bitnami/argo-workflows                          1.1.12          3.3.4           Argo Workflows is meant to orchestrate Kubernet...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="安装Chart示例"><a href="#安装Chart示例" class="headerlink" title="安装Chart示例"></a>安装Chart示例</h4><p>以安装tomcat为示例：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 更新仓库</span></span></span><br><span class="line">[wangyt@localhost ~]$ helm repo update</span><br><span class="line">Hang tight while we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the "skywalking" chart repository</span><br><span class="line">...Successfully got an update from the "bitnami" chart repository</span><br><span class="line">Update Complete. ⎈Happy Helming!⎈</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查找tomcat chart</span></span></span><br><span class="line">[wangyt@localhost ~]$ helm search repo tomcat                      </span><br><span class="line">NAME            CHART VERSION   APP VERSION     DESCRIPTION                                       </span><br><span class="line">bitnami/tomcat  10.1.21         10.0.20         Apache Tomcat is an open-source web server desi...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看chart详情</span></span></span><br><span class="line">[wangyt@localhost ~]$ helm show chart bitnami/tomcat</span><br><span class="line">[wangyt@localhost ~]$ helm show all bitnami/tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 安装tomcat chart</span></span></span><br><span class="line">[wangyt@localhost ~]$ helm install my-tomcat bitnami/tomcat # 也可以使用`helm install bitnami/tomcat --generate-name`自动生成名字</span><br><span class="line">NAME: my-tomcat</span><br><span class="line">LAST DEPLOYED: Tue May  3 06:03:03 2022</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">CHART NAME: tomcat</span><br><span class="line">CHART VERSION: 10.1.21</span><br><span class="line">APP VERSION: 10.0.20</span><br><span class="line"></span><br><span class="line">** Please be patient while the chart is being deployed **</span><br><span class="line"></span><br><span class="line">1. Get the Tomcat URL by running:</span><br><span class="line"></span><br><span class="line">  NOTE: It may take a few minutes for the LoadBalancer IP to be available.</span><br><span class="line">        Watch the status with: 'kubectl get svc --namespace default -w my-tomcat'</span><br><span class="line"></span><br><span class="line">  export SERVICE_IP=$(kubectl get svc --namespace default my-tomcat --template "&#123;&#123; range (index .status.loadBalancer.ingress 0) &#125;&#125;&#123;&#123; . &#125;&#125;&#123;&#123; end &#125;&#125;")</span><br><span class="line">  echo "Tomcat URL:            http://$SERVICE_IP:/"</span><br><span class="line">  echo "Tomcat Management URL: http://$SERVICE_IP:/manager"</span><br><span class="line"></span><br><span class="line">2. Login with the following credentials</span><br><span class="line"></span><br><span class="line">  echo Username: user</span><br><span class="line">  echo Password: $(kubectl get secret --namespace default my-tomcat -o jsonpath="&#123;.data.tomcat-password&#125;" | base64 --decode)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 安装的chart列表</span></span></span><br><span class="line">[wangyt@localhost ~]$ helm list</span><br><span class="line">NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION</span><br><span class="line">my-tomcat       default         1               2022-05-03 06:03:03.528814348 +0800 CST deployed        tomcat-10.1.21  10.0.20</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看chart状态    </span></span></span><br><span class="line">[wangyt@localhost ~]$ helm status my-tomcat</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 卸载chart</span></span></span><br><span class="line">[wangyt@localhost ~]$ helm uninstall my-tomcat</span><br><span class="line">release "my-tomcat" uninstalled</span><br></pre></td></tr></table></figure><h4 id="快速创建自己的chart"><a href="#快速创建自己的chart" class="headerlink" title="快速创建自己的chart"></a>快速创建自己的chart</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@localhost ~]$ helm create deis-workflow</span><br><span class="line">Creating deis-workflow</span><br><span class="line">[wangyt@localhost ~]$ ls -lh</span><br><span class="line">drwxr-xr-x   4 wangyt wangyt  93 May  3 06:51 deis-workflow</span><br><span class="line">[wangyt@localhost ~]$ cd deis-workflow/</span><br><span class="line">[wangyt@localhost deis-workflow]$ ls -lh</span><br><span class="line">total 8.0K</span><br><span class="line">drwxr-xr-x 2 wangyt wangyt    6 May  3 06:51 charts</span><br><span class="line">-rw-r--r-- 1 wangyt wangyt 1.2K May  3 06:51 Chart.yaml</span><br><span class="line">drwxr-xr-x 3 wangyt wangyt  162 May  3 06:51 templates</span><br><span class="line">-rw-r--r-- 1 wangyt wangyt 1.9K May  3 06:51 values.yaml</span><br><span class="line">[wangyt@localhost ~]$ helm package deis-workflow</span><br><span class="line">Successfully packaged chart and saved it to: /home/wangyt/deis-workflow-0.1.0.tgz</span><br><span class="line">[wangyt@localhost ~]$ helm install deis-workflow ./deis-workflow-0.1.0.tgz</span><br></pre></td></tr></table></figure><p><a href="https://helm.sh/zh/docs/intro/install/" target="_blank" rel="noopener">安装Helm</a><br><a href="https://helm.sh/zh/docs/intro/quickstart/" target="_blank" rel="noopener">快速入门指南</a><br><a href="https://helm.sh/zh/docs/intro/using_helm/" target="_blank" rel="noopener">使用Helm</a><br><a href="https://helm.sh/zh/docs/topics/charts/" target="_blank" rel="noopener">Chart开发指南</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Helm是k8s的包管理器，我们可以使用Helm来安装部署应用；一个Helm包被称作Chart，存储和发布Chart的仓库叫做Repository。&lt;/p&gt;
&lt;p&gt;Helm 3 不再使用服务端。&lt;/p&gt;
    
    </summary>
    
      <category term="helm" scheme="http://yoursite.com/categories/helm/"/>
    
    
      <category term="k8s" scheme="http://yoursite.com/tags/k8s/"/>
    
      <category term="helm" scheme="http://yoursite.com/tags/helm/"/>
    
  </entry>
  
  <entry>
    <title>k8s下部署skywalking</title>
    <link href="http://yoursite.com/2022/05/01/k8s%E4%B8%8B%E9%83%A8%E7%BD%B2skywalking/"/>
    <id>http://yoursite.com/2022/05/01/k8s下部署skywalking/</id>
    <published>2022-05-01T21:14:00.000Z</published>
    <updated>2022-05-03T23:02:00.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点</h4><p>初始化环境变量</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export SKYWALKING_RELEASE_NAME=skywalking  # change the release name according to your scenario</span><br><span class="line">export SKYWALKING_RELEASE_NAMESPACE=default  # change the namespace to where you want to install SkyWalking</span><br></pre></td></tr></table></figure><p>添加skywalking helm仓库</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export REPO=skywalking</span><br><span class="line">helm repo add $&#123;REPO&#125; https://apache.jfrog.io/artifactory/skywalking-helm</span><br></pre></td></tr></table></figure><a id="more"></a><p>拉去chart包到本地</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ helm pull skywalking/skywalking</span><br><span class="line">[wangyt@pseudo-cluster ~]$ tar -zxvf skywalking-4.2.0.tgz       ## 解压</span><br><span class="line">[wangyt@pseudo-cluster ~]$ ls -lh</span><br><span class="line">drwxrwxr-x  5 wangyt wangyt 241 May  3 16:30 skywalking</span><br><span class="line">-rw-r--r--  1 wangyt wangyt 44K May  3 16:30 skywalking-4.2.0.tgz</span><br></pre></td></tr></table></figure><p>修改<code>./skywalking/values-my-es.yaml</code>，替换为自己的es集群</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">oap:</span></span><br><span class="line"><span class="attr">  image:</span></span><br><span class="line"><span class="attr">    tag:</span> <span class="number">8.8</span><span class="number">.1</span></span><br><span class="line"><span class="attr">  storageType:</span> <span class="string">elasticsearch</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ui:</span></span><br><span class="line"><span class="attr">  image:</span></span><br><span class="line"><span class="attr">    tag:</span> <span class="number">8.8</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">elasticsearch:</span></span><br><span class="line"><span class="attr">  enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  config:</span>               <span class="comment"># For users of an existing elasticsearch cluster,takes effect when `elasticsearch.enabled` is false</span></span><br><span class="line"><span class="attr">    host:</span> <span class="number">192.168</span><span class="number">.101</span><span class="number">.1</span></span><br><span class="line"><span class="attr">    port:</span></span><br><span class="line"><span class="attr">      http:</span> <span class="number">9200</span></span><br></pre></td></tr></table></figure><p>执行安装</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install "$&#123;SKYWALKING_RELEASE_NAME&#125;" $&#123;REPO&#125;/skywalking -n "$&#123;SKYWALKING_RELEASE_NAMESPACE&#125;" -f ./skywalking/values-my-es.yaml</span><br></pre></td></tr></table></figure><p>查看pod</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@localhost ~]$ kubectl get po</span><br><span class="line">NAME                              READY   STATUS      RESTARTS   AGE</span><br><span class="line">skywalking-es-init-9ttt5          0/1     Completed   0          25m</span><br><span class="line">skywalking-oap-5f4cc5c9fb-72sz4   1/1     Running     1          25m</span><br><span class="line">skywalking-oap-5f4cc5c9fb-q2f5h   1/1     Running     1          25m</span><br><span class="line">skywalking-ui-544bfb887b-cvvpf    1/1     Running     0          25m</span><br><span class="line">[wangyt@localhost ~]$</span><br></pre></td></tr></table></figure><p>查看服务</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@localhost ~]$ kubectl get svc -o wide</span><br><span class="line">NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)               AGE     SELECTOR</span><br><span class="line">kubernetes       ClusterIP   10.233.0.1      &lt;none&gt;        443/TCP               5h42m   &lt;none&gt;</span><br><span class="line">skywalking-oap   ClusterIP   10.233.24.130   &lt;none&gt;        11800/TCP,12800/TCP   25m     app=skywalking,component=oap,release=skywalking</span><br><span class="line">skywalking-ui    ClusterIP   10.233.55.146   &lt;none&gt;        80/TCP                25m     app=skywalking,component=ui,release=skywalking</span><br></pre></td></tr></table></figure><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@localhost ~]$ kubectl port-forward --address 0.0.0.0 svc/skywalking-ui 8080:80 --namespace default</span><br></pre></td></tr></table></figure><p>然后就可以使用宿主机IP访问skywalking-ui了。</p><p><a href="https://github.com/apache/skywalking-kubernetes" target="_blank" rel="noopener">skywalking-kubernetes</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;节点&quot;&gt;&lt;a href=&quot;#节点&quot; class=&quot;headerlink&quot; title=&quot;节点&quot;&gt;&lt;/a&gt;节点&lt;/h4&gt;&lt;p&gt;初始化环境变量&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;export SKYWALKING_RELEASE_NAME=skywalking  # change the release name according to your scenario&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;export SKYWALKING_RELEASE_NAMESPACE=default  # change the namespace to where you want to install SkyWalking&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;添加skywalking helm仓库&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;export REPO=skywalking&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;helm repo add $&amp;#123;REPO&amp;#125; https://apache.jfrog.io/artifactory/skywalking-helm&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="skywalking" scheme="http://yoursite.com/categories/skywalking/"/>
    
    
      <category term="k8s" scheme="http://yoursite.com/tags/k8s/"/>
    
      <category term="helm" scheme="http://yoursite.com/tags/helm/"/>
    
      <category term="skywalking" scheme="http://yoursite.com/tags/skywalking/"/>
    
  </entry>
  
  <entry>
    <title>Telegraf + Kafka + Vector + ClickHouse 指标采集实现</title>
    <link href="http://yoursite.com/2022/04/06/Telegraf%20+%20Kafka%20+%20Vector%20+%20Clickhouse%20%E6%8C%87%E6%A0%87%E9%87%87%E9%9B%86%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/2022/04/06/Telegraf + Kafka + Vector + Clickhouse 指标采集实现/</id>
    <published>2022-04-06T10:32:00.000Z</published>
    <updated>2022-06-19T02:50:10.360Z</updated>
    
    <content type="html"><![CDATA[<p>本示例在windows环境下演示，绝大部分命令和linux通用。</p><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul><li><a href="https://docs.influxdata.com/telegraf/v1.22/" target="_blank" rel="noopener">telegraf</a>：指标收集工具，可收集中间件暴露的性能指标，本文中我们以收集redis指标为例。</li><li><a href="https://kafka.apache.org/quickstart" target="_blank" rel="noopener">kafka</a>：telegraf收集上来的指标上报到kafka，用于提高系统吞吐量。</li><li><a href="https://vector.dev/docs/" target="_blank" rel="noopener">vector</a>：高性能传输管道，支持多种源和目标，本示例中用于消费kafka消息，转换后，写入到ClickHouse中。</li><li><a href="https://clickhouse.com/docs/zh/" target="_blank" rel="noopener">clickhouse</a>: 列式存储数据库，适用于OLAP分析型场景。</li><li><a href="https://superset.apache.org/docs/intro" target="_blank" rel="noopener">superset</a>：轻量级BI工具，用于快速接入各种数据源实现数据展现。</li></ul><a id="more"></a><h3 id="启动redis用于演示"><a href="#启动redis用于演示" class="headerlink" title="启动redis用于演示"></a>启动redis用于演示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\Redis-x64-3.0.504&gt; <span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line">Path</span><br><span class="line">----</span><br><span class="line">D:\dev_app\Redis-x64-3.0.504</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS D:\dev_app\Redis-x64-3.0.504&gt; .\redis-server.exe</span><br><span class="line">[10572] 06 Apr 17:10:45.476 <span class="comment"># Warning: no config file specified, using the default config. In order to specify a config file use D:\dev_app\Redis-x64-3.0.504\redis-server.exe /path/to/redis.conf</span></span><br><span class="line">                _._</span><br><span class="line">           _.-``__ <span class="string">''</span>-._</span><br><span class="line">      _.-``    `.  `_.  <span class="string">''</span>-._           Redis 3.0.504 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">''</span>-._</span><br><span class="line"> (    <span class="string">'      ,       .-`  | `,    )     Running in standalone mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|'</span>` _.-<span class="string">'|     Port: 6379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-'</span>    |     PID: 10572</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">'    _.-'</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |           http://redis.io</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span></span><br><span class="line">      `-._    `-.__.-<span class="string">'    _.-'</span></span><br><span class="line">          `-._        _.-<span class="string">'</span></span><br><span class="line"><span class="string">              `-.__.-'</span></span><br><span class="line"></span><br><span class="line">[10572] 06 Apr 17:10:45.483 <span class="comment"># Server started, Redis version 3.0.504</span></span><br><span class="line">[10572] 06 Apr 17:10:45.484 * DB loaded from disk: 0.001 seconds</span><br><span class="line">[10572] 06 Apr 17:10:45.484 * The server is now ready to accept connections on port 6379</span><br></pre></td></tr></table></figure><h3 id="telegraf"><a href="#telegraf" class="headerlink" title="telegraf"></a>telegraf</h3><p>telegraf采集redis指标，<a href="https://github.com/influxdata/telegraf/tree/master/plugins/inputs/redis" target="_blank" rel="noopener">https://github.com/influxdata/telegraf/tree/master/plugins/inputs/redis</a></p><p>可以看到主要是通过执行redis的info命令实现的</p><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[global_tags]</span><br><span class="line"></span><br><span class="line">[agent]</span><br><span class="line">  interval = &quot;10s&quot;</span><br><span class="line">  round_interval = true</span><br><span class="line">  metric_batch_size = 1000</span><br><span class="line">  metric_buffer_limit = 10000</span><br><span class="line">  collection_jitter = &quot;0s&quot;</span><br><span class="line">  flush_interval = &quot;10s&quot;</span><br><span class="line">  flush_jitter = &quot;0s&quot;</span><br><span class="line">  precision = &quot;0s&quot;</span><br><span class="line">  hostname = &quot;&quot;</span><br><span class="line">  omit_hostname = false</span><br><span class="line"></span><br><span class="line">[[inputs.redis]]</span><br><span class="line">  servers = [&quot;tcp://localhost:6379&quot;]</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>将采集的redis指标打印到控制台</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\collectors\telegraf-1.22.0&gt; .\telegraf.exe --config .\telegraf.properties --<span class="built_in">test</span> --input-filter redis</span><br><span class="line">2022-04-06T09:58:49Z I! Starting Telegraf 1.22.0</span><br><span class="line">2022-04-06T09:58:49Z I! Loaded inputs: redis</span><br><span class="line">2022-04-06T09:58:49Z I! Loaded aggregators:</span><br><span class="line">2022-04-06T09:58:49Z I! Loaded processors:</span><br><span class="line">2022-04-06T09:58:49Z W! Outputs are not used <span class="keyword">in</span> testing mode!</span><br><span class="line">2022-04-06T09:58:49Z I! Tags enabled: host=wangyt16577</span><br><span class="line">&gt; redis_cmdstat,<span class="built_in">command</span>=info,host=wangyt16577,port=6379,replication_role=master,server=localhost calls=3i,usec=248i,usec_per_call=82.67 1649239129000000000</span><br><span class="line">&gt; redis_keyspace,database=db0,host=wangyt16577,port=6379,replication_role=master,server=localhost avg_ttl=0i,expires=0i,keys=46i 1649239129000000000</span><br><span class="line">&gt; redis,host=wangyt16577,port=6379,replication_role=master,server=localhost aof_current_rewrite_time_sec=-1i,aof_enabled=0i,aof_last_bgrewrite_status=<span class="string">"ok"</span>,aof_last_rewrite_time_sec=-1i,aof_last_write_status=<span class="string">"ok"</span>,aof_rewrite_in_progress=0i,aof_rewrite_scheduled=0i,blocked_clients=0i,client_biggest_input_buf=0i,client_longest_output_list=0i,clients=1i,cluster_enabled=0i,connected_slaves=0i,evicted_keys=0i,expired_keys=0i,instantaneous_input_kbps=0,instantaneous_ops_per_sec=0i,instantaneous_output_kbps=0,keyspace_hitrate=0,keyspace_hits=0i,keyspace_misses=0i,latest_fork_usec=0i,loading=0i,lru_clock=5071960i,master_repl_offset=0i,mem_fragmentation_ratio=0.92,migrate_cached_sockets=0i,pubsub_channels=0i,pubsub_patterns=0i,rdb_bgsave_in_progress=0i,rdb_changes_since_last_save=0i,rdb_current_bgsave_time_sec=-1i,rdb_last_bgsave_status=<span class="string">"ok"</span>,rdb_last_bgsave_time_sec=-1i,rdb_last_save_time=1649236245i,rdb_last_save_time_elapsed=2884i,redis_version=<span class="string">"3.0.504"</span>,rejected_connections=0i,repl_backlog_active=0i,repl_backlog_first_byte_offset=0i,repl_backlog_histlen=0i,repl_backlog_size=1048576i,sync_full=0i,sync_partial_err=0i,sync_partial_ok=0i,total_commands_processed=3i,total_connections_received=4i,total_net_input_bytes=92i,total_net_output_bytes=5843i,uptime=2883i,used_cpu_sys=0.13,used_cpu_sys_children=0,used_cpu_user=0.08,used_cpu_user_children=0,used_memory=757248i,used_memory_lua=36864i,used_memory_peak=757248i,used_memory_rss=698688i 1649239129000000000</span><br><span class="line">PS D:\dev_app\collectors\telegraf-1.22.0&gt;</span><br></pre></td></tr></table></figure><p>注意指标的格式：</p><p><code>redis_cmdstat,command=info,host=myhost,port=6379,replication_role=master,server=localhost calls=3i,usec=248i,usec_per_call=82.67 1649239129000000000</code></p><p>分为了四部分，对等的json格式为：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"fields"</span>: &#123;</span><br><span class="line"><span class="attr">"calls"</span>: <span class="number">3</span>,</span><br><span class="line"><span class="attr">"usec"</span>: <span class="number">248</span>,</span><br><span class="line"><span class="attr">"usec_per_call"</span>: <span class="number">82.67</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"name"</span>: <span class="string">"redis_cmdstat"</span>,</span><br><span class="line"><span class="attr">"tags"</span>: &#123;</span><br><span class="line"><span class="attr">"command"</span>: <span class="string">"info"</span>,</span><br><span class="line"><span class="attr">"host"</span>: <span class="string">"myhost"</span>,</span><br><span class="line"><span class="attr">"port"</span>: <span class="string">"6379"</span>,</span><br><span class="line"><span class="attr">"replication_role"</span>: <span class="string">"master"</span>,</span><br><span class="line"><span class="attr">"server"</span>: <span class="string">"localhost"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"timestamp"</span>: <span class="number">1649239129</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="kafka"><a href="#kafka" class="headerlink" title="kafka"></a>kafka</h3><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><h5 id="启动kafka内置的zookeeper"><a href="#启动kafka内置的zookeeper" class="headerlink" title="启动kafka内置的zookeeper"></a>启动kafka内置的zookeeper</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: D:\dev_app\kafka_2.13-3.1.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">d-----         2022/1/12     17:07                bin</span><br><span class="line">d-----         2022/1/12     17:07                config</span><br><span class="line">d-----         2022/1/12     17:07                libs</span><br><span class="line">d-----         2022/1/12     17:07                licenses</span><br><span class="line">d-----          2022/4/6     18:33                logs</span><br><span class="line">d-----         2022/1/12     17:07                site-docs</span><br><span class="line">d-----         2022/3/31     16:19                tmp</span><br><span class="line">-a----         2022/1/12     17:01          14536 LICENSE</span><br><span class="line">-a----         2022/1/12     17:01          28184 NOTICE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ./bin/windows/zookeeper-server-start.bat ./config/zookeeper.properties</span><br></pre></td></tr></table></figure><h5 id="启动kafka"><a href="#启动kafka" class="headerlink" title="启动kafka"></a>启动kafka</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ./bin/windows/kafka-server-start.bat ./config/server.properties</span><br></pre></td></tr></table></figure><h5 id="创建一个topic"><a href="#创建一个topic" class="headerlink" title="创建一个topic"></a>创建一个topic</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 创建一个topic</span></span><br><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ./bin/windows/kafka-topics.bat --create --topic telegraf --bootstrap-server localhost:9092</span><br><span class="line">Created topic telegraf.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 列出所有topic</span></span><br><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ./bin/windows/kafka-topics.bat --list --bootstrap-server localhost:9092</span><br><span class="line">telegraf</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看topic详情</span></span><br><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ./bin/windows/kafka-topics.bat --describe --topic telegraf --bootstrap-server localhost:9092</span><br><span class="line">Topic: telegraf TopicId: 7rVMZCJXTSa2Gp8opDA_Uw PartitionCount: 1       ReplicationFactor: 1    Configs: segment.bytes=1073741824</span><br><span class="line">        Topic: telegraf Partition: 0    Leader: 0       Replicas: 0     Isr: 0</span><br><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt;</span><br></pre></td></tr></table></figure><h5 id="telegraf配置"><a href="#telegraf配置" class="headerlink" title="telegraf配置"></a>telegraf配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[[outputs.kafka]]</span><br><span class="line">  brokers = [&quot;localhost:9092&quot;]</span><br><span class="line">  topic = &quot;telegraf&quot;</span><br><span class="line">  data_format = &quot;json&quot;</span><br><span class="line">  json_timestamp_units = &quot;1ms&quot;</span><br></pre></td></tr></table></figure><h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><p>在本示例中，我们使用vector消费kafka中的数据，输出给clickhouse。</p><h4 id="快速上手vector"><a href="#快速上手vector" class="headerlink" title="快速上手vector"></a>快速上手vector</h4><p>先通过几个小示例感受下vector：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\collectors\vector-0.20.0&gt; <span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line">Path</span><br><span class="line">----</span><br><span class="line">D:\dev_app\collectors\vector-0.20.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS D:\dev_app\collectors\vector-0.20.0&gt; ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: D:\dev_app\collectors\vector-0.20.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">d-----         2022/3/28     16:24                bin</span><br><span class="line">d-----          2022/4/1     10:56                config</span><br><span class="line">d-----         2022/3/28     16:24                data</span><br><span class="line">-a----         2022/2/10     23:54          16811 LICENSE.txt</span><br><span class="line">-a----          2022/2/9     18:57          17760 README.md.txt</span><br></pre></td></tr></table></figure><p>config目录下增加一个配置文件myconfig.toml内容如下：<br>表示从标准输入设备接收，输出到控制台</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[sources.in]</span><br><span class="line">type = &quot;stdin&quot;</span><br><span class="line"></span><br><span class="line">[sinks.out]</span><br><span class="line">inputs = [&quot;in&quot;]</span><br><span class="line">type = &quot;console&quot;</span><br><span class="line">encoding.codec = &quot;json&quot;</span><br></pre></td></tr></table></figure><p>执行测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\collectors\vector-0.20.0&gt; <span class="built_in">echo</span> <span class="string">'Hello world!'</span> | ./bin/vector.exe --config ./config/myconfig.toml</span><br><span class="line">2022-04-06T11:13:23.093723Z  INFO vector::app: Log level is enabled. level=<span class="string">"vector=info,codec=info,vrl=info,file_source=info,tower_limit=trace,rdkafka=info,buffers=info"</span></span><br><span class="line">2022-04-06T11:13:23.095105Z  INFO vector::app: Loading configs. paths=[<span class="string">"config\\myconfig.toml"</span>]</span><br><span class="line">2022-04-06T11:13:23.100891Z  INFO vector::sources::stdin: Capturing STDIN.</span><br><span class="line">2022-04-06T11:13:23.101194Z  INFO vector::topology::running: Running healthchecks.</span><br><span class="line">2022-04-06T11:13:23.101366Z  INFO vector::topology::builder: Healthcheck: Passed.</span><br><span class="line">2022-04-06T11:13:23.101421Z  INFO vector::topology::running: Starting <span class="built_in">source</span>. key=<span class="keyword">in</span></span><br><span class="line">2022-04-06T11:13:23.101652Z  INFO vector::topology::running: Starting sink. key=out</span><br><span class="line">2022-04-06T11:13:23.101947Z  INFO vector: Vector has started. debug=<span class="string">"false"</span> version=<span class="string">"0.20.0"</span> arch=<span class="string">"x86_64"</span> build_id=<span class="string">"2a706a3 2022-02-10"</span></span><br><span class="line">2022-04-06T11:13:23.102098Z  INFO vector::app: API is disabled, <span class="built_in">enable</span> by setting `api.enabled` to `<span class="literal">true</span>` and use commands like `vector top`.</span><br><span class="line">2022-04-06T11:13:23.102138Z  INFO <span class="built_in">source</span>&#123;component_kind=<span class="string">"source"</span> component_id=<span class="keyword">in</span> component_type=stdin component_name=<span class="keyword">in</span>&#125;: vector::sources::stdin: Finished sending.</span><br><span class="line">2022-04-06T11:13:23.102229Z  INFO vector::shutdown: All sources have finished.</span><br><span class="line">2022-04-06T11:13:23.102394Z  INFO vector: Vector has stopped.</span><br><span class="line">&#123;<span class="string">"host"</span>:<span class="string">"wangyt16577"</span>,<span class="string">"message"</span>:<span class="string">"Hello world!\r"</span>,<span class="string">"source_type"</span>:<span class="string">"stdin"</span>,<span class="string">"timestamp"</span>:<span class="string">"2022-04-06T11:13:23.101995900Z"</span>&#125;</span><br><span class="line">PS D:\dev_app\collectors\vector-0.20.0&gt;</span><br></pre></td></tr></table></figure><p>快速入门可参考：<a href="https://vector.dev/docs/setup/quickstart/" target="_blank" rel="noopener">https://vector.dev/docs/setup/quickstart/</a></p><h4 id="vector配置"><a href="#vector配置" class="headerlink" title="vector配置"></a>vector配置</h4><p>clickhouse中要事先创建好相关表，见下节。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 消费kafka ###</span></span><br><span class="line">[sources.kafka_source_001]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"kafka"</span></span><br><span class="line">bootstrap_servers = <span class="string">"localhost:9092"</span></span><br><span class="line">group_id = <span class="string">"consumer-group-name"</span></span><br><span class="line">key_field = <span class="string">"message_key"</span></span><br><span class="line">topics = [ <span class="string">"telegraf"</span> ]</span><br><span class="line"></span><br><span class="line"><span class="comment">### json字符串转成json对象 ###</span></span><br><span class="line">[transforms.transforms_parse_json]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"remap"</span></span><br><span class="line">inputs = [ <span class="string">"kafka_source_001"</span> ]</span><br><span class="line"><span class="built_in">source</span> = <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">. = parse_json!(.message)</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### redis_cmdstat 类型数据处理 ###</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 过滤出redis_cmdstat类型数据</span></span><br><span class="line">[transforms.redis_cmdstat]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"filter"</span></span><br><span class="line">inputs = [ <span class="string">"transforms_parse_json"</span> ]</span><br><span class="line">condition = &#123; <span class="built_in">type</span> = <span class="string">"vrl"</span>, <span class="built_in">source</span> = <span class="string">'.name == "redis_cmdstat"'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 将redis_cmdstat类型数据转换成一层json结构</span></span><br><span class="line">[transforms.redis_cmdstat_remap]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"remap"</span></span><br><span class="line">inputs = [ <span class="string">"redis_cmdstat"</span> ]</span><br><span class="line"><span class="built_in">source</span> = <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">.fields.timestamp = .timestamp</span></span><br><span class="line"><span class="string">.fields.name = .name</span></span><br><span class="line"><span class="string">.fields.command = .tags.command</span></span><br><span class="line"><span class="string">.fields.host = .tags.host</span></span><br><span class="line"><span class="string">.fields.port = .tags.port</span></span><br><span class="line"><span class="string">.fields.replication_role = .tags.replication_role</span></span><br><span class="line"><span class="string">.fields.server = .tags.server</span></span><br><span class="line"><span class="string">. = .fields</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 转换好的数据输出到clickhouse中</span></span><br><span class="line">[sinks.redis_cmdstat_out]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"clickhouse"</span></span><br><span class="line">inputs = [ <span class="string">"redis_cmdstat_remap"</span> ]</span><br><span class="line">database = <span class="string">"mydb"</span></span><br><span class="line">endpoint = <span class="string">"http://localhost:8123"</span></span><br><span class="line">auth.strategy = <span class="string">"basic"</span></span><br><span class="line">auth.password = <span class="string">"password"</span></span><br><span class="line">auth.user = <span class="string">"default"</span></span><br><span class="line">table = <span class="string">"t_redis_cmd_stat"</span></span><br><span class="line">compression = <span class="string">"gzip"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### redis_keyspace ###</span></span><br><span class="line"></span><br><span class="line">[transforms.redis_keyspace]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"filter"</span></span><br><span class="line">inputs = [ <span class="string">"transforms_parse_json"</span> ]</span><br><span class="line">condition = &#123; <span class="built_in">type</span> = <span class="string">"vrl"</span>, <span class="built_in">source</span> = <span class="string">'.name == "redis_keyspace"'</span> &#125;</span><br><span class="line"></span><br><span class="line">[transforms.redis_keyspace_remap]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"remap"</span></span><br><span class="line">inputs = [ <span class="string">"redis_keyspace"</span> ]</span><br><span class="line"><span class="built_in">source</span> = <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">.fields.timestamp = .timestamp</span></span><br><span class="line"><span class="string">.fields.name = .name</span></span><br><span class="line"><span class="string">.fields.database = .tags.database</span></span><br><span class="line"><span class="string">.fields.host = .tags.host</span></span><br><span class="line"><span class="string">.fields.port = .tags.port</span></span><br><span class="line"><span class="string">.fields.replication_role = .tags.replication_role</span></span><br><span class="line"><span class="string">.fields.server = .tags.server</span></span><br><span class="line"><span class="string">. = .fields</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[sinks.redis_keyspace_out]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"clickhouse"</span></span><br><span class="line">inputs = [ <span class="string">"redis_cmdstat_remap"</span> ]</span><br><span class="line">database = <span class="string">"mydb"</span></span><br><span class="line">endpoint = <span class="string">"http://localhost:8123"</span></span><br><span class="line">auth.strategy = <span class="string">"basic"</span></span><br><span class="line">auth.password = <span class="string">"password"</span></span><br><span class="line">auth.user = <span class="string">"default"</span></span><br><span class="line">table = <span class="string">"t_redis_cmd_stat"</span></span><br><span class="line">compression = <span class="string">"gzip"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### redis ###</span></span><br><span class="line"></span><br><span class="line">[transforms.redis]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"filter"</span></span><br><span class="line">inputs = [ <span class="string">"transforms_parse_json"</span> ]</span><br><span class="line">condition = &#123; <span class="built_in">type</span> = <span class="string">"vrl"</span>, <span class="built_in">source</span> = <span class="string">'.name == "redis"'</span> &#125;</span><br><span class="line"></span><br><span class="line">[transforms.redis_remap]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"remap"</span></span><br><span class="line">inputs = [ <span class="string">"redis"</span> ]</span><br><span class="line"><span class="built_in">source</span> = <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">.fields.timestamp = .timestamp</span></span><br><span class="line"><span class="string">.fields.name = .name</span></span><br><span class="line"><span class="string">.fields.host = .tags.host</span></span><br><span class="line"><span class="string">.fields.port = .tags.port</span></span><br><span class="line"><span class="string">.fields.replication_role = .tags.replication_role</span></span><br><span class="line"><span class="string">.fields.server = .tags.server</span></span><br><span class="line"><span class="string">. = .fields</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line">[sinks.redis_out]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"clickhouse"</span></span><br><span class="line">inputs = [ <span class="string">"redis_cmdstat_remap"</span> ]</span><br><span class="line">database = <span class="string">"mydb"</span></span><br><span class="line">endpoint = <span class="string">"http://localhost:8123"</span></span><br><span class="line">auth.strategy = <span class="string">"basic"</span></span><br><span class="line">auth.password = <span class="string">"password"</span></span><br><span class="line">auth.user = <span class="string">"default"</span></span><br><span class="line">table = <span class="string">"t_redis_cmd_stat"</span></span><br><span class="line">compression = <span class="string">"gzip"</span></span><br></pre></td></tr></table></figure><h3 id="clickhouse"><a href="#clickhouse" class="headerlink" title="clickhouse"></a>clickhouse</h3><h4 id="创建表语句"><a href="#创建表语句" class="headerlink" title="创建表语句"></a>创建表语句</h4><p>t_redis_keyspace_stat</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_redis_keyspace_stat</span><br><span class="line">(</span><br><span class="line">    <span class="string">`timestamp`</span> DateTime64(<span class="number">3</span>, <span class="string">'Asia/Shanghai'</span>),</span><br><span class="line">    <span class="string">`host`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`server`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`port`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`replication_role`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`name`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`database`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`avg_ttl`</span> Float64,</span><br><span class="line">    <span class="string">`expires`</span> Float64,</span><br><span class="line">    <span class="string">`keys`</span> Float64</span><br><span class="line">)</span><br><span class="line"><span class="keyword">ENGINE</span> = MergeTree()</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> toYYYYMM(<span class="keyword">timestamp</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (<span class="keyword">timestamp</span>)</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>t_redis_cmd_stat</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_redis_cmd_stat</span><br><span class="line">(</span><br><span class="line">    <span class="string">`timestamp`</span> DateTime64(<span class="number">3</span>, <span class="string">'Asia/Shanghai'</span>),</span><br><span class="line">    <span class="string">`host`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`server`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`port`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`replication_role`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`name`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`command`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`calls`</span> Float64,</span><br><span class="line">    <span class="string">`usec`</span> Float64,</span><br><span class="line">    <span class="string">`usec_per_call`</span> Float64</span><br><span class="line">)</span><br><span class="line"><span class="keyword">ENGINE</span> = MergeTree()</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> toYYYYMM(<span class="keyword">timestamp</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (<span class="keyword">timestamp</span>)</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>t_redis_stat</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_redis_stat</span><br><span class="line">(</span><br><span class="line">    <span class="string">`timestamp`</span> DateTime64(<span class="number">3</span>, <span class="string">'Asia/Shanghai'</span>),</span><br><span class="line">    <span class="string">`host`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`port`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`server`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`replication_role`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`name`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`aof_current_rewrite_time_sec`</span> Float64,</span><br><span class="line">    <span class="string">`aof_enabled`</span> Float64,</span><br><span class="line">    <span class="string">`aof_last_bgrewrite_status`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`aof_last_rewrite_time_sec`</span> Float64,</span><br><span class="line">    <span class="string">`aof_last_write_status`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`aof_rewrite_in_progress`</span> Float64,</span><br><span class="line">    <span class="string">`aof_rewrite_scheduled`</span> Float64,</span><br><span class="line">    <span class="string">`blocked_clients`</span> Float64,</span><br><span class="line">    <span class="string">`client_biggest_input_buf`</span> Float64,</span><br><span class="line">    <span class="string">`client_longest_output_list`</span> Float64,</span><br><span class="line">    <span class="string">`clients`</span> Float64,</span><br><span class="line">    <span class="string">`cluster_enabled`</span> Float64,</span><br><span class="line">    <span class="string">`connected_slaves`</span> Float64,</span><br><span class="line">    <span class="string">`evicted_keys`</span> Float64,</span><br><span class="line">    <span class="string">`expired_keys`</span> Float64,</span><br><span class="line">    <span class="string">`instantaneous_input_kbps`</span> Float64,</span><br><span class="line">    <span class="string">`instantaneous_ops_per_sec`</span> Float64,</span><br><span class="line">    <span class="string">`instantaneous_output_kbps`</span> Float64,</span><br><span class="line">    <span class="string">`keyspace_hitrate`</span> Float64,</span><br><span class="line">    <span class="string">`keyspace_hits`</span> Float64,</span><br><span class="line">    <span class="string">`keyspace_misses`</span> Float64,</span><br><span class="line">    <span class="string">`latest_fork_usec`</span> Float64,</span><br><span class="line">    <span class="string">`loading`</span> Float64,</span><br><span class="line">    <span class="string">`lru_clock`</span> Float64,</span><br><span class="line">    <span class="string">`master_repl_offset`</span> Float64,</span><br><span class="line">    <span class="string">`mem_fragmentation_ratio`</span> Float64,</span><br><span class="line">    <span class="string">`migrate_cached_sockets`</span> Float64,</span><br><span class="line">    <span class="string">`pubsub_channels`</span> Float64,</span><br><span class="line">    <span class="string">`pubsub_patterns`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_bgsave_in_progress`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_changes_since_last_save`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_current_bgsave_time_sec`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_last_bgsave_status`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`rdb_last_bgsave_time_sec`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_last_save_time`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_last_save_time_elapsed`</span> Float64,</span><br><span class="line">    <span class="string">`redis_version`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`rejected_connections`</span> Float64,</span><br><span class="line">    <span class="string">`repl_backlog_active`</span> Float64,</span><br><span class="line">    <span class="string">`repl_backlog_first_byte_offset`</span> Float64,</span><br><span class="line">    <span class="string">`repl_backlog_histlen`</span> Float64,</span><br><span class="line">    <span class="string">`repl_backlog_size`</span> Float64,</span><br><span class="line">    <span class="string">`sync_full`</span> Float64,</span><br><span class="line">    <span class="string">`sync_partial_err`</span> Float64,</span><br><span class="line">    <span class="string">`sync_partial_ok`</span> Float64,</span><br><span class="line">    <span class="string">`total_commands_processed`</span> Float64,</span><br><span class="line">    <span class="string">`total_connections_received`</span> Float64,</span><br><span class="line">    <span class="string">`total_net_input_bytes`</span> Float64,</span><br><span class="line">    <span class="string">`total_net_output_bytes`</span> Float64,</span><br><span class="line">    <span class="string">`uptime`</span> Float64,</span><br><span class="line">    <span class="string">`used_cpu_sys`</span> Float64,</span><br><span class="line">    <span class="string">`used_cpu_sys_children`</span> Float64,</span><br><span class="line">    <span class="string">`used_cpu_user`</span> Float64,</span><br><span class="line">    <span class="string">`used_cpu_user_children`</span> Float64,</span><br><span class="line">    <span class="string">`used_memory`</span> Float64,</span><br><span class="line">    <span class="string">`used_memory_lua`</span> Float64,</span><br><span class="line">    <span class="string">`used_memory_peak`</span> Float64,</span><br><span class="line">    <span class="string">`used_memory_rss`</span> Float64</span><br><span class="line">)</span><br><span class="line"><span class="keyword">ENGINE</span> = MergeTree()</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> toYYYYMM(<span class="keyword">timestamp</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (<span class="keyword">timestamp</span>)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本示例在windows环境下演示，绝大部分命令和linux通用。&lt;/p&gt;
&lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.influxdata.com/telegraf/v1.22/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;telegraf&lt;/a&gt;：指标收集工具，可收集中间件暴露的性能指标，本文中我们以收集redis指标为例。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kafka.apache.org/quickstart&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;kafka&lt;/a&gt;：telegraf收集上来的指标上报到kafka，用于提高系统吞吐量。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://vector.dev/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;vector&lt;/a&gt;：高性能传输管道，支持多种源和目标，本示例中用于消费kafka消息，转换后，写入到ClickHouse中。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://clickhouse.com/docs/zh/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;clickhouse&lt;/a&gt;: 列式存储数据库，适用于OLAP分析型场景。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://superset.apache.org/docs/intro&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;superset&lt;/a&gt;：轻量级BI工具，用于快速接入各种数据源实现数据展现。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="指标收集" scheme="http://yoursite.com/categories/%E6%8C%87%E6%A0%87%E6%94%B6%E9%9B%86/"/>
    
    
      <category term="telegraf" scheme="http://yoursite.com/tags/telegraf/"/>
    
      <category term="kafka" scheme="http://yoursite.com/tags/kafka/"/>
    
      <category term="vector" scheme="http://yoursite.com/tags/vector/"/>
    
      <category term="clickhouse" scheme="http://yoursite.com/tags/clickhouse/"/>
    
  </entry>
  
  <entry>
    <title>vue3插槽</title>
    <link href="http://yoursite.com/2022/03/02/vue3%E6%8F%92%E6%A7%BD/"/>
    <id>http://yoursite.com/2022/03/02/vue3插槽/</id>
    <published>2022-03-02T11:33:00.000Z</published>
    <updated>2022-06-19T02:50:10.364Z</updated>
    
    <content type="html"><![CDATA[<h3 id="基本内容"><a href="#基本内容" class="headerlink" title="基本内容"></a>基本内容</h3><p>定义一个组件com，使用slot标签占位：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.component(<span class="string">'com'</span>, &#123;</span><br><span class="line">    template: <span class="string">`&lt;div&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/div&gt;`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>使用这个组件com：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">com</span>&gt;</span>是非成败转头空，浪花淘尽英雄。<span class="tag">&lt;/<span class="name">com</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>组件com中的slot会被替换成<code>是非成败转头空，浪花淘尽英雄。</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;基本内容&quot;&gt;&lt;a href=&quot;#基本内容&quot; class=&quot;headerlink&quot; title=&quot;基本内容&quot;&gt;&lt;/a&gt;基本内容&lt;/h3&gt;&lt;p&gt;定义一个组件com，使用slot标签占位：&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;
      
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="vue" scheme="http://yoursite.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>CentOS下使用Minikube搭建k8s单机环境</title>
    <link href="http://yoursite.com/2022/02/21/CentOS%E4%B8%8B%E4%BD%BF%E7%94%A8Minikube%E6%90%AD%E5%BB%BAk8s%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/"/>
    <id>http://yoursite.com/2022/02/21/CentOS下使用Minikube搭建k8s单机环境/</id>
    <published>2022-02-21T14:20:00.000Z</published>
    <updated>2022-06-19T02:50:10.356Z</updated>
    
    <content type="html"><![CDATA[<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ul><li><a href="https://yongtao.wang/2022/02/21/linux%E4%B8%8B%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%20&amp;%20selinux/" target="_blank" rel="noopener">linux下关闭【防火墙 &amp; seLinux】</a></li><li><a href="https://yongtao.wang/2022/02/18/CentOS%207%E6%9B%B4%E6%96%B0%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC/" target="_blank" rel="noopener">CentOS 7更新到最新版本</a></li><li><a href="https://yongtao.wang/2018/10/25/Docker%20install/" target="_blank" rel="noopener">Docker install</a></li><li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/" target="_blank" rel="noopener">安装kubectl</a></li><li><a href="https://minikube.sigs.k8s.io/docs/start/?spm=a2c6h.12873639.0.0.ab202043NBm9C5" target="_blank" rel="noopener">安装Minikube</a></li></ul><p>注意docker需要使用非root账户运行，minikube也需要非root账户。</p><a id="more"></a><h4 id="清理环境"><a href="#清理环境" class="headerlink" title="清理环境"></a>清理环境</h4><p>之前安装过的话，需要清理下环境，新安装的不需要执行。</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ minikube stop</span><br><span class="line">* Stopping node "minikube"  ...</span><br><span class="line">* Powering off "minikube" via SSH ...</span><br><span class="line">* 1 node stopped.</span><br><span class="line">[wangyt@pseudo-cluster ~]$ minikube delete</span><br><span class="line">* Deleting "minikube" in docker ...</span><br><span class="line">* Deleting container "minikube" ...</span><br><span class="line">* Removing /home/wangyt/.minikube/machines/minikube ...</span><br><span class="line">* Removed all traces of the "minikube" cluster.</span><br><span class="line">[wangyt@pseudo-cluster ~]$ rm -rf ~/.kube/</span><br><span class="line">[wangyt@pseudo-cluster ~]$ rm -rf ~/.minikube/</span><br></pre></td></tr></table></figure><h4 id="创建一个minikube虚拟机"><a href="#创建一个minikube虚拟机" class="headerlink" title="创建一个minikube虚拟机"></a>创建一个minikube虚拟机</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ minikube start</span><br><span class="line">* minikube v1.25.1 on Centos 7.9.2009</span><br><span class="line">* Automatically selected the docker driver</span><br><span class="line">* Starting control plane node minikube in cluster minikube</span><br><span class="line">* Pulling base image ...</span><br><span class="line">* Downloading Kubernetes v1.23.1 preload ...</span><br><span class="line">    &gt; preloaded-images-k8s-v16-v1...: 504.42 MiB / 504.42 MiB  100.00% 3.69 MiB</span><br><span class="line">* Creating docker container (CPUs=2, Memory=2200MB) ...</span><br><span class="line">! This container is having trouble accessing https://k8s.gcr.io</span><br><span class="line">* To pull new external images, you may need to configure a proxy: https://minikube.sigs.k8s.io/docs/reference/networking/proxy/</span><br><span class="line">* Preparing Kubernetes v1.23.1 on Docker 20.10.12 ...</span><br><span class="line">  - kubelet.housekeeping-interval=5m</span><br><span class="line">  - Generating certificates and keys ...</span><br><span class="line">  - Booting up control plane ...</span><br><span class="line">  - Configuring RBAC rules ...</span><br><span class="line">* Verifying Kubernetes components...</span><br><span class="line">  - Using image gcr.io/k8s-minikube/storage-provisioner:v5</span><br><span class="line">* Enabled addons: default-storageclass, storage-provisioner</span><br><span class="line">* Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default</span><br></pre></td></tr></table></figure><h5 id="查看集群信息"><a href="#查看集群信息" class="headerlink" title="查看集群信息"></a>查看集群信息</h5><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ kubectl cluster-info</span><br><span class="line">Kubernetes control plane is running at https://192.168.49.2:8443</span><br><span class="line">CoreDNS is running at https://192.168.49.2:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><br><span class="line"></span><br><span class="line">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span><br></pre></td></tr></table></figure><h4 id="开启dashboard"><a href="#开启dashboard" class="headerlink" title="开启dashboard"></a>开启dashboard</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ minikube dashboard --port=8899 --url=true</span><br><span class="line">* Verifying dashboard health ...</span><br><span class="line">* Launching proxy ...</span><br><span class="line">* Verifying proxy health ...</span><br><span class="line">http://127.0.0.1:8899/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</span><br></pre></td></tr></table></figure><p>外面访问不到，可以开proxy：<a href="https://kubernetes.io/zh/docs/tasks/extend-kubernetes/http-proxy-access-api/" target="_blank" rel="noopener">使用 HTTP 代理访问 Kubernetes API</a></p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动 Kubernetes API 服务器的代理：</span></span><br><span class="line">[wangyt@pseudo-cluster ~]$ kubectl proxy --port=8899 --address='192.168.101.146' --accept-hosts='^.*' &amp;</span><br></pre></td></tr></table></figure><p>访问：</p><p><a href="http://192.168.101.146:8899/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/" target="_blank" rel="noopener">http://192.168.101.146:8899/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</a></p><h4 id="查看Pod"><a href="#查看Pod" class="headerlink" title="查看Pod"></a>查看Pod</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ kubectl get po -A</span><br><span class="line">NAMESPACE              NAME                                        READY   STATUS    RESTARTS        AGE</span><br><span class="line">kube-system            coredns-64897985d-xk7qf                     1/1     Running   0               4h53m</span><br><span class="line">kube-system            etcd-minikube                               1/1     Running   0               4h53m</span><br><span class="line">kube-system            kube-apiserver-minikube                     1/1     Running   0               4h53m</span><br><span class="line">kube-system            kube-controller-manager-minikube            1/1     Running   0               4h53m</span><br><span class="line">kube-system            kube-proxy-6m7sk                            1/1     Running   0               4h53m</span><br><span class="line">kube-system            kube-scheduler-minikube                     1/1     Running   0               4h53m</span><br><span class="line">kube-system            storage-provisioner                         1/1     Running   1 (4h53m ago)   4h53m</span><br><span class="line">kubernetes-dashboard   dashboard-metrics-scraper-58549894f-krr2c   1/1     Running   0               4h39m</span><br><span class="line">kubernetes-dashboard   kubernetes-dashboard-ccd587f44-84sgj        1/1     Running   0               4h39m</span><br><span class="line">[wangyt@pseudo-cluster ~]$ kubectl get pods --all-namespaces</span><br><span class="line">NAMESPACE              NAME                                        READY   STATUS    RESTARTS        AGE</span><br><span class="line">kube-system            coredns-64897985d-xk7qf                     1/1     Running   0               4h54m</span><br><span class="line">kube-system            etcd-minikube                               1/1     Running   0               4h54m</span><br><span class="line">kube-system            kube-apiserver-minikube                     1/1     Running   0               4h54m</span><br><span class="line">kube-system            kube-controller-manager-minikube            1/1     Running   0               4h54m</span><br><span class="line">kube-system            kube-proxy-6m7sk                            1/1     Running   0               4h54m</span><br><span class="line">kube-system            kube-scheduler-minikube                     1/1     Running   0               4h54m</span><br><span class="line">kube-system            storage-provisioner                         1/1     Running   1 (4h53m ago)   4h54m</span><br><span class="line">kubernetes-dashboard   dashboard-metrics-scraper-58549894f-krr2c   1/1     Running   0               4h40m</span><br><span class="line">kubernetes-dashboard   kubernetes-dashboard-ccd587f44-84sgj        1/1     Running   0               4h40m</span><br></pre></td></tr></table></figure><h4 id="Pod-容器组"><a href="#Pod-容器组" class="headerlink" title="Pod(容器组)"></a>Pod(容器组)</h4><p>我们以tomcat为例，使用k8s来部署服务。</p><p>Pod是Kubernetes中的容器组，一个Pod可以包含一个或多个容器（Docker）。我们可以用一个YAML文件来描述如何建立一个Pod。</p><p><code>tomcat-pod.yaml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">tomcat</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">mytomcat</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">tomcat</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">tomcat:8</span></span><br><span class="line"><span class="attr">    resources:</span></span><br><span class="line"><span class="attr">      limits:</span></span><br><span class="line"><span class="attr">        memory:</span> <span class="string">"128Mi"</span></span><br><span class="line"><span class="attr">        cpu:</span> <span class="string">"500m"</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="attr">      - containerPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><p>使用<code>kubectl</code>部署Pod：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster tmp]$ kubectl create -f tomcat-pod.yaml</span><br><span class="line">pod/tomcat created</span><br></pre></td></tr></table></figure><p>查看Pod：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster tmp]$ kubectl get pods -A</span><br><span class="line">NAMESPACE              NAME                                        READY   STATUS              RESTARTS   AGE</span><br><span class="line">default                tomcat                                      0/1     ContainerCreating   0          9s</span><br></pre></td></tr></table></figure><p>查看Pod详情：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ kubectl describe pod/tomcat</span><br><span class="line">Name:         tomcat</span><br><span class="line">Namespace:    default</span><br><span class="line">Priority:     0</span><br><span class="line">Node:         minikube/192.168.49.2</span><br><span class="line">Start Time:   Wed, 13 Apr 2022 04:01:32 +0800</span><br><span class="line">Labels:       app=mytomcat</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Status:       Running</span><br><span class="line">IP:           172.17.0.5</span><br><span class="line">IPs:</span><br><span class="line">  IP:  172.17.0.5</span><br><span class="line">Containers:</span><br><span class="line">  tomcat:</span><br><span class="line">    Container ID:   docker://3cbeae4ab93d5ee0c803391c3435e905efa7dc9ccb305b8ac299c87cfe7e3ccc</span><br><span class="line">    Image:          tomcat:8</span><br><span class="line">    Image ID:       docker-pullable://tomcat@sha256:8d7231354284be82ddc4567b209f4fea3a6f42f4f9626005e793953fc0a2d066</span><br><span class="line">    Port:           8080/TCP</span><br><span class="line">    Host Port:      0/TCP</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Wed, 13 Apr 2022 04:01:33 +0800</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Limits:</span><br><span class="line">      cpu:     500m</span><br><span class="line">      memory:  128Mi</span><br><span class="line">    Requests:</span><br><span class="line">      cpu:        500m</span><br><span class="line">      memory:     128Mi</span><br><span class="line">    Environment:  &lt;none&gt;</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-zp66r (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True </span><br><span class="line">  Ready             True </span><br><span class="line">  ContainersReady   True </span><br><span class="line">  PodScheduled      True </span><br><span class="line">Volumes:</span><br><span class="line">  kube-api-access-zp66r:</span><br><span class="line">    Type:                    Projected (a volume that contains injected data from multiple sources)</span><br><span class="line">    TokenExpirationSeconds:  3607</span><br><span class="line">    ConfigMapName:           kube-root-ca.crt</span><br><span class="line">    ConfigMapOptional:       &lt;nil&gt;</span><br><span class="line">    DownwardAPI:             true</span><br><span class="line">QoS Class:                   Guaranteed</span><br><span class="line">Node-Selectors:              &lt;none&gt;</span><br><span class="line">Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s</span><br><span class="line">                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s</span><br><span class="line">Events:                      &lt;none&gt;</span><br></pre></td></tr></table></figure><p>进入Pod容器：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ kubectl exec -it tomcat -- /bin/bash</span><br><span class="line">root@tomcat:/usr/local/tomcat# ps -elf | grep java</span><br><span class="line">4 S root           1       0  0  80   0 - 845824 futex_ 20:01 ?       00:00:28 /usr/local/openjdk-11/bin/java -Djava.util.logging.config.file=/usr/local/tomcat/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize=2048 -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK=0027 -Dignore.endorsed.dirs= -classpath /usr/local/tomcat/bin/bootstrap.jar:/usr/local/tomcat/bin/tomcat-juli.jar -Dcatalina.base=/usr/local/tomcat -Dcatalina.home=/usr/local/tomcat -Djava.io.tmpdir=/usr/local/tomcat/temp org.apache.catalina.startup.Bootstrap start</span><br><span class="line">0 S root         122     112  0  80   0 -  1264 pipe_w 21:21 pts/0    00:00:00 grep java</span><br><span class="line">root@tomcat:/usr/local/tomcat#</span><br></pre></td></tr></table></figure><h4 id="Replica-Set-副本集"><a href="#Replica-Set-副本集" class="headerlink" title="Replica Set(副本集)"></a>Replica Set(副本集)</h4><p>Replica Set控制Pod副本的运行数量。</p><p><code>tomcat-rs.yaml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span> <span class="comment"># 类型为ReplicaSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">tomcat-rs</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">mytomcat</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">mytomcat</span> <span class="comment"># 匹配Pod的元数据，将此副本集应用到该Pod</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">mytomcat</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">tomcat</span></span><br><span class="line"><span class="attr">          image:</span> <span class="attr">tomcat:8</span></span><br></pre></td></tr></table></figure><p>部署ReplicaSet：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ kubectl create -f tomcat-rs.yaml </span><br><span class="line">replicaset.apps/tomcat-rs created</span><br></pre></td></tr></table></figure><p>查看rs：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ kubectl get rs</span><br><span class="line">NAME        DESIRED   CURRENT   READY   AGE</span><br><span class="line">tomcat-rs   3         3         3       7s</span><br></pre></td></tr></table></figure><p>副本集详情：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ kubectl describe replicasets/tomcat-rs</span><br><span class="line">Name:         tomcat-rs</span><br><span class="line">Namespace:    default</span><br><span class="line">Selector:     app=mytomcat</span><br><span class="line">Labels:       app=mytomcat</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Replicas:     3 current / 3 desired</span><br><span class="line">Pods Status:  3 Running / 0 Waiting / 0 Succeeded / 0 Failed</span><br><span class="line">Pod Template:</span><br><span class="line">  Labels:  app=mytomcat</span><br><span class="line">  Containers:</span><br><span class="line">   tomcat:</span><br><span class="line">    Image:        tomcat:8</span><br><span class="line">    Port:         &lt;none&gt;</span><br><span class="line">    Host Port:    &lt;none&gt;</span><br><span class="line">    Environment:  &lt;none&gt;</span><br><span class="line">    Mounts:       &lt;none&gt;</span><br><span class="line">  Volumes:        &lt;none&gt;</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason            Age   From                   Message</span><br><span class="line">  ----    ------            ----  ----                   -------</span><br><span class="line">  Normal  SuccessfulCreate  59m   replicaset-controller  Created pod: tomcat-rs-s9d98</span><br><span class="line">  Normal  SuccessfulCreate  59m   replicaset-controller  Created pod: tomcat-rs-96cp7</span><br></pre></td></tr></table></figure><p>查看Pods：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ kubectl get pods</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE</span><br><span class="line">tomcat            1/1     Running   0          140m</span><br><span class="line">tomcat-rs-96cp7   1/1     Running   0          19s</span><br><span class="line">tomcat-rs-s9d98   1/1     Running   0          19s</span><br></pre></td></tr></table></figure><h4 id="Service-服务"><a href="#Service-服务" class="headerlink" title="Service(服务)"></a>Service(服务)</h4><p>Service将一组Pod组织在一起，然后可以通过Service名来访问，还可以实现Pod的负载均衡。</p><p>tomcat-service.yaml：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">tomcat-service</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">mytomcat</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">30000</span></span><br><span class="line"><span class="attr">      nodePort:</span> <span class="number">30000</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">mytomcat</span></span><br></pre></td></tr></table></figure><p>Service有以下三种类型：</p><ul><li><code>NodePort</code>：通过Node的静态端口暴露服务。</li><li><code>LoadBalancer</code>：使用云平台提供商的Load Balancer(例如阿里云会提供一个公网IP地址)。</li><li><code>ClusterIP</code>：只能在k8s内部可以访问的服务。</li></ul><p>部署Service：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ kubectl create -f tomcat-service.yaml</span><br><span class="line">service/tomcat-service created</span><br></pre></td></tr></table></figure><p>查看Service：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ kubectl get services                </span><br><span class="line">NAME             TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)           AGE</span><br><span class="line">kubernetes       ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP           3h6m</span><br><span class="line">tomcat-service   NodePort    10.111.23.38   &lt;none&gt;        30000:30000/TCP   12s</span><br></pre></td></tr></table></figure><p>查看Service详情：<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ kubectl describe services/tomcat-service</span><br><span class="line">Name:                     tomcat-service</span><br><span class="line">Namespace:                default</span><br><span class="line">Labels:                   app=mytomcat</span><br><span class="line">Annotations:              &lt;none&gt;</span><br><span class="line">Selector:                 app=mytomcat</span><br><span class="line">Type:                     NodePort</span><br><span class="line">IP Family Policy:         SingleStack</span><br><span class="line">IP Families:              IPv4</span><br><span class="line">IP:                       10.111.23.38</span><br><span class="line">IPs:                      10.111.23.38</span><br><span class="line">Port:                     &lt;unset&gt;  30000/TCP</span><br><span class="line">TargetPort:               8080/TCP</span><br><span class="line">NodePort:                 &lt;unset&gt;  30000/TCP</span><br><span class="line">Endpoints:                172.17.0.5:8080,172.17.0.6:8080,172.17.0.7:8080</span><br><span class="line">Session Affinity:         None</span><br><span class="line">External Traffic Policy:  Cluster</span><br><span class="line">Events:                   &lt;none&gt;</span><br><span class="line">[wangyt@pseudo-cluster basic]$</span><br></pre></td></tr></table></figure></p><p>访问服务：</p><p>这里使用NodePort访问服务，可以通过下面的命令获取Node的IP地址：</p><p><code>minikube ip</code></p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ minikube ip</span><br><span class="line">192.168.49.2</span><br><span class="line">[wangyt@pseudo-cluster basic]$ curl 192.168.49.2:30000</span><br><span class="line">&lt;!doctype html&gt;&lt;html lang="en"&gt;&lt;head&gt;&lt;title&gt;HTTP Status 404 – Not Found&lt;/title&gt;&lt;style type="text/css"&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p &#123;font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 404 – Not Found&lt;/h1&gt;&lt;hr class="line" /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Status Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The origin server did not find a current representation for the target resource or is not willing to disclose that one exists.&lt;/p&gt;&lt;hr class="line" /&gt;&lt;h3&gt;Apache Tomcat/8.5.78&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;[wangyt@pseudo-cluster basic]$ </span><br><span class="line">[wangyt@pseudo-cluster basic]$</span><br></pre></td></tr></table></figure><p>TODO 将tomcat设置为clusterIp模式，测试k8s proxy 方式访问：</p><p><a href="http://192.168.101.120:8899/api/v1/proxy/namespaces/" target="_blank" rel="noopener">http://192.168.101.120:8899/api/v1/proxy/namespaces/</a><namespace>/services/<service-name>:<port-name>/</port-name></service-name></namespace></p><p><a href="http://192.168.101.120:8899/api/v1/proxy/namespaces/default/services/skywalking-ui:http/" target="_blank" rel="noopener">http://192.168.101.120:8899/api/v1/proxy/namespaces/default/services/skywalking-ui:http/</a></p><h4 id="Deployment-部署"><a href="#Deployment-部署" class="headerlink" title="Deployment(部署)"></a>Deployment(部署)</h4><p>Deployment可以管理ReplicaSet和Pod的部署，具备更新和回滚的能力。</p><p><code>tomcat-deployment.yaml</code>：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: tomcat-deployment</span><br><span class="line">  labels:</span><br><span class="line">    app: mytomcat</span><br><span class="line">spec:</span><br><span class="line">  replicas: 4</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: mytomcat</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: mytomcat</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: tomcat</span><br><span class="line">          image: tomcat:8</span><br></pre></td></tr></table></figure><p>部署Deployment</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ kubectl create -f tomcat-deployment.yaml</span><br><span class="line">deployment.apps/tomcat-deployment created</span><br><span class="line">[wangyt@pseudo-cluster basic]$ kubectl get pods</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE</span><br><span class="line">tomcat            1/1     Running   0          4h37m</span><br><span class="line">tomcat-rs-7sj7h   1/1     Running   0          11s</span><br><span class="line">tomcat-rs-96cp7   1/1     Running   0          137m</span><br><span class="line">tomcat-rs-s9d98   1/1     Running   0          137m</span><br></pre></td></tr></table></figure><p>查看Deployment：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployments</span><br><span class="line">kubectl get pods</span><br></pre></td></tr></table></figure><p>查看Deployment详情：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ kubectl get deployments</span><br><span class="line">NAME                READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">tomcat-deployment   4/4     4            4           99s</span><br><span class="line">[wangyt@pseudo-cluster basic]$ kubectl describe deployments/tomcat-deployment</span><br><span class="line">Name:                   tomcat-deployment</span><br><span class="line">Namespace:              default</span><br><span class="line">CreationTimestamp:      Wed, 13 Apr 2022 08:39:17 +0800</span><br><span class="line">Labels:                 app=mytomcat</span><br><span class="line">Annotations:            deployment.kubernetes.io/revision: 1</span><br><span class="line">Selector:               app=mytomcat</span><br><span class="line">Replicas:               4 desired | 4 updated | 4 total | 4 available | 0 unavailable</span><br><span class="line">StrategyType:           RollingUpdate</span><br><span class="line">MinReadySeconds:        0</span><br><span class="line">RollingUpdateStrategy:  25% max unavailable, 25% max surge</span><br><span class="line">Pod Template:</span><br><span class="line">  Labels:  app=mytomcat</span><br><span class="line">  Containers:</span><br><span class="line">   tomcat:</span><br><span class="line">    Image:        tomcat:8</span><br><span class="line">    Port:         &lt;none&gt;</span><br><span class="line">    Host Port:    &lt;none&gt;</span><br><span class="line">    Environment:  &lt;none&gt;</span><br><span class="line">    Mounts:       &lt;none&gt;</span><br><span class="line">  Volumes:        &lt;none&gt;</span><br><span class="line">Conditions:</span><br><span class="line">  Type           Status  Reason</span><br><span class="line">  ----           ------  ------</span><br><span class="line">  Available      True    MinimumReplicasAvailable</span><br><span class="line">  Progressing    True    NewReplicaSetAvailable</span><br><span class="line">OldReplicaSets:  &lt;none&gt;</span><br><span class="line">NewReplicaSet:   tomcat-rs (4/4 replicas created)</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason             Age    From                   Message</span><br><span class="line">  ----    ------             ----   ----                   -------</span><br><span class="line">  Normal  ScalingReplicaSet  2m25s  deployment-controller  Scaled up replica set tomcat-rs to 4</span><br></pre></td></tr></table></figure><p>更新部署，升级到tomcat9版本。</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ kubectl set image deployment/tomcat-deployment tomcat=tomcat:9</span><br><span class="line">deployment.apps/tomcat-deployment image updated</span><br><span class="line">[wangyt@pseudo-cluster basic]$ </span><br><span class="line">[wangyt@pseudo-cluster basic]$ </span><br><span class="line">[wangyt@pseudo-cluster basic]$ </span><br><span class="line">[wangyt@pseudo-cluster basic]$ kubectl get pods</span><br><span class="line">NAME                                READY   STATUS              RESTARTS   AGE</span><br><span class="line">tomcat                              1/1     Running             0          5h14m</span><br><span class="line">tomcat-deployment-77895cc49-4jr79   0/1     ContainerCreating   0          12s</span><br><span class="line">tomcat-deployment-77895cc49-qcrqf   0/1     ContainerCreating   0          12s</span><br><span class="line">tomcat-rs-96cp7                     1/1     Running             0          174m</span><br><span class="line">tomcat-rs-s9d98                     1/1     Running             0          174m</span><br><span class="line">[wangyt@pseudo-cluster basic]$ kubectl get pods</span><br><span class="line">NAME                                READY   STATUS    RESTARTS   AGE</span><br><span class="line">tomcat-deployment-77895cc49-4jr79   1/1     Running   0          9m59s</span><br><span class="line">tomcat-deployment-77895cc49-qcrqf   1/1     Running   0          9m59s</span><br><span class="line">tomcat-deployment-77895cc49-r7pp5   1/1     Running   0          5m7s</span><br><span class="line">tomcat-deployment-77895cc49-rgsxw   1/1     Running   0          5m12s</span><br></pre></td></tr></table></figure><p>查看版本是否更新：</p><p>可以看到版本变成了<code>Tomcat/9.0.62</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster basic]$ curl `minikube ip`:30000</span><br><span class="line">&lt;!doctype html&gt;&lt;html lang=<span class="string">"en"</span>&gt;&lt;head&gt;&lt;title&gt;HTTP Status 404 – Not Found&lt;/title&gt;&lt;style <span class="built_in">type</span>=<span class="string">"text/css"</span>&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:<span class="comment">#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p &#123;font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 404 – Not Found&lt;/h1&gt;&lt;hr class="line" /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Status Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The origin server did not find a current representation for the target resource or is not willing to disclose that one exists.&lt;/p&gt;&lt;hr class="line" /&gt;&lt;h3&gt;Apache Tomcat/9.0.62&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;[wangyt@pseudo-cluster basic]$ </span></span><br><span class="line">[wangyt@pseudo-cluster basic]$</span><br></pre></td></tr></table></figure><p>更新Pod数量：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster tmp]$ kubectl scale deployment tomcat-deployment --replicas 2</span><br><span class="line">deployment.apps/tomcat-deployment scaled</span><br><span class="line">[wangyt@pseudo-cluster tmp]$ kubectl get pods      </span><br><span class="line">NAME                                READY   STATUS    RESTARTS   AGE</span><br><span class="line">tomcat-deployment-77895cc49-4jr79   1/1     Running   0          15h</span><br><span class="line">tomcat-deployment-77895cc49-rgsxw   1/1     Running   0          15h</span><br></pre></td></tr></table></figure><p>回滚：</p><p>查看历史版本：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster tmp]$ kubectl rollout history deployments/tomcat-deployment </span><br><span class="line">deployment.apps/tomcat-deployment </span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">1         &lt;none&gt;</span><br><span class="line">2         &lt;none&gt;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster tmp]$ kubectl get deployment</span><br><span class="line">NAME                READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-deployment    1/1     1            1           19m</span><br><span class="line">tomcat-deployment   2/2     2            2           16h</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 回滚到版本1</span></span></span><br><span class="line">[wangyt@pseudo-cluster tmp]$ kubectl rollout undo deployment/tomcat-deployment --to-revision=1</span><br><span class="line">deployment.apps/tomcat-deployment rolled back</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 查看回滚状态</span></span></span><br><span class="line">[wangyt@pseudo-cluster tmp]$ kubectl rollout status deployment/tomcat-deployment</span><br><span class="line">deployment "tomcat-deployment" successfully rolled out</span><br><span class="line">[wangyt@pseudo-cluster tmp]$ kubectl get pods</span><br><span class="line">NAME                                READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-deployment-66cc6765b4-zzdmf   1/1     Running   0          21m</span><br><span class="line">tomcat-rs-4rpwj                     1/1     Running   0          47s</span><br><span class="line">tomcat-rs-tkjj8                     1/1     Running   0          49s</span><br><span class="line">[wangyt@pseudo-cluster tmp]$ curl `minikube ip`:30000</span><br><span class="line">&lt;!doctype html&gt;&lt;html lang="en"&gt;&lt;head&gt;&lt;title&gt;HTTP Status 404 – Not Found&lt;/title&gt;&lt;style type="text/css"&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p &#123;font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 404 – Not Found&lt;/h1&gt;&lt;hr class="line" /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Status Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The origin server did not find a current representation for the target resource or is not willing to disclose that one exists.&lt;/p&gt;&lt;hr class="line" /&gt;&lt;h3&gt;Apache Tomcat/8.5.78&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">[wangyt@pseudo-cluster tmp]$</span><br></pre></td></tr></table></figure><p>可以看到版本已变更为：Tomcat/8.5.78</p><h4 id="Ingress-访问权"><a href="#Ingress-访问权" class="headerlink" title="Ingress(访问权)"></a>Ingress(访问权)</h4><p>访问权用来定义外部访问集群内部服务的规则，类似于Gateway。</p><p>开启nginx ingress controller，网络失败多试几次，不行开启代理。也可以使用<code>minikube ssh</code>登录，再使用<code>docker pull</code>手动拉取镜像。</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster spring-boot-book-source-code]$ minikube addons enable ingress</span><br><span class="line">  - Using image k8s.gcr.io/ingress-nginx/controller:v1.1.0</span><br><span class="line">  - Using image k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1</span><br><span class="line">  - Using image k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.1.1</span><br><span class="line">* Verifying ingress addon...</span><br><span class="line">* The 'ingress' addon is enabled</span><br><span class="line">[wangyt@pseudo-cluster spring-boot-book-source-code]$ minikube addons list</span><br><span class="line"></span><br><span class="line">|-----------------------------|----------|--------------|--------------------------------|</span><br><span class="line">|         ADDON NAME          | PROFILE  |    STATUS    |           MAINTAINER           |</span><br><span class="line">|-----------------------------|----------|--------------|--------------------------------|</span><br><span class="line">| ambassador                  | minikube | disabled     | third-party (ambassador)       |</span><br><span class="line">| auto-pause                  | minikube | disabled     | google                         |</span><br><span class="line">| csi-hostpath-driver         | minikube | disabled     | kubernetes                     |</span><br><span class="line">| dashboard                   | minikube | enabled ✅   | kubernetes                     |</span><br><span class="line">| default-storageclass        | minikube | enabled ✅   | kubernetes                     |</span><br><span class="line">| efk                         | minikube | disabled     | third-party (elastic)          |</span><br><span class="line">| freshpod                    | minikube | disabled     | google                         |</span><br><span class="line">| gcp-auth                    | minikube | disabled     | google                         |</span><br><span class="line">| gvisor                      | minikube | disabled     | google                         |</span><br><span class="line">| helm-tiller                 | minikube | disabled     | third-party (helm)             |</span><br><span class="line">| ingress                     | minikube | enabled ✅   | unknown (third-party)          |</span><br><span class="line">| ingress-dns                 | minikube | disabled     | google                         |</span><br><span class="line">| istio                       | minikube | disabled     | third-party (istio)            |</span><br><span class="line">| istio-provisioner           | minikube | disabled     | third-party (istio)            |</span><br><span class="line">| kubevirt                    | minikube | disabled     | third-party (kubevirt)         |</span><br><span class="line">| logviewer                   | minikube | disabled     | unknown (third-party)          |</span><br><span class="line">| metallb                     | minikube | disabled     | third-party (metallb)          |</span><br><span class="line">| metrics-server              | minikube | disabled     | kubernetes                     |</span><br><span class="line">| nvidia-driver-installer     | minikube | disabled     | google                         |</span><br><span class="line">| nvidia-gpu-device-plugin    | minikube | disabled     | third-party (nvidia)           |</span><br><span class="line">| olm                         | minikube | disabled     | third-party (operator          |</span><br><span class="line">|                             |          |              | framework)                     |</span><br><span class="line">| pod-security-policy         | minikube | disabled     | unknown (third-party)          |</span><br><span class="line">| portainer                   | minikube | disabled     | portainer.io                   |</span><br><span class="line">| registry                    | minikube | disabled     | google                         |</span><br><span class="line">| registry-aliases            | minikube | disabled     | unknown (third-party)          |</span><br><span class="line">| registry-creds              | minikube | disabled     | third-party (upmc enterprises) |</span><br><span class="line">| storage-provisioner         | minikube | enabled ✅   | google                         |</span><br><span class="line">| storage-provisioner-gluster | minikube | disabled     | unknown (third-party)          |</span><br><span class="line">| volumesnapshots             | minikube | disabled     | kubernetes                     |</span><br><span class="line">|-----------------------------|----------|--------------|--------------------------------|</span><br></pre></td></tr></table></figure><p><code>ingress.yaml</code>:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">my-ingress</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line">    <span class="string">nginx.ingress.kubernetes.io/rewrite-target:</span> <span class="string">/$1</span></span><br><span class="line">    <span class="string">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">"false"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">    - http:</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="attr">          - path:</span> <span class="string">/tomcat(.*)</span></span><br><span class="line"><span class="attr">            backend:</span></span><br><span class="line"><span class="attr">              serviceName:</span> <span class="string">tomcat-service</span></span><br><span class="line"><span class="attr">              servicePort:</span> <span class="number">30000</span></span><br></pre></td></tr></table></figure><h4 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h4><h4 id="示例说明"><a href="#示例说明" class="headerlink" title="示例说明"></a>示例说明</h4><p>示例中tomcat貌似无论怎么访问都是404，原因如下：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@tomcat-rs-4rpwj:/usr/local/tomcat# ls -lh</span><br><span class="line">total 128K</span><br><span class="line">-rw-r--r-- 1 root root  20K Mar 31 16:05 BUILDING.txt</span><br><span class="line">-rw-r--r-- 1 root root 6.1K Mar 31 16:05 CONTRIBUTING.md</span><br><span class="line">-rw-r--r-- 1 root root  56K Mar 31 16:05 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root 1.7K Mar 31 16:05 NOTICE</span><br><span class="line">-rw-r--r-- 1 root root 3.3K Mar 31 16:05 README.md</span><br><span class="line">-rw-r--r-- 1 root root 7.0K Mar 31 16:05 RELEASE-NOTES</span><br><span class="line">-rw-r--r-- 1 root root  17K Mar 31 16:05 RUNNING.txt</span><br><span class="line">drwxr-xr-x 2 root root 4.0K Apr  1 19:59 bin</span><br><span class="line">drwxr-xr-x 1 root root   22 Apr 13 17:00 conf</span><br><span class="line">drwxr-xr-x 2 root root 4.0K Apr  1 19:59 lib</span><br><span class="line">drwxrwxrwx 1 root root  220 Apr 14 02:34 logs</span><br><span class="line">drwxr-xr-x 2 root root  159 Apr  1 19:59 native-jni-lib</span><br><span class="line">drwxrwxrwx 2 root root   30 Apr  1 19:59 temp</span><br><span class="line">drwxr-xr-x 2 root root    6 Apr  1 19:59 webapps</span><br><span class="line">drwxr-xr-x 7 root root   81 Mar 31 16:05 webapps.dist</span><br><span class="line">drwxrwxrwx 2 root root    6 Mar 31 16:05 work</span><br><span class="line">root@tomcat-rs-4rpwj:/usr/local/tomcat# </span><br><span class="line">root@tomcat-rs-4rpwj:/usr/local/tomcat# </span><br><span class="line">root@tomcat-rs-4rpwj:/usr/local/tomcat# cd webapps</span><br><span class="line">root@tomcat-rs-4rpwj:/usr/local/tomcat/webapps# ls -lh</span><br><span class="line">total 0</span><br><span class="line">root@tomcat-rs-4rpwj:/usr/local/tomcat/webapps# cd ../webapps.dist/</span><br><span class="line">root@tomcat-rs-4rpwj:/usr/local/tomcat/webapps.dist# ls -lh</span><br><span class="line">total 4.0K</span><br><span class="line">drwxr-xr-x  3 root root  223 Apr  1 19:59 ROOT</span><br><span class="line">drwxr-xr-x 15 root root 4.0K Apr  1 19:59 docs</span><br><span class="line">drwxr-xr-x  7 root root   99 Apr  1 19:59 examples</span><br><span class="line">drwxr-xr-x  6 root root   79 Apr  1 19:59 host-manager</span><br><span class="line">drwxr-xr-x  6 root root  114 Apr  1 19:59 manager</span><br><span class="line">root@tomcat-rs-4rpwj:/usr/local/tomcat/webapps.dist# exit</span><br><span class="line">exit</span><br><span class="line">docker@minikube:~$ exit</span><br><span class="line">logout</span><br><span class="line">[wangyt@pseudo-cluster basic]$</span><br></pre></td></tr></table></figure><p><a href="https://kubernetes.io/zh/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener">Ingress</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;准备工作&quot;&gt;&lt;a href=&quot;#准备工作&quot; class=&quot;headerlink&quot; title=&quot;准备工作&quot;&gt;&lt;/a&gt;准备工作&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://yongtao.wang/2022/02/21/linux%E4%B8%8B%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%20&amp;amp;%20selinux/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;linux下关闭【防火墙 &amp;amp; seLinux】&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://yongtao.wang/2022/02/18/CentOS%207%E6%9B%B4%E6%96%B0%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CentOS 7更新到最新版本&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://yongtao.wang/2018/10/25/Docker%20install/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Docker install&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;安装kubectl&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://minikube.sigs.k8s.io/docs/start/?spm=a2c6h.12873639.0.0.ab202043NBm9C5&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;安装Minikube&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;注意docker需要使用非root账户运行，minikube也需要非root账户。&lt;/p&gt;
    
    </summary>
    
      <category term="k8s" scheme="http://yoursite.com/categories/k8s/"/>
    
      <category term="minikube" scheme="http://yoursite.com/categories/k8s/minikube/"/>
    
    
      <category term="k8s" scheme="http://yoursite.com/tags/k8s/"/>
    
      <category term="minikube" scheme="http://yoursite.com/tags/minikube/"/>
    
  </entry>
  
  <entry>
    <title>linux下关闭【防火墙 &amp; seLinux】</title>
    <link href="http://yoursite.com/2022/02/21/linux%E4%B8%8B%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%20&amp;%20selinux/"/>
    <id>http://yoursite.com/2022/02/21/linux下关闭防火墙 &amp; selinux/</id>
    <published>2022-02-21T11:26:00.000Z</published>
    <updated>2022-06-19T02:50:10.364Z</updated>
    
    <content type="html"><![CDATA[<h3 id="禁用seLinux"><a href="#禁用seLinux" class="headerlink" title="禁用seLinux"></a>禁用seLinux</h3><h4 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#  sestatus</span><br></pre></td></tr></table></figure><h4 id="暂时关闭"><a href="#暂时关闭" class="headerlink" title="暂时关闭"></a>暂时关闭</h4><p>暂时关闭，重启失效</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#  setenforce 0</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="永久关闭"><a href="#永久关闭" class="headerlink" title="永久关闭"></a>永久关闭</h4><p>设置<code>SELINUX=disabled</code>，需要重启。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat /etc/selinux/config</span></span><br><span class="line"><span class="comment"># This file controls the state of SELinux on the system.</span></span><br><span class="line"><span class="comment"># SELINUX= can take one of these three values:</span></span><br><span class="line"><span class="comment">#     enforcing - SELinux security policy is enforced.</span></span><br><span class="line"><span class="comment">#     permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class="line"><span class="comment">#     disabled - No SELinux policy is loaded.</span></span><br><span class="line">SELINUX=disabled</span><br><span class="line"><span class="comment"># SELINUXTYPE= can take one of these two values:</span></span><br><span class="line"><span class="comment">#     targeted - Targeted processes are protected,</span></span><br><span class="line"><span class="comment">#     mls - Multi Level Security protection.</span></span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></table></figure><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><h4 id="CentOS-7"><a href="#CentOS-7" class="headerlink" title="CentOS 7"></a>CentOS 7</h4><h4 id="查看状态-1"><a href="#查看状态-1" class="headerlink" title="查看状态"></a>查看状态</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --state</span><br></pre></td></tr></table></figure><p>或者<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl status firewalld</span><br></pre></td></tr></table></figure></p><h5 id="暂时关闭-1"><a href="#暂时关闭-1" class="headerlink" title="暂时关闭"></a>暂时关闭</h5><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl stop firewalld.service</span><br></pre></td></tr></table></figure><h5 id="永久关闭-1"><a href="#永久关闭-1" class="headerlink" title="永久关闭"></a>永久关闭</h5><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 禁止firewall开机启动</span></span><br><span class="line">[root@localhost ~]# systemctl disable firewalld.service</span><br></pre></td></tr></table></figure><h4 id="CentOS-6"><a href="#CentOS-6" class="headerlink" title="CentOS 6"></a>CentOS 6</h4><h5 id="查看状态-2"><a href="#查看状态-2" class="headerlink" title="查看状态"></a>查看状态</h5><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service iptables status</span><br></pre></td></tr></table></figure><h5 id="暂时关闭-2"><a href="#暂时关闭-2" class="headerlink" title="暂时关闭"></a>暂时关闭</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># service iptables stop</span></span><br></pre></td></tr></table></figure><h5 id="永久关闭-2"><a href="#永久关闭-2" class="headerlink" title="永久关闭"></a>永久关闭</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># chkconfig iptables off</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;禁用seLinux&quot;&gt;&lt;a href=&quot;#禁用seLinux&quot; class=&quot;headerlink&quot; title=&quot;禁用seLinux&quot;&gt;&lt;/a&gt;禁用seLinux&lt;/h3&gt;&lt;h4 id=&quot;查看状态&quot;&gt;&lt;a href=&quot;#查看状态&quot; class=&quot;headerlink&quot; title=&quot;查看状态&quot;&gt;&lt;/a&gt;查看状态&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]#  sestatus&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;暂时关闭&quot;&gt;&lt;a href=&quot;#暂时关闭&quot; class=&quot;headerlink&quot; title=&quot;暂时关闭&quot;&gt;&lt;/a&gt;暂时关闭&lt;/h4&gt;&lt;p&gt;暂时关闭，重启失效&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]#  setenforce 0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>Vmware下CentOS网络配置</title>
    <link href="http://yoursite.com/2022/02/18/vmware%E4%B8%8Bcentos%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/"/>
    <id>http://yoursite.com/2022/02/18/vmware下centos网络配置/</id>
    <published>2022-02-18T15:23:20.000Z</published>
    <updated>2022-06-19T02:50:10.364Z</updated>
    
    <content type="html"><![CDATA[<p>前提是虚拟机使用NET网络模式。</p><h3 id="查看Vmware-VMnet8网关地址"><a href="#查看Vmware-VMnet8网关地址" class="headerlink" title="查看Vmware VMnet8网关地址"></a>查看Vmware VMnet8网关地址</h3><p>Vmware -&gt; 编辑 -&gt; 虚拟网络编辑器</p><p>选中 VMnet8：</p><p><img src="https://objects.yongtao.wang/images/20220217/20220218152047.png" alt></p><a id="more"></a><p>Net设置…</p><p><img src="https://objects.yongtao.wang/images/20220217/20220218152118.png" alt></p><h3 id="修改DNS"><a href="#修改DNS" class="headerlink" title="修改DNS"></a>修改DNS</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/resolv.conf</span><br><span class="line">; generated by /usr/sbin/dhclient-script</span><br><span class="line">search localdomain</span><br><span class="line">nameserver 192.168.101.2</span><br></pre></td></tr></table></figure><h3 id="修改DNS1-amp-IPADDR-amp-GATEWAY"><a href="#修改DNS1-amp-IPADDR-amp-GATEWAY" class="headerlink" title="修改DNS1 &amp; IPADDR &amp; GATEWAY"></a>修改DNS1 &amp; IPADDR &amp; GATEWAY</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33 </span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">DNS1=192.168.101.2</span><br><span class="line">IPADDR=192.168.101.137</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.101.2</span><br></pre></td></tr></table></figure><p>设置完成后需要重启。</p><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>新的虚拟机也可以使用dhclient自动设置;</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前提是虚拟机使用NET网络模式。&lt;/p&gt;
&lt;h3 id=&quot;查看Vmware-VMnet8网关地址&quot;&gt;&lt;a href=&quot;#查看Vmware-VMnet8网关地址&quot; class=&quot;headerlink&quot; title=&quot;查看Vmware VMnet8网关地址&quot;&gt;&lt;/a&gt;查看Vmware VMnet8网关地址&lt;/h3&gt;&lt;p&gt;Vmware -&amp;gt; 编辑 -&amp;gt; 虚拟网络编辑器&lt;/p&gt;
&lt;p&gt;选中 VMnet8：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://objects.yongtao.wang/images/20220217/20220218152047.png&quot; alt&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="CentOS" scheme="http://yoursite.com/tags/CentOS/"/>
    
      <category term="Vmware" scheme="http://yoursite.com/tags/Vmware/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7更新到最新版本(7.9.2009)</title>
    <link href="http://yoursite.com/2022/02/18/CentOS%207%E6%9B%B4%E6%96%B0%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC/"/>
    <id>http://yoursite.com/2022/02/18/CentOS 7更新到最新版本/</id>
    <published>2022-02-18T14:34:20.000Z</published>
    <updated>2022-06-19T02:50:10.356Z</updated>
    
    <content type="html"><![CDATA[<h3 id="使用阿里云镜像替换CentOS默认yum源"><a href="#使用阿里云镜像替换CentOS默认yum源" class="headerlink" title="使用阿里云镜像替换CentOS默认yum源"></a>使用阿里云镜像替换CentOS默认yum源</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">[root@localhost ~]# sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">[root@localhost ~]# yum makecache</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="查看更新前版本"><a href="#查看更新前版本" class="headerlink" title="查看更新前版本"></a>查看更新前版本</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br></pre></td></tr></table></figure><h3 id="执行更新"><a href="#执行更新" class="headerlink" title="执行更新"></a>执行更新</h3><p>重要数据需要做好备份。</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum check-update</span><br><span class="line">[root@localhost ~]# yum clean all</span><br><span class="line">[root@localhost ~]# reboot</span><br><span class="line">[root@localhost ~]# yum update -y</span><br></pre></td></tr></table></figure><h3 id="查看更新后版本"><a href="#查看更新后版本" class="headerlink" title="查看更新后版本"></a>查看更新后版本</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.9.2009 (Core)</span><br></pre></td></tr></table></figure><p>参考资料：<br>1.<a href="https://developer.aliyun.com/mirror/centos?spm=a2c6h.13651102.0.0.49fe1b11CNfeGD" target="_blank" rel="noopener">CentOS 镜像</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;使用阿里云镜像替换CentOS默认yum源&quot;&gt;&lt;a href=&quot;#使用阿里云镜像替换CentOS默认yum源&quot; class=&quot;headerlink&quot; title=&quot;使用阿里云镜像替换CentOS默认yum源&quot;&gt;&lt;/a&gt;使用阿里云镜像替换CentOS默认yum源&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]# sed -i -e &#39;/mirrors.cloud.aliyuncs.com/d&#39; -e &#39;/mirrors.aliyuncs.com/d&#39; /etc/yum.repos.d/CentOS-Base.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]# yum makecache&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="CentOS" scheme="http://yoursite.com/tags/CentOS/"/>
    
      <category term="yum" scheme="http://yoursite.com/tags/yum/"/>
    
  </entry>
  
  <entry>
    <title>Gradle使用入门</title>
    <link href="http://yoursite.com/2022/02/17/Gradle%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/"/>
    <id>http://yoursite.com/2022/02/17/Gradle使用入门/</id>
    <published>2022-02-17T17:47:20.000Z</published>
    <updated>2022-06-19T02:50:10.360Z</updated>
    
    <content type="html"><![CDATA[<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装gradle</span></span><br><span class="line">choco install gradle</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>在<code>%HOMEPATH%\.gradle</code>创建<code>init.gradle</code>文件，内容如下：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url <span class="string">'https://maven.aliyun.com/repository/public/'</span> &#125;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; 安装gradle&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;choco install gradle&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="gradle" scheme="http://yoursite.com/tags/gradle/"/>
    
  </entry>
  
  <entry>
    <title>Windows下的包管理器chocolatey入门</title>
    <link href="http://yoursite.com/2022/02/17/Windows%E4%B8%8B%E7%9A%84%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8chocolatey%E5%85%A5%E9%97%A8/"/>
    <id>http://yoursite.com/2022/02/17/Windows下的包管理器chocolatey入门/</id>
    <published>2022-02-17T15:16:17.000Z</published>
    <updated>2022-06-19T02:50:10.364Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>一个<code>windows</code>包管理工具，类似<code>mac</code>下的<code>Homebrew</code>。</p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>打开powershell，执行如下命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Bypass -Scope <span class="keyword">Process</span> -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor <span class="number">3072</span>; iex ((<span class="built_in">New-Object</span> System.Net.WebClient).DownloadString(<span class="string">'https://community.chocolatey.org/install.ps1'</span>))</span><br></pre></td></tr></table></figure><a id="more"></a><p><img src="https://objects.yongtao.wang/images/20220217/20220217152250.png" alt="这里写图片描述"></p><h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 本地安装包列表</span></span><br><span class="line">choco list --local-only</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装包</span></span><br><span class="line">choco install &lt;package&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装指定版本</span></span><br><span class="line">choco install &lt;package&gt; -version &lt;版本号&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载包</span></span><br><span class="line">choco uninstall &lt;package&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 升级本地包</span></span><br><span class="line">choco upgrade &lt;package&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 搜索包相关</span></span><br><span class="line">choco search &lt;package&gt;</span><br><span class="line"></span><br><span class="line">choco list &lt;package&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 搜索所有版本</span></span><br><span class="line">choco search &lt;package&gt; -all</span><br></pre></td></tr></table></figure><p>More info: <a href="https://chocolatey.org/install#individual" target="_blank" rel="noopener">chocolatey install</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;一个&lt;code&gt;windows&lt;/code&gt;包管理工具，类似&lt;code&gt;mac&lt;/code&gt;下的&lt;code&gt;Homebrew&lt;/code&gt;。&lt;/p&gt;
&lt;h4 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h4&gt;&lt;p&gt;打开powershell，执行如下命令：&lt;/p&gt;
&lt;figure class=&quot;highlight powershell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Set-ExecutionPolicy&lt;/span&gt; Bypass -Scope &lt;span class=&quot;keyword&quot;&gt;Process&lt;/span&gt; -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor &lt;span class=&quot;number&quot;&gt;3072&lt;/span&gt;; iex ((&lt;span class=&quot;built_in&quot;&gt;New-Object&lt;/span&gt; System.Net.WebClient).DownloadString(&lt;span class=&quot;string&quot;&gt;&#39;https://community.chocolatey.org/install.ps1&#39;&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="包管理器" scheme="http://yoursite.com/categories/%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/"/>
    
      <category term="windows" scheme="http://yoursite.com/categories/%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/windows/"/>
    
    
      <category term="chocolatey" scheme="http://yoursite.com/tags/chocolatey/"/>
    
  </entry>
  
  <entry>
    <title>后端程序员的前端入门手册</title>
    <link href="http://yoursite.com/2022/02/16/%E5%90%8E%E7%AB%AF%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E5%89%8D%E7%AB%AF%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C/"/>
    <id>http://yoursite.com/2022/02/16/后端程序员的前端入门手册/</id>
    <published>2022-02-16T20:25:00.000Z</published>
    <updated>2022-06-19T02:50:10.364Z</updated>
    
    <content type="html"><![CDATA[<h3 id="基本内容"><a href="#基本内容" class="headerlink" title="基本内容"></a>基本内容</h3><p>本系列刊文旨在让后端程序员快速熟悉上手现代前端开发流程，化繁为简，节省大家宝贵的时间，多陪陪家人，追随内心，做一些想做的事情。</p><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul><li>安装nodejs，<a href="https://nodejs.org/en/" target="_blank" rel="noopener">https://nodejs.org/en/</a></li><li>设置国内源 <code>npm config set registry https://registry.npm.taobao.org/</code></li><li>全局安装 vue-cli、webpack、webpack-dev-serve等<ul><li><code>npm i -g yarn</code></li><li><code>npm install -g vue-cli</code></li><li><code>npm install -g webpack</code></li><li><code>npm install -g webpack-cli</code></li><li><code>npm install -g webpack-dev-server</code></li></ul></li><li>yarn设置国内源 <code>yarn config set registry https://registry.npm.taobao.org/</code></li></ul><a id="more"></a><h3 id="初始化vue项目"><a href="#初始化vue项目" class="headerlink" title="初始化vue项目"></a>初始化vue项目</h3><h4 id="vue-cli初始化"><a href="#vue-cli初始化" class="headerlink" title="vue-cli初始化"></a>vue-cli初始化</h4><p><code>vue ui</code> 或 <code>vue create</code></p><p><a href="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create" target="_blank" rel="noopener">https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</a></p><h4 id="vite初始化"><a href="#vite初始化" class="headerlink" title="vite初始化"></a>vite初始化</h4><p>Vite 是一个 web 开发构建工具，由于其原生 ES 模块导入方式，可以实现闪电般的冷服务器启动。</p><p>通过在终端中运行以下命令，可以使用 Vite 快速构建 Vue 项目。</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yarn create vite &lt;project-name&gt; --template vue</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> &lt;project-name&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn dev</span></span><br></pre></td></tr></table></figure><p><a href="https://v3.cn.vuejs.org/guide/installation.html#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-cli" target="_blank" rel="noopener">https://v3.cn.vuejs.org/guide/installation.html#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-cli</a></p><a href="!---![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192215.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192444.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192509.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216194509.png)--">!---![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192215.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192444.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192509.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216194509.png)--</a>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;基本内容&quot;&gt;&lt;a href=&quot;#基本内容&quot; class=&quot;headerlink&quot; title=&quot;基本内容&quot;&gt;&lt;/a&gt;基本内容&lt;/h3&gt;&lt;p&gt;本系列刊文旨在让后端程序员快速熟悉上手现代前端开发流程，化繁为简，节省大家宝贵的时间，多陪陪家人，追随内心，做一些想做的事情。&lt;/p&gt;
&lt;h3 id=&quot;准备工作&quot;&gt;&lt;a href=&quot;#准备工作&quot; class=&quot;headerlink&quot; title=&quot;准备工作&quot;&gt;&lt;/a&gt;准备工作&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;安装nodejs，&lt;a href=&quot;https://nodejs.org/en/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://nodejs.org/en/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;设置国内源 &lt;code&gt;npm config set registry https://registry.npm.taobao.org/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;全局安装 vue-cli、webpack、webpack-dev-serve等&lt;ul&gt;
&lt;li&gt;&lt;code&gt;npm i -g yarn&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;npm install -g vue-cli&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;npm install -g webpack&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;npm install -g webpack-cli&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;npm install -g webpack-dev-server&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;yarn设置国内源 &lt;code&gt;yarn config set registry https://registry.npm.taobao.org/&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="vue" scheme="http://yoursite.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>Kafka集群搭建测试</title>
    <link href="http://yoursite.com/2019/08/27/kafka%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/27/kafka集群搭建测试/</id>
    <published>2019-08-27T11:04:00.000Z</published>
    <updated>2019-08-27T11:04:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>单台机器搭建一个伪Kafka集群，用于测试学习。使用kafka内嵌的zookeeper。<br>生产环境应该使用独立的kafka集群。</p><table><thead><tr><th>broker.id</th><th>配置文件</th><th>主机</th><th>客户端连接端口</th></tr></thead><tbody><tr><td>3</td><td>server.3</td><td>192.168.101.146</td><td>9092</td></tr><tr><td>5</td><td>server.5</td><td>192.168.101.146</td><td>2182</td></tr><tr><td>7</td><td>server.7</td><td>192.168.101.146</td><td>2183</td></tr></tbody></table><a id="more"></a><h4 id="准备目录"><a href="#准备目录" class="headerlink" title="准备目录"></a>准备目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster kafka-cluster-test]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/kafka-cluster-test</span><br><span class="line">[root@pseudo-cluster kafka-cluster-test]<span class="comment"># ls -lh</span></span><br><span class="line">total 76K</span><br><span class="line">drwxr-xr-x. 3 wangyt wangyt 4.0K Aug 17  2021 bin</span><br><span class="line">drwxr-xr-x. 2 wangyt wangyt 4.0K Mar 29 02:09 config</span><br><span class="line">drwxr-xr-x. 6 wangyt wangyt   95 Aug 29  2019 k_data</span><br><span class="line">drwxr-xr-x. 2 wangyt wangyt 4.0K Aug 12  2019 libs</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  32K Jun 20  2019 LICENSE</span><br><span class="line">drwxr-xr-x. 2 wangyt wangyt  12K Mar 29 01:32 logs</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  337 Jun 20  2019 NOTICE</span><br><span class="line">drwxr-xr-x. 2 wangyt wangyt   81 Aug 17  2021 pids</span><br><span class="line">-rwxr-xr-x. 1 wangyt wangyt  248 Aug 12  2019 shutdown.sh</span><br><span class="line">drwxr-xr-x. 2 wangyt wangyt   44 Aug 12  2019 site-docs</span><br><span class="line">-rwxr-xr-x. 1 wangyt wangyt  394 Aug 12  2019 startup.sh</span><br><span class="line">[root@pseudo-cluster kafka-cluster-test]<span class="comment"># cd config/</span></span><br><span class="line">[root@pseudo-cluster config]<span class="comment"># ls -lh</span></span><br><span class="line">total 84K</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  906 Jun 20  2019 connect-console-sink.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  909 Jun 20  2019 connect-console-source.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 5.2K Jun 20  2019 connect-distributed.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  883 Jun 20  2019 connect-file-sink.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  881 Jun 20  2019 connect-file-source.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.6K Jun 20  2019 connect-log4j.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 2.3K Jun 20  2019 connect-standalone.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.2K Jun 20  2019 consumer.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 4.7K Jun 20  2019 log4j.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.9K Jun 20  2019 producer.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 6.8K Aug 29  2019 server-3.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 6.8K Aug 29  2019 server-5.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 6.8K Aug 29  2019 server-7.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.1K Jun 20  2019 tools-log4j.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.2K Jun 20  2019 trogdor.conf</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.1K Aug 29  2019 zookeeper.properties</span><br></pre></td></tr></table></figure><h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>config目录下复制三份server.properties，分别修改server-3、server-5、server-7</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">broker.id=3</span><br><span class="line">listeners=PLAINTEXT://192.168.91.146:9092</span><br><span class="line">log.dirs=k_data/kafka-logs-node3</span><br><span class="line">zookeeper.connect=localhost:2181</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">broker.id=5</span><br><span class="line">listeners=PLAINTEXT://192.168.91.146:9093</span><br><span class="line">log.dirs=k_data/kafka-logs-node5</span><br><span class="line">zookeeper.connect=localhost:2181</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">broker.id=7</span><br><span class="line">listeners=PLAINTEXT://192.168.91.146:9094</span><br><span class="line">log.dirs=k_data/kafka-logs-node7</span><br><span class="line">zookeeper.connect=localhost:2181</span><br></pre></td></tr></table></figure><p>zookeeper.properties配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dataDir=k_data/zookeeper</span><br><span class="line"><span class="comment"># the port at which the clients will connect</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></span><br><span class="line">maxClientCnxns=0</span><br></pre></td></tr></table></figure><h4 id="启停脚本"><a href="#启停脚本" class="headerlink" title="启停脚本"></a>启停脚本</h4><h5 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h5><p>startup.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">pidExt=<span class="string">'.pid'</span></span><br><span class="line">propExt=<span class="string">'.properties'</span></span><br><span class="line">nodes=(server-3 server-5 server-7)</span><br><span class="line"></span><br><span class="line"><span class="comment"># start zookeeper</span></span><br><span class="line">nohup ./bin/zookeeper-server-start.sh config/zookeeper.properties &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"$!"</span> &gt; ./pids/zoo<span class="variable">$pidExt</span></span><br><span class="line">sleep 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># start kafka cluster</span></span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;nodes[@]&#125;</span>"</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        nohup ./bin/kafka-server-start.sh config/<span class="variable">$val</span><span class="variable">$propExt</span> &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"$!"</span> &gt; ./pids/<span class="variable">$val</span><span class="variable">$pidExt</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h5 id="停止脚本"><a href="#停止脚本" class="headerlink" title="停止脚本"></a>停止脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">process_dir</span></span>() &#123;</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> `ls <span class="variable">$1</span>`</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">if</span> [ -d <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span> ]</span><br><span class="line">                <span class="keyword">then</span></span><br><span class="line">                        process_dir <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                        <span class="comment">#echo $1"/"$file `cat $1"/"$file`</span></span><br><span class="line">                        <span class="built_in">kill</span> -9 `cat <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span>`</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">process_dir ./pids</span><br><span class="line">rm -rf ./pids/*</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单台机器搭建一个伪Kafka集群，用于测试学习。使用kafka内嵌的zookeeper。&lt;br&gt;生产环境应该使用独立的kafka集群。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;broker.id&lt;/th&gt;
&lt;th&gt;配置文件&lt;/th&gt;
&lt;th&gt;主机&lt;/th&gt;
&lt;th&gt;客户端连接端口&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;server.3&lt;/td&gt;
&lt;td&gt;192.168.101.146&lt;/td&gt;
&lt;td&gt;9092&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;server.5&lt;/td&gt;
&lt;td&gt;192.168.101.146&lt;/td&gt;
&lt;td&gt;2182&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;server.7&lt;/td&gt;
&lt;td&gt;192.168.101.146&lt;/td&gt;
&lt;td&gt;2183&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="Kafka" scheme="http://yoursite.com/categories/Kafka/"/>
    
    
      <category term="Kafka" scheme="http://yoursite.com/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Zookeeper集群搭建测试</title>
    <link href="http://yoursite.com/2019/08/26/Zookeeper%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/26/Zookeeper集群搭建测试/</id>
    <published>2019-08-26T15:04:00.000Z</published>
    <updated>2019-08-26T15:04:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>单台机器搭建一个伪Zookeeper集群，用于测试学习。</p><table><thead><tr><th>节点</th><th>主机</th><th>客户端连接端口</th><th>follower连接leader端口</th><th>leader选举端口</th></tr></thead><tbody><tr><td>server.1</td><td>192.168.91.146</td><td>2181</td><td>2887</td><td>3887</td></tr><tr><td>server.2</td><td>192.168.91.146</td><td>2182</td><td>2888</td><td>3888</td></tr><tr><td>server.3</td><td>192.168.91.146</td><td>2183</td><td>2889</td><td>3889</td></tr></tbody></table><a id="more"></a><h4 id="准备目录"><a href="#准备目录" class="headerlink" title="准备目录"></a>准备目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster zookeeper-cluster-test]<span class="comment"># ls -lh</span></span><br><span class="line">total 8.0K</span><br><span class="line">-rwxr-xr-x. 1 root root 147 Aug 23 11:03 shutdown.sh</span><br><span class="line">-rwxr-xr-x. 1 root root 265 Aug 23 10:53 startup.sh</span><br><span class="line">drwxr-xr-x. 8 root root 166 Aug 22 16:58 zookeeper-3.5.5-server.1</span><br><span class="line">drwxr-xr-x. 8 root root 166 Aug 22 17:26 zookeeper-3.5.5-server.2</span><br><span class="line">drwxr-xr-x. 8 root root 166 Aug 22 17:26 zookeeper-3.5.5-server.3</span><br></pre></td></tr></table></figure><h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>分别修改server.1、server.2、server.3三个节点的<code>conf/zoo.cfg</code>配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The number of milliseconds of each tick</span></span><br><span class="line">tickTime=2000</span><br><span class="line"><span class="comment"># The number of ticks that the initial </span></span><br><span class="line"><span class="comment"># synchronization phase can take</span></span><br><span class="line">initLimit=5</span><br><span class="line"><span class="comment"># The number of ticks that can pass between </span></span><br><span class="line"><span class="comment"># sending a request and getting an acknowledgement</span></span><br><span class="line">syncLimit=2</span><br><span class="line"><span class="comment"># the directory where the snapshot is stored.</span></span><br><span class="line"><span class="comment"># do not use /tmp for storage, /tmp here is just </span></span><br><span class="line"><span class="comment"># example sakes.</span></span><br><span class="line">dataDir=__DATA_ZOO__/data</span><br><span class="line">dataLogDir=__DATA_ZOO__/logs</span><br><span class="line"><span class="comment"># the port at which the clients will connect</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="comment"># server.x=[hostname]:nnnnn[:nnnnn], etc : (No Java system property) servers making up the ZooKeeper ensemble. When the server starts up, it determines which server it is by looking for the file myid in the data directory. That file contains the server number, in ASCII, and it should match x in server.x in the left hand side of this setting. The list of servers that make up ZooKeeper servers that is used by the clients must match the list of ZooKeeper servers that each ZooKeeper server has. There are two port numbers nnnnn. The first followers use to connect to the leader, and the second is for leader election. If you want to test multiple servers on a single machine, then different ports can be used for each server.</span></span><br><span class="line">server.1=192.168.91.146:2887:3887</span><br><span class="line">server.2=192.168.91.146:2888:3888</span><br><span class="line">server.3=192.168.91.146:2889:3889</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line">dataDir=__DATA_ZOO__/data</span><br><span class="line">dataLogDir=__DATA_ZOO__/logs</span><br><span class="line">clientPort=2182</span><br><span class="line">server.1=192.168.91.146:2887:3887</span><br><span class="line">server.2=192.168.91.146:2888:3888</span><br><span class="line">server.3=192.168.91.146:2889:3889</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line">dataDir=__DATA_ZOO__/data</span><br><span class="line">dataLogDir=__DATA_ZOO__/logs</span><br><span class="line">clientPort=2183</span><br><span class="line">server.1=192.168.91.146:2887:3887</span><br><span class="line">server.2=192.168.91.146:2888:3888</span><br><span class="line">server.3=192.168.91.146:2889:3889</span><br></pre></td></tr></table></figure><h4 id="启停脚本"><a href="#启停脚本" class="headerlink" title="启停脚本"></a>启停脚本</h4><h5 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line">current_path=`<span class="built_in">pwd</span>`</span><br><span class="line">nodes=(zookeeper-3.5.5-server.1 zookeeper-3.5.5-server.2 zookeeper-3.5.5-server.3)</span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;nodes[@]&#125;</span>"</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    path=<span class="variable">$current_path</span>/<span class="variable">$val</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$path</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$path</span></span><br><span class="line">        ./bin/zkServer.sh start</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">jps -l | grep QuorumPeerMain</span><br></pre></td></tr></table></figure><h5 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster zookeeper-cluster-test]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/zookeeper-cluster-test</span><br><span class="line">[root@pseudo-cluster zookeeper-cluster-test]<span class="comment"># ./startup.sh </span></span><br><span class="line">/usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.1</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.1/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">/usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.2</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.2/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">/usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.3</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.3/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">56626 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">56739 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">56679 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">[root@pseudo-cluster zookeeper-cluster-test]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h5 id="查看集群"><a href="#查看集群" class="headerlink" title="查看集群"></a>查看集群</h5><h5 id="停止脚本"><a href="#停止脚本" class="headerlink" title="停止脚本"></a>停止脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">jps -l | grep QuorumPeerMain</span><br><span class="line"></span><br><span class="line"><span class="built_in">kill</span> -9 $(jps -l | grep org.apache.zookeeper.server.quorum.QuorumPeerMain | awk <span class="string">'&#123;&#123;print $1&#125;&#125;'</span>)</span><br></pre></td></tr></table></figure><h5 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster zookeeper-cluster-test]<span class="comment"># ./shutdown.sh </span></span><br><span class="line">56626 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">56739 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">56679 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单台机器搭建一个伪Zookeeper集群，用于测试学习。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;节点&lt;/th&gt;
&lt;th&gt;主机&lt;/th&gt;
&lt;th&gt;客户端连接端口&lt;/th&gt;
&lt;th&gt;follower连接leader端口&lt;/th&gt;
&lt;th&gt;leader选举端口&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;server.1&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;2181&lt;/td&gt;
&lt;td&gt;2887&lt;/td&gt;
&lt;td&gt;3887&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;server.2&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;2182&lt;/td&gt;
&lt;td&gt;2888&lt;/td&gt;
&lt;td&gt;3888&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;server.3&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;2183&lt;/td&gt;
&lt;td&gt;2889&lt;/td&gt;
&lt;td&gt;3889&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="Zookeeper" scheme="http://yoursite.com/categories/Zookeeper/"/>
    
    
      <category term="Zookeeper" scheme="http://yoursite.com/tags/Zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>The lifetime of a thread</title>
    <link href="http://yoursite.com/2019/08/22/The%20lifetime%20of%20a%20thread/"/>
    <id>http://yoursite.com/2019/08/22/The lifetime of a thread/</id>
    <published>2019-08-22T19:40:00.000Z</published>
    <updated>2019-08-22T19:40:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="The-lifetime-of-a-thread"><a href="#The-lifetime-of-a-thread" class="headerlink" title="The lifetime of a thread"></a>The lifetime of a thread</h1><h3 id="线程的状态"><a href="#线程的状态" class="headerlink" title="线程的状态"></a>线程的状态</h3><p>线程有六种状态，定义在<code>java.lang.Thread.State</code>内部枚举中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> State &#123;</span><br><span class="line">    NEW,</span><br><span class="line">    RUNNABLE,</span><br><span class="line">    BLOCKED,</span><br><span class="line">    WAITING,</span><br><span class="line">    TIMED_WAITING,</span><br><span class="line">    TERMINATED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>A thread state. A thread can be in one of the following states:</p><ul><li><strong>NEW</strong> A thread that has not yet started is in this state.</li><li><strong>RUNNABLE</strong> A thread executing in the Java virtual machine is in this state.</li><li><strong>BLOCKED</strong> A thread that is blocked waiting for a monitor lock is in this state. 处于此状态，线程被阻塞等待监视器锁</li><li><strong>WAITING</strong> A thread that is waiting indefinitely for another thread to perform a particular action is in this state. 无限期等待另外线程执行特定的动作，通常为唤醒等操作</li><li><strong>TIMED_WAITING</strong> A thread that is waiting for another thread to perform an action for up to a specified waiting time is in this state. 限期等待</li><li><strong>TERMINATED</strong> A thread that has exited is in this state.</li></ul><p>A thread can be in only one state at a given point in time. These states are virtual machine states which do not reflect any operating system thread states.</p><h3 id="线程的生命周期"><a href="#线程的生命周期" class="headerlink" title="线程的生命周期"></a>线程的生命周期</h3><p><img src="https://objects.yongtao.wang/images/20190903/java-thread-life-cycle-state.gif" alt="The lifetime of a thread.gif"><br>实现三个线程，其中Thread-01执行睡眠，Thread-02、Thread-03执行同步任务，jstack抓取堆栈信息，观察线程状态。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Thread thd01 =</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">120</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="comment">// ignore</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Thread-01"</span>);</span><br><span class="line"></span><br><span class="line">    Thread thd02 =</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            doSorting();</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Thread-02"</span>);</span><br><span class="line"></span><br><span class="line">    Thread thd03 =</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            doSorting();</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Thread-03"</span>);</span><br><span class="line"></span><br><span class="line">    thd01.start();</span><br><span class="line">    thd02.start();</span><br><span class="line">    thd03.start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSorting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">        <span class="comment">// 生成随机数组</span></span><br><span class="line">        <span class="keyword">double</span>[] a = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">100</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.length; i++) &#123;</span><br><span class="line">            a[i] = <span class="keyword">new</span> Random().nextDouble();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 对随机数组进行排序，使其消耗CPU</span></span><br><span class="line">        Arrays.sort(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>如堆栈信息所示，Thread-01处于TIMED_WAITING状态，Thread-02处于RUNNABLE状态，Thread-02处于BLOCKED状态。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&quot;Thread-03&quot; #13 prio=5 os_prio=0 tid=0x000000002092b000 nid=0x345c waiting for monitor entry [0x00000000214fe000]</span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState.doSorting(ThreadState.java:49)</span><br><span class="line">        - waiting to lock &lt;0x000000068280a830&gt; (a java.lang.Class for io.mysnippet.multithread.ThreadState)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState.lambda$main$2(ThreadState.java:37)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState$$Lambda$3/1078694789.run(Unknown Source)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line">&quot;Thread-02&quot; #12 prio=5 os_prio=0 tid=0x000000002092a000 nid=0x748 runnable [0x00000000213fe000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">        at io.mysnippet.multithread.ThreadState.doSorting(ThreadState.java:50)</span><br><span class="line">        - locked &lt;0x000000068280a830&gt; (a java.lang.Class for io.mysnippet.multithread.ThreadState)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState.lambda$main$1(ThreadState.java:30)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState$$Lambda$2/1096979270.run(Unknown Source)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line">&quot;Thread-01&quot; #11 prio=5 os_prio=0 tid=0x0000000020949800 nid=0x4494 waiting on condition [0x00000000212ff000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class="line">        at java.lang.Thread.sleep(Native Method)</span><br><span class="line">        at java.lang.Thread.sleep(Thread.java:340)</span><br><span class="line">        at java.util.concurrent.TimeUnit.sleep(TimeUnit.java:386)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState.lambda$main$0(ThreadState.java:20)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState$$Lambda$1/2003749087.run(Unknown Source)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;The-lifetime-of-a-thread&quot;&gt;&lt;a href=&quot;#The-lifetime-of-a-thread&quot; class=&quot;headerlink&quot; title=&quot;The lifetime of a thread&quot;&gt;&lt;/a&gt;The lifetime of a thread&lt;/h1&gt;&lt;h3 id=&quot;线程的状态&quot;&gt;&lt;a href=&quot;#线程的状态&quot; class=&quot;headerlink&quot; title=&quot;线程的状态&quot;&gt;&lt;/a&gt;线程的状态&lt;/h3&gt;&lt;p&gt;线程有六种状态，定义在&lt;code&gt;java.lang.Thread.State&lt;/code&gt;内部枚举中：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; State &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NEW,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RUNNABLE,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    BLOCKED,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    WAITING,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TIMED_WAITING,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TERMINATED;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="thread" scheme="http://yoursite.com/categories/thread/"/>
    
    
      <category term="thread" scheme="http://yoursite.com/tags/thread/"/>
    
      <category term="java" scheme="http://yoursite.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearch集群搭建测试</title>
    <link href="http://yoursite.com/2019/08/21/Elasticsearch%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/21/Elasticsearch集群搭建测试/</id>
    <published>2019-08-21T14:06:30.000Z</published>
    <updated>2019-08-21T14:06:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>单台机器搭建一个伪Elasticsearch集群，用于测试学习。</p><table><thead><tr><th>节点</th><th>主机</th><th>HTTP端口</th><th>TCP端口</th></tr></thead><tbody><tr><td>node-0</td><td>192.168.91.146</td><td>9200</td><td>9300</td></tr><tr><td>node-1</td><td>192.168.91.146</td><td>9201</td><td>9301</td></tr><tr><td>node-2</td><td>192.168.91.146</td><td>9202</td><td>9302</td></tr></tbody></table><a id="more"></a><h4 id="准备目录"><a href="#准备目录" class="headerlink" title="准备目录"></a>准备目录</h4><p>下载elasticsearch安装包，按照如下目录组织</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test</span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># ls -lh</span></span><br><span class="line">total 8.0K</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 155 Aug 11 03:22 es-6.6.2-node0</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 165 Aug 11 03:22 es-6.6.2-node1</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 155 Aug 11 03:22 es-6.6.2-node2</span><br><span class="line">-rwxr-xr-x. 1 elasticsearch elasticsearch 253 Aug  9 03:07 shutdown.sh</span><br><span class="line">-rwxr-xr-x. 1 elasticsearch elasticsearch 264 Aug  9 03:13 startup.sh</span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h4 id="添加用户-amp-组-amp-赋权"><a href="#添加用户-amp-组-amp-赋权" class="headerlink" title="添加用户&amp;组&amp;赋权"></a>添加用户&amp;组&amp;赋权</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># groupadd elasticsearch</span></span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># useradd elasticsearch -g elasticsearch</span></span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># chown -R elasticsearch.elasticsearch /usr/local/es-cluser-test</span></span><br></pre></td></tr></table></figure><h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>分别修改node0、node1、node2三个节点的<code>config/elasticsearch.yml</code>配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: es-pseudo-cluster</span><br><span class="line">node.name: node-0</span><br><span class="line">bootstrap.memory_lock: <span class="literal">true</span></span><br><span class="line">network.host: 192.168.91.146</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"192.168.91.146:9301"</span>, <span class="string">"192.168.91.146:9302"</span>]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: es-pseudo-cluster</span><br><span class="line">node.name: node-1</span><br><span class="line">bootstrap.memory_lock: <span class="literal">true</span></span><br><span class="line">network.host: 192.168.91.146</span><br><span class="line">http.port: 9201</span><br><span class="line">transport.tcp.port: 9301</span><br><span class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"192.168.91.146:9300"</span>, <span class="string">"192.168.91.146:9302"</span>]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: es-pseudo-cluster</span><br><span class="line">node.name: node-2</span><br><span class="line">bootstrap.memory_lock: <span class="literal">true</span></span><br><span class="line">network.host: 192.168.91.146</span><br><span class="line">http.port: 9202</span><br><span class="line">transport.tcp.port: 9302</span><br><span class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"192.168.91.146:9300"</span>, <span class="string">"192.168.91.146:9301"</span>]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br></pre></td></tr></table></figure><h4 id="启停脚本"><a href="#启停脚本" class="headerlink" title="启停脚本"></a>启停脚本</h4><h5 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">current_path=`<span class="built_in">pwd</span>`</span><br><span class="line">nodes=(es-6.6.2-node0 es-6.6.2-node1 es-6.6.2-node2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;nodes[@]&#125;</span>"</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    path=<span class="variable">$current_path</span>/<span class="variable">$val</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$path</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$path</span></span><br><span class="line">    ./bin/elasticsearch -d -p pid</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">ps -elf | grep -v <span class="string">'grep'</span> | grep Elasticsearch</span><br></pre></td></tr></table></figure><h5 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test</span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># ls -lh</span></span><br><span class="line">total 8.0K</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 155 Aug 14 03:52 es-6.6.2-node0</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 155 Aug 14 03:56 es-6.6.2-node1</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 155 Aug 14 03:56 es-6.6.2-node2</span><br><span class="line">-rwxr-xr-x. 1 elasticsearch elasticsearch 253 Aug  9 03:07 shutdown.sh</span><br><span class="line">-rwxr-xr-x. 1 elasticsearch elasticsearch 264 Aug 14 03:55 startup.sh</span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># </span></span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># su elasticsearch</span></span><br><span class="line">[elasticsearch@pseudo-cluster es-cluser-test]$ ./startup.sh </span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node0</span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node1</span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node2</span><br><span class="line">0 S elastic+  30162      1 99  80   0 - 776807 futex_ 03:57 pts/0   00:00:01 /usr/<span class="built_in">local</span>/jdk1.8.0_221/bin/java -Xms512m -Xmx512m -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=<span class="literal">true</span> -Dfile.encoding=UTF-8 -Djna.nosys=<span class="literal">true</span> -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=<span class="literal">true</span> -Dio.netty.noKeySetOptimization=<span class="literal">true</span> -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=<span class="literal">false</span> -Dlog4j2.disable.jmx=<span class="literal">true</span> -Djava.io.tmpdir=/tmp/elasticsearch-3768772128440104570 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:logs/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=32 -XX:GCLogFileSize=64m -Des.path.home=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node0 -Des.path.conf=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node0/config -Des.distribution.flavor=default -Des.distribution.type=tar -cp /usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node0/lib/* org.elasticsearch.bootstrap.Elasticsearch -d -p pid</span><br><span class="line">0 S elastic+  30238      1  0  80   0 - 773344 futex_ 03:57 pts/0   00:00:00 /usr/<span class="built_in">local</span>/jdk1.8.0_221/bin/java -Xms512m -Xmx512m -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=<span class="literal">true</span> -Dfile.encoding=UTF-8 -Djna.nosys=<span class="literal">true</span> -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=<span class="literal">true</span> -Dio.netty.noKeySetOptimization=<span class="literal">true</span> -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=<span class="literal">false</span> -Dlog4j2.disable.jmx=<span class="literal">true</span> -Djava.io.tmpdir=/tmp/elasticsearch-3776090600362042909 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:logs/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=32 -XX:GCLogFileSize=64m -Des.path.home=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node1 -Des.path.conf=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node1/config -Des.distribution.flavor=default -Des.distribution.type=tar -cp /usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node1/lib/* org.elasticsearch.bootstrap.Elasticsearch -d -p pid</span><br><span class="line">0 S elastic+  30314      1  0  80   0 - 25758 futex_ 03:57 pts/0    00:00:00 /usr/<span class="built_in">local</span>/jdk1.8.0_221/bin/java -Xms512m -Xmx512m -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=<span class="literal">true</span> -Dfile.encoding=UTF-8 -Djna.nosys=<span class="literal">true</span> -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=<span class="literal">true</span> -Dio.netty.noKeySetOptimization=<span class="literal">true</span> -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=<span class="literal">false</span> -Dlog4j2.disable.jmx=<span class="literal">true</span> -Djava.io.tmpdir=/tmp/elasticsearch-4360777951552716525 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:logs/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=32 -XX:GCLogFileSize=64m -Des.path.home=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node2 -Des.path.conf=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node2/config -Des.distribution.flavor=default -Des.distribution.type=tar -cp /usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node2/lib/* org.elasticsearch.bootstrap.Elasticsearch -d -p pid</span><br><span class="line">[elasticsearch@pseudo-cluster es-cluser-test]$</span><br></pre></td></tr></table></figure><h5 id="查看集群"><a href="#查看集群" class="headerlink" title="查看集群"></a>查看集群</h5><p>通过Elasticsearch Head查看集群</p><p><img src="https://objects.yongtao.wang/images/20190821/elasticsearch-pseudo-cluster.png" alt="elasticsearch-pseudo-cluster"></p><h5 id="停止脚本"><a href="#停止脚本" class="headerlink" title="停止脚本"></a>停止脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">current_path=`<span class="built_in">pwd</span>`</span><br><span class="line">nodes=(es-6.6.2-node0 es-6.6.2-node1 es-6.6.2-node2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;nodes[@]&#125;</span>"</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    path=<span class="variable">$current_path</span>/<span class="variable">$val</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$path</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$path</span></span><br><span class="line">    <span class="built_in">kill</span> -9 `cat pid` </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">ps -elf | grep -v <span class="string">'grep'</span> | grep Elasticsearch</span><br></pre></td></tr></table></figure><h5 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[elasticsearch@pseudo-cluster es-cluser-test]$ ./shutdown.sh </span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node0</span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node1</span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node2</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单台机器搭建一个伪Elasticsearch集群，用于测试学习。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;节点&lt;/th&gt;
&lt;th&gt;主机&lt;/th&gt;
&lt;th&gt;HTTP端口&lt;/th&gt;
&lt;th&gt;TCP端口&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;node-0&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;9200&lt;/td&gt;
&lt;td&gt;9300&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;node-1&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;9201&lt;/td&gt;
&lt;td&gt;9301&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;node-2&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;9202&lt;/td&gt;
&lt;td&gt;9302&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="elasticsearch" scheme="http://yoursite.com/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://yoursite.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Windows 10 去除快捷方式小箭头</title>
    <link href="http://yoursite.com/2019/08/10/Windows%2010%20%E5%8E%BB%E9%99%A4%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F%E5%B0%8F%E7%AE%AD%E5%A4%B4/"/>
    <id>http://yoursite.com/2019/08/10/Windows 10 去除快捷方式小箭头/</id>
    <published>2019-08-10T20:56:00.000Z</published>
    <updated>2019-08-10T20:56:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Windows-10-去除快捷方式小箭头"><a href="#Windows-10-去除快捷方式小箭头" class="headerlink" title="Windows 10 去除快捷方式小箭头"></a>Windows 10 去除快捷方式小箭头</h3><h4 id="去掉小箭头"><a href="#去掉小箭头" class="headerlink" title="去掉小箭头"></a>去掉小箭头</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">reg add <span class="string">"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Icons"</span> /v 29 /d <span class="string">"%systemroot%\system32\imageres.dll,197"</span> /t reg_sz /f</span><br><span class="line">taskkill /f /im explorer.exe</span><br><span class="line">attrib -s -r -h <span class="string">"%userprofile%\AppData\Local\iconcache.db"</span></span><br><span class="line">del <span class="string">"%userprofile%\AppData\Local\iconcache.db"</span> /f /q</span><br><span class="line">start explorer</span><br><span class="line">pause</span><br></pre></td></tr></table></figure><h4 id="恢复小箭头"><a href="#恢复小箭头" class="headerlink" title="恢复小箭头"></a>恢复小箭头</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">reg delete <span class="string">"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Icons"</span> /v 29 /f</span><br><span class="line">taskkill /f /im explorer.exe</span><br><span class="line">attrib -s -r -h <span class="string">"%userprofile%\AppData\Local\iconcache.db"</span></span><br><span class="line">del <span class="string">"%userprofile%\AppData\Local\iconcache.db"</span> /f /q</span><br><span class="line">start explorer</span><br><span class="line">pause</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Windows-10-去除快捷方式小箭头&quot;&gt;&lt;a href=&quot;#Windows-10-去除快捷方式小箭头&quot; class=&quot;headerlink&quot; title=&quot;Windows 10 去除快捷方式小箭头&quot;&gt;&lt;/a&gt;Windows 10 去除快捷方式小箭头&lt;/h3&gt;&lt;
      
    
    </summary>
    
    
  </entry>
  
</feed>
