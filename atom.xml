<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yongtao&#39;s Blog</title>
  
  <subtitle>坚守 无畏 宽容 进取</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2022-04-07T02:47:38.271Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>wangyt</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Telegraf + Kafka + Vector + ClickHouse 指标采集实现</title>
    <link href="http://yoursite.com/2022/04/06/Telegraf%20+%20Kafka%20+%20Vector%20+%20Clickhouse%20%E6%8C%87%E6%A0%87%E9%87%87%E9%9B%86%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/2022/04/06/Telegraf + Kafka + Vector + Clickhouse 指标采集实现/</id>
    <published>2022-04-06T10:32:00.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<p>本示例在windows环境下演示，绝大部分命令和linux通用。</p><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul><li><a href="https://docs.influxdata.com/telegraf/v1.22/" target="_blank" rel="noopener">telegraf</a>：指标收集工具，可收集中间件暴露的性能指标，本文中我们以收集redis指标为例。</li><li><a href="https://kafka.apache.org/quickstart" target="_blank" rel="noopener">kafka</a>：telegraf收集上来的指标上报到kafka，用于提高系统吞吐量。</li><li><a href="https://vector.dev/docs/" target="_blank" rel="noopener">vector</a>：高性能传输管道，支持多种源和目标，本示例中用于消费kafka消息，转换后，写入到ClickHouse中。</li><li><a href="https://clickhouse.com/docs/zh/" target="_blank" rel="noopener">clickhouse</a>: 列式存储数据库，适用于OLAP分析型场景。</li><li><a href="https://superset.apache.org/docs/intro" target="_blank" rel="noopener">superset</a>：轻量级BI工具，用于快速接入各种数据源实现数据展现。</li></ul><a id="more"></a><h3 id="启动redis用于演示"><a href="#启动redis用于演示" class="headerlink" title="启动redis用于演示"></a>启动redis用于演示</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\Redis-x64-3.0.504&gt; <span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line">Path</span><br><span class="line">----</span><br><span class="line">D:\dev_app\Redis-x64-3.0.504</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS D:\dev_app\Redis-x64-3.0.504&gt; .\redis-server.exe</span><br><span class="line">[10572] 06 Apr 17:10:45.476 <span class="comment"># Warning: no config file specified, using the default config. In order to specify a config file use D:\dev_app\Redis-x64-3.0.504\redis-server.exe /path/to/redis.conf</span></span><br><span class="line">                _._</span><br><span class="line">           _.-``__ <span class="string">''</span>-._</span><br><span class="line">      _.-``    `.  `_.  <span class="string">''</span>-._           Redis 3.0.504 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">''</span>-._</span><br><span class="line"> (    <span class="string">'      ,       .-`  | `,    )     Running in standalone mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|'</span>` _.-<span class="string">'|     Port: 6379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-'</span>    |     PID: 10572</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">'    _.-'</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |           http://redis.io</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span></span><br><span class="line">      `-._    `-.__.-<span class="string">'    _.-'</span></span><br><span class="line">          `-._        _.-<span class="string">'</span></span><br><span class="line"><span class="string">              `-.__.-'</span></span><br><span class="line"></span><br><span class="line">[10572] 06 Apr 17:10:45.483 <span class="comment"># Server started, Redis version 3.0.504</span></span><br><span class="line">[10572] 06 Apr 17:10:45.484 * DB loaded from disk: 0.001 seconds</span><br><span class="line">[10572] 06 Apr 17:10:45.484 * The server is now ready to accept connections on port 6379</span><br></pre></td></tr></table></figure><h3 id="telegraf"><a href="#telegraf" class="headerlink" title="telegraf"></a>telegraf</h3><p>telegraf采集redis指标，<a href="https://github.com/influxdata/telegraf/tree/master/plugins/inputs/redis" target="_blank" rel="noopener">https://github.com/influxdata/telegraf/tree/master/plugins/inputs/redis</a></p><p>可以看到主要是通过执行redis的info命令实现的</p><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[global_tags]</span><br><span class="line"></span><br><span class="line">[agent]</span><br><span class="line">  interval = &quot;10s&quot;</span><br><span class="line">  round_interval = true</span><br><span class="line">  metric_batch_size = 1000</span><br><span class="line">  metric_buffer_limit = 10000</span><br><span class="line">  collection_jitter = &quot;0s&quot;</span><br><span class="line">  flush_interval = &quot;10s&quot;</span><br><span class="line">  flush_jitter = &quot;0s&quot;</span><br><span class="line">  precision = &quot;0s&quot;</span><br><span class="line">  hostname = &quot;&quot;</span><br><span class="line">  omit_hostname = false</span><br><span class="line"></span><br><span class="line">[[inputs.redis]]</span><br><span class="line">  servers = [&quot;tcp://localhost:6379&quot;]</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>将采集的redis指标打印到控制台</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\collectors\telegraf-1.22.0&gt; .\telegraf.exe --config .\telegraf.properties --<span class="built_in">test</span> --input-filter redis</span><br><span class="line">2022-04-06T09:58:49Z I! Starting Telegraf 1.22.0</span><br><span class="line">2022-04-06T09:58:49Z I! Loaded inputs: redis</span><br><span class="line">2022-04-06T09:58:49Z I! Loaded aggregators:</span><br><span class="line">2022-04-06T09:58:49Z I! Loaded processors:</span><br><span class="line">2022-04-06T09:58:49Z W! Outputs are not used <span class="keyword">in</span> testing mode!</span><br><span class="line">2022-04-06T09:58:49Z I! Tags enabled: host=wangyt16577</span><br><span class="line">&gt; redis_cmdstat,<span class="built_in">command</span>=info,host=wangyt16577,port=6379,replication_role=master,server=localhost calls=3i,usec=248i,usec_per_call=82.67 1649239129000000000</span><br><span class="line">&gt; redis_keyspace,database=db0,host=wangyt16577,port=6379,replication_role=master,server=localhost avg_ttl=0i,expires=0i,keys=46i 1649239129000000000</span><br><span class="line">&gt; redis,host=wangyt16577,port=6379,replication_role=master,server=localhost aof_current_rewrite_time_sec=-1i,aof_enabled=0i,aof_last_bgrewrite_status=<span class="string">"ok"</span>,aof_last_rewrite_time_sec=-1i,aof_last_write_status=<span class="string">"ok"</span>,aof_rewrite_in_progress=0i,aof_rewrite_scheduled=0i,blocked_clients=0i,client_biggest_input_buf=0i,client_longest_output_list=0i,clients=1i,cluster_enabled=0i,connected_slaves=0i,evicted_keys=0i,expired_keys=0i,instantaneous_input_kbps=0,instantaneous_ops_per_sec=0i,instantaneous_output_kbps=0,keyspace_hitrate=0,keyspace_hits=0i,keyspace_misses=0i,latest_fork_usec=0i,loading=0i,lru_clock=5071960i,master_repl_offset=0i,mem_fragmentation_ratio=0.92,migrate_cached_sockets=0i,pubsub_channels=0i,pubsub_patterns=0i,rdb_bgsave_in_progress=0i,rdb_changes_since_last_save=0i,rdb_current_bgsave_time_sec=-1i,rdb_last_bgsave_status=<span class="string">"ok"</span>,rdb_last_bgsave_time_sec=-1i,rdb_last_save_time=1649236245i,rdb_last_save_time_elapsed=2884i,redis_version=<span class="string">"3.0.504"</span>,rejected_connections=0i,repl_backlog_active=0i,repl_backlog_first_byte_offset=0i,repl_backlog_histlen=0i,repl_backlog_size=1048576i,sync_full=0i,sync_partial_err=0i,sync_partial_ok=0i,total_commands_processed=3i,total_connections_received=4i,total_net_input_bytes=92i,total_net_output_bytes=5843i,uptime=2883i,used_cpu_sys=0.13,used_cpu_sys_children=0,used_cpu_user=0.08,used_cpu_user_children=0,used_memory=757248i,used_memory_lua=36864i,used_memory_peak=757248i,used_memory_rss=698688i 1649239129000000000</span><br><span class="line">PS D:\dev_app\collectors\telegraf-1.22.0&gt;</span><br></pre></td></tr></table></figure><p>注意指标的格式：</p><p><code>redis_cmdstat,command=info,host=myhost,port=6379,replication_role=master,server=localhost calls=3i,usec=248i,usec_per_call=82.67 1649239129000000000</code></p><p>分为了四部分，对等的json格式为：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"fields"</span>: &#123;</span><br><span class="line"><span class="attr">"calls"</span>: <span class="number">3</span>,</span><br><span class="line"><span class="attr">"usec"</span>: <span class="number">248</span>,</span><br><span class="line"><span class="attr">"usec_per_call"</span>: <span class="number">82.67</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"name"</span>: <span class="string">"redis_cmdstat"</span>,</span><br><span class="line"><span class="attr">"tags"</span>: &#123;</span><br><span class="line"><span class="attr">"command"</span>: <span class="string">"info"</span>,</span><br><span class="line"><span class="attr">"host"</span>: <span class="string">"myhost"</span>,</span><br><span class="line"><span class="attr">"port"</span>: <span class="string">"6379"</span>,</span><br><span class="line"><span class="attr">"replication_role"</span>: <span class="string">"master"</span>,</span><br><span class="line"><span class="attr">"server"</span>: <span class="string">"localhost"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"timestamp"</span>: <span class="number">1649239129</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="kafka"><a href="#kafka" class="headerlink" title="kafka"></a>kafka</h3><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><h5 id="启动kafka内置的zookeeper"><a href="#启动kafka内置的zookeeper" class="headerlink" title="启动kafka内置的zookeeper"></a>启动kafka内置的zookeeper</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: D:\dev_app\kafka_2.13-3.1.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">d-----         2022/1/12     17:07                bin</span><br><span class="line">d-----         2022/1/12     17:07                config</span><br><span class="line">d-----         2022/1/12     17:07                libs</span><br><span class="line">d-----         2022/1/12     17:07                licenses</span><br><span class="line">d-----          2022/4/6     18:33                logs</span><br><span class="line">d-----         2022/1/12     17:07                site-docs</span><br><span class="line">d-----         2022/3/31     16:19                tmp</span><br><span class="line">-a----         2022/1/12     17:01          14536 LICENSE</span><br><span class="line">-a----         2022/1/12     17:01          28184 NOTICE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ./bin/windows/zookeeper-server-start.bat ./config/zookeeper.properties</span><br></pre></td></tr></table></figure><h5 id="启动kafka"><a href="#启动kafka" class="headerlink" title="启动kafka"></a>启动kafka</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ./bin/windows/kafka-server-start.bat ./config/server.properties</span><br></pre></td></tr></table></figure><h5 id="创建一个topic"><a href="#创建一个topic" class="headerlink" title="创建一个topic"></a>创建一个topic</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 创建一个topic</span></span><br><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ./bin/windows/kafka-topics.bat --create --topic telegraf --bootstrap-server localhost:9092</span><br><span class="line">Created topic telegraf.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 列出所有topic</span></span><br><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ./bin/windows/kafka-topics.bat --list --bootstrap-server localhost:9092</span><br><span class="line">telegraf</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看topic详情</span></span><br><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt; ./bin/windows/kafka-topics.bat --describe --topic telegraf --bootstrap-server localhost:9092</span><br><span class="line">Topic: telegraf TopicId: 7rVMZCJXTSa2Gp8opDA_Uw PartitionCount: 1       ReplicationFactor: 1    Configs: segment.bytes=1073741824</span><br><span class="line">        Topic: telegraf Partition: 0    Leader: 0       Replicas: 0     Isr: 0</span><br><span class="line">PS D:\dev_app\kafka_2.13-3.1.0&gt;</span><br></pre></td></tr></table></figure><h5 id="telegraf配置"><a href="#telegraf配置" class="headerlink" title="telegraf配置"></a>telegraf配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[[outputs.kafka]]</span><br><span class="line">  brokers = [&quot;localhost:9092&quot;]</span><br><span class="line">  topic = &quot;telegraf&quot;</span><br><span class="line">  data_format = &quot;json&quot;</span><br><span class="line">  json_timestamp_units = &quot;1ms&quot;</span><br></pre></td></tr></table></figure><h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><p>在本示例中，我们使用vector消费kafka中的数据，输出给clickhouse。</p><h4 id="快速上手vector"><a href="#快速上手vector" class="headerlink" title="快速上手vector"></a>快速上手vector</h4><p>先通过几个小示例感受下vector：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\collectors\vector-0.20.0&gt; <span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line">Path</span><br><span class="line">----</span><br><span class="line">D:\dev_app\collectors\vector-0.20.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS D:\dev_app\collectors\vector-0.20.0&gt; ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: D:\dev_app\collectors\vector-0.20.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">d-----         2022/3/28     16:24                bin</span><br><span class="line">d-----          2022/4/1     10:56                config</span><br><span class="line">d-----         2022/3/28     16:24                data</span><br><span class="line">-a----         2022/2/10     23:54          16811 LICENSE.txt</span><br><span class="line">-a----          2022/2/9     18:57          17760 README.md.txt</span><br></pre></td></tr></table></figure><p>config目录下增加一个配置文件myconfig.toml内容如下：<br>表示从标准输入设备接收，输出到控制台</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[sources.in]</span><br><span class="line">type = &quot;stdin&quot;</span><br><span class="line"></span><br><span class="line">[sinks.out]</span><br><span class="line">inputs = [&quot;in&quot;]</span><br><span class="line">type = &quot;console&quot;</span><br><span class="line">encoding.codec = &quot;json&quot;</span><br></pre></td></tr></table></figure><p>执行测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PS D:\dev_app\collectors\vector-0.20.0&gt; <span class="built_in">echo</span> <span class="string">'Hello world!'</span> | ./bin/vector.exe --config ./config/myconfig.toml</span><br><span class="line">2022-04-06T11:13:23.093723Z  INFO vector::app: Log level is enabled. level=<span class="string">"vector=info,codec=info,vrl=info,file_source=info,tower_limit=trace,rdkafka=info,buffers=info"</span></span><br><span class="line">2022-04-06T11:13:23.095105Z  INFO vector::app: Loading configs. paths=[<span class="string">"config\\myconfig.toml"</span>]</span><br><span class="line">2022-04-06T11:13:23.100891Z  INFO vector::sources::stdin: Capturing STDIN.</span><br><span class="line">2022-04-06T11:13:23.101194Z  INFO vector::topology::running: Running healthchecks.</span><br><span class="line">2022-04-06T11:13:23.101366Z  INFO vector::topology::builder: Healthcheck: Passed.</span><br><span class="line">2022-04-06T11:13:23.101421Z  INFO vector::topology::running: Starting <span class="built_in">source</span>. key=<span class="keyword">in</span></span><br><span class="line">2022-04-06T11:13:23.101652Z  INFO vector::topology::running: Starting sink. key=out</span><br><span class="line">2022-04-06T11:13:23.101947Z  INFO vector: Vector has started. debug=<span class="string">"false"</span> version=<span class="string">"0.20.0"</span> arch=<span class="string">"x86_64"</span> build_id=<span class="string">"2a706a3 2022-02-10"</span></span><br><span class="line">2022-04-06T11:13:23.102098Z  INFO vector::app: API is disabled, <span class="built_in">enable</span> by setting `api.enabled` to `<span class="literal">true</span>` and use commands like `vector top`.</span><br><span class="line">2022-04-06T11:13:23.102138Z  INFO <span class="built_in">source</span>&#123;component_kind=<span class="string">"source"</span> component_id=<span class="keyword">in</span> component_type=stdin component_name=<span class="keyword">in</span>&#125;: vector::sources::stdin: Finished sending.</span><br><span class="line">2022-04-06T11:13:23.102229Z  INFO vector::shutdown: All sources have finished.</span><br><span class="line">2022-04-06T11:13:23.102394Z  INFO vector: Vector has stopped.</span><br><span class="line">&#123;<span class="string">"host"</span>:<span class="string">"wangyt16577"</span>,<span class="string">"message"</span>:<span class="string">"Hello world!\r"</span>,<span class="string">"source_type"</span>:<span class="string">"stdin"</span>,<span class="string">"timestamp"</span>:<span class="string">"2022-04-06T11:13:23.101995900Z"</span>&#125;</span><br><span class="line">PS D:\dev_app\collectors\vector-0.20.0&gt;</span><br></pre></td></tr></table></figure><p>快速入门可参考：<a href="https://vector.dev/docs/setup/quickstart/" target="_blank" rel="noopener">https://vector.dev/docs/setup/quickstart/</a></p><h4 id="vector配置"><a href="#vector配置" class="headerlink" title="vector配置"></a>vector配置</h4><p>clickhouse中要事先创建好相关表，见下节。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 消费kafka ###</span></span><br><span class="line">[sources.kafka_source_001]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"kafka"</span></span><br><span class="line">bootstrap_servers = <span class="string">"localhost:9092"</span></span><br><span class="line">group_id = <span class="string">"consumer-group-name"</span></span><br><span class="line">key_field = <span class="string">"message_key"</span></span><br><span class="line">topics = [ <span class="string">"telegraf"</span> ]</span><br><span class="line"></span><br><span class="line"><span class="comment">### json字符串转成json对象 ###</span></span><br><span class="line">[transforms.transforms_parse_json]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"remap"</span></span><br><span class="line">inputs = [ <span class="string">"kafka_source_001"</span> ]</span><br><span class="line"><span class="built_in">source</span> = <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">. = parse_json!(.message)</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### redis_cmdstat 类型数据处理 ###</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 过滤出redis_cmdstat类型数据</span></span><br><span class="line">[transforms.redis_cmdstat]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"filter"</span></span><br><span class="line">inputs = [ <span class="string">"transforms_parse_json"</span> ]</span><br><span class="line">condition = &#123; <span class="built_in">type</span> = <span class="string">"vrl"</span>, <span class="built_in">source</span> = <span class="string">'.name == "redis_cmdstat"'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 将redis_cmdstat类型数据转换成一层json结构</span></span><br><span class="line">[transforms.redis_cmdstat_remap]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"remap"</span></span><br><span class="line">inputs = [ <span class="string">"redis_cmdstat"</span> ]</span><br><span class="line"><span class="built_in">source</span> = <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">.fields.timestamp = .timestamp</span></span><br><span class="line"><span class="string">.fields.name = .name</span></span><br><span class="line"><span class="string">.fields.command = .tags.command</span></span><br><span class="line"><span class="string">.fields.host = .tags.host</span></span><br><span class="line"><span class="string">.fields.port = .tags.port</span></span><br><span class="line"><span class="string">.fields.replication_role = .tags.replication_role</span></span><br><span class="line"><span class="string">.fields.server = .tags.server</span></span><br><span class="line"><span class="string">. = .fields</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 转换好的数据输出到clickhouse中</span></span><br><span class="line">[sinks.redis_cmdstat_out]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"clickhouse"</span></span><br><span class="line">inputs = [ <span class="string">"redis_cmdstat_remap"</span> ]</span><br><span class="line">database = <span class="string">"mydb"</span></span><br><span class="line">endpoint = <span class="string">"http://localhost:8123"</span></span><br><span class="line">auth.strategy = <span class="string">"basic"</span></span><br><span class="line">auth.password = <span class="string">"password"</span></span><br><span class="line">auth.user = <span class="string">"default"</span></span><br><span class="line">table = <span class="string">"t_redis_cmd_stat"</span></span><br><span class="line">compression = <span class="string">"gzip"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### redis_keyspace ###</span></span><br><span class="line"></span><br><span class="line">[transforms.redis_keyspace]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"filter"</span></span><br><span class="line">inputs = [ <span class="string">"transforms_parse_json"</span> ]</span><br><span class="line">condition = &#123; <span class="built_in">type</span> = <span class="string">"vrl"</span>, <span class="built_in">source</span> = <span class="string">'.name == "redis_keyspace"'</span> &#125;</span><br><span class="line"></span><br><span class="line">[transforms.redis_keyspace_remap]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"remap"</span></span><br><span class="line">inputs = [ <span class="string">"redis_keyspace"</span> ]</span><br><span class="line"><span class="built_in">source</span> = <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">.fields.timestamp = .timestamp</span></span><br><span class="line"><span class="string">.fields.name = .name</span></span><br><span class="line"><span class="string">.fields.database = .tags.database</span></span><br><span class="line"><span class="string">.fields.host = .tags.host</span></span><br><span class="line"><span class="string">.fields.port = .tags.port</span></span><br><span class="line"><span class="string">.fields.replication_role = .tags.replication_role</span></span><br><span class="line"><span class="string">.fields.server = .tags.server</span></span><br><span class="line"><span class="string">. = .fields</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[sinks.redis_keyspace_out]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"clickhouse"</span></span><br><span class="line">inputs = [ <span class="string">"redis_cmdstat_remap"</span> ]</span><br><span class="line">database = <span class="string">"mydb"</span></span><br><span class="line">endpoint = <span class="string">"http://localhost:8123"</span></span><br><span class="line">auth.strategy = <span class="string">"basic"</span></span><br><span class="line">auth.password = <span class="string">"password"</span></span><br><span class="line">auth.user = <span class="string">"default"</span></span><br><span class="line">table = <span class="string">"t_redis_cmd_stat"</span></span><br><span class="line">compression = <span class="string">"gzip"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### redis ###</span></span><br><span class="line"></span><br><span class="line">[transforms.redis]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"filter"</span></span><br><span class="line">inputs = [ <span class="string">"transforms_parse_json"</span> ]</span><br><span class="line">condition = &#123; <span class="built_in">type</span> = <span class="string">"vrl"</span>, <span class="built_in">source</span> = <span class="string">'.name == "redis"'</span> &#125;</span><br><span class="line"></span><br><span class="line">[transforms.redis_remap]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"remap"</span></span><br><span class="line">inputs = [ <span class="string">"redis"</span> ]</span><br><span class="line"><span class="built_in">source</span> = <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">.fields.timestamp = .timestamp</span></span><br><span class="line"><span class="string">.fields.name = .name</span></span><br><span class="line"><span class="string">.fields.host = .tags.host</span></span><br><span class="line"><span class="string">.fields.port = .tags.port</span></span><br><span class="line"><span class="string">.fields.replication_role = .tags.replication_role</span></span><br><span class="line"><span class="string">.fields.server = .tags.server</span></span><br><span class="line"><span class="string">. = .fields</span></span><br><span class="line"><span class="string">'</span><span class="string">''</span></span><br><span class="line"></span><br><span class="line">[sinks.redis_out]</span><br><span class="line"><span class="built_in">type</span> = <span class="string">"clickhouse"</span></span><br><span class="line">inputs = [ <span class="string">"redis_cmdstat_remap"</span> ]</span><br><span class="line">database = <span class="string">"mydb"</span></span><br><span class="line">endpoint = <span class="string">"http://localhost:8123"</span></span><br><span class="line">auth.strategy = <span class="string">"basic"</span></span><br><span class="line">auth.password = <span class="string">"password"</span></span><br><span class="line">auth.user = <span class="string">"default"</span></span><br><span class="line">table = <span class="string">"t_redis_cmd_stat"</span></span><br><span class="line">compression = <span class="string">"gzip"</span></span><br></pre></td></tr></table></figure><h3 id="clickhouse"><a href="#clickhouse" class="headerlink" title="clickhouse"></a>clickhouse</h3><h4 id="创建表语句"><a href="#创建表语句" class="headerlink" title="创建表语句"></a>创建表语句</h4><p>t_redis_keyspace_stat</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_redis_keyspace_stat</span><br><span class="line">(</span><br><span class="line">    <span class="string">`timestamp`</span> DateTime64(<span class="number">3</span>, <span class="string">'Asia/Shanghai'</span>),</span><br><span class="line">    <span class="string">`host`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`server`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`port`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`replication_role`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`name`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`database`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`avg_ttl`</span> Float64,</span><br><span class="line">    <span class="string">`expires`</span> Float64,</span><br><span class="line">    <span class="string">`keys`</span> Float64</span><br><span class="line">)</span><br><span class="line"><span class="keyword">ENGINE</span> = MergeTree()</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> toYYYYMM(<span class="keyword">timestamp</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (<span class="keyword">timestamp</span>)</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>t_redis_cmd_stat</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_redis_cmd_stat</span><br><span class="line">(</span><br><span class="line">    <span class="string">`timestamp`</span> DateTime64(<span class="number">3</span>, <span class="string">'Asia/Shanghai'</span>),</span><br><span class="line">    <span class="string">`host`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`server`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`port`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`replication_role`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`name`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`command`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`calls`</span> Float64,</span><br><span class="line">    <span class="string">`usec`</span> Float64,</span><br><span class="line">    <span class="string">`usec_per_call`</span> Float64</span><br><span class="line">)</span><br><span class="line"><span class="keyword">ENGINE</span> = MergeTree()</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> toYYYYMM(<span class="keyword">timestamp</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (<span class="keyword">timestamp</span>)</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>t_redis_stat</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_redis_stat</span><br><span class="line">(</span><br><span class="line">    <span class="string">`timestamp`</span> DateTime64(<span class="number">3</span>, <span class="string">'Asia/Shanghai'</span>),</span><br><span class="line">    <span class="string">`host`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`port`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`server`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`replication_role`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`name`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`aof_current_rewrite_time_sec`</span> Float64,</span><br><span class="line">    <span class="string">`aof_enabled`</span> Float64,</span><br><span class="line">    <span class="string">`aof_last_bgrewrite_status`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`aof_last_rewrite_time_sec`</span> Float64,</span><br><span class="line">    <span class="string">`aof_last_write_status`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`aof_rewrite_in_progress`</span> Float64,</span><br><span class="line">    <span class="string">`aof_rewrite_scheduled`</span> Float64,</span><br><span class="line">    <span class="string">`blocked_clients`</span> Float64,</span><br><span class="line">    <span class="string">`client_biggest_input_buf`</span> Float64,</span><br><span class="line">    <span class="string">`client_longest_output_list`</span> Float64,</span><br><span class="line">    <span class="string">`clients`</span> Float64,</span><br><span class="line">    <span class="string">`cluster_enabled`</span> Float64,</span><br><span class="line">    <span class="string">`connected_slaves`</span> Float64,</span><br><span class="line">    <span class="string">`evicted_keys`</span> Float64,</span><br><span class="line">    <span class="string">`expired_keys`</span> Float64,</span><br><span class="line">    <span class="string">`instantaneous_input_kbps`</span> Float64,</span><br><span class="line">    <span class="string">`instantaneous_ops_per_sec`</span> Float64,</span><br><span class="line">    <span class="string">`instantaneous_output_kbps`</span> Float64,</span><br><span class="line">    <span class="string">`keyspace_hitrate`</span> Float64,</span><br><span class="line">    <span class="string">`keyspace_hits`</span> Float64,</span><br><span class="line">    <span class="string">`keyspace_misses`</span> Float64,</span><br><span class="line">    <span class="string">`latest_fork_usec`</span> Float64,</span><br><span class="line">    <span class="string">`loading`</span> Float64,</span><br><span class="line">    <span class="string">`lru_clock`</span> Float64,</span><br><span class="line">    <span class="string">`master_repl_offset`</span> Float64,</span><br><span class="line">    <span class="string">`mem_fragmentation_ratio`</span> Float64,</span><br><span class="line">    <span class="string">`migrate_cached_sockets`</span> Float64,</span><br><span class="line">    <span class="string">`pubsub_channels`</span> Float64,</span><br><span class="line">    <span class="string">`pubsub_patterns`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_bgsave_in_progress`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_changes_since_last_save`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_current_bgsave_time_sec`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_last_bgsave_status`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`rdb_last_bgsave_time_sec`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_last_save_time`</span> Float64,</span><br><span class="line">    <span class="string">`rdb_last_save_time_elapsed`</span> Float64,</span><br><span class="line">    <span class="string">`redis_version`</span> <span class="keyword">String</span>,</span><br><span class="line">    <span class="string">`rejected_connections`</span> Float64,</span><br><span class="line">    <span class="string">`repl_backlog_active`</span> Float64,</span><br><span class="line">    <span class="string">`repl_backlog_first_byte_offset`</span> Float64,</span><br><span class="line">    <span class="string">`repl_backlog_histlen`</span> Float64,</span><br><span class="line">    <span class="string">`repl_backlog_size`</span> Float64,</span><br><span class="line">    <span class="string">`sync_full`</span> Float64,</span><br><span class="line">    <span class="string">`sync_partial_err`</span> Float64,</span><br><span class="line">    <span class="string">`sync_partial_ok`</span> Float64,</span><br><span class="line">    <span class="string">`total_commands_processed`</span> Float64,</span><br><span class="line">    <span class="string">`total_connections_received`</span> Float64,</span><br><span class="line">    <span class="string">`total_net_input_bytes`</span> Float64,</span><br><span class="line">    <span class="string">`total_net_output_bytes`</span> Float64,</span><br><span class="line">    <span class="string">`uptime`</span> Float64,</span><br><span class="line">    <span class="string">`used_cpu_sys`</span> Float64,</span><br><span class="line">    <span class="string">`used_cpu_sys_children`</span> Float64,</span><br><span class="line">    <span class="string">`used_cpu_user`</span> Float64,</span><br><span class="line">    <span class="string">`used_cpu_user_children`</span> Float64,</span><br><span class="line">    <span class="string">`used_memory`</span> Float64,</span><br><span class="line">    <span class="string">`used_memory_lua`</span> Float64,</span><br><span class="line">    <span class="string">`used_memory_peak`</span> Float64,</span><br><span class="line">    <span class="string">`used_memory_rss`</span> Float64</span><br><span class="line">)</span><br><span class="line"><span class="keyword">ENGINE</span> = MergeTree()</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> toYYYYMM(<span class="keyword">timestamp</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (<span class="keyword">timestamp</span>)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本示例在windows环境下演示，绝大部分命令和linux通用。&lt;/p&gt;
&lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.influxdata.com/telegraf/v1.22/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;telegraf&lt;/a&gt;：指标收集工具，可收集中间件暴露的性能指标，本文中我们以收集redis指标为例。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kafka.apache.org/quickstart&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;kafka&lt;/a&gt;：telegraf收集上来的指标上报到kafka，用于提高系统吞吐量。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://vector.dev/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;vector&lt;/a&gt;：高性能传输管道，支持多种源和目标，本示例中用于消费kafka消息，转换后，写入到ClickHouse中。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://clickhouse.com/docs/zh/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;clickhouse&lt;/a&gt;: 列式存储数据库，适用于OLAP分析型场景。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://superset.apache.org/docs/intro&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;superset&lt;/a&gt;：轻量级BI工具，用于快速接入各种数据源实现数据展现。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="指标收集" scheme="http://yoursite.com/categories/%E6%8C%87%E6%A0%87%E6%94%B6%E9%9B%86/"/>
    
    
      <category term="telegraf" scheme="http://yoursite.com/tags/telegraf/"/>
    
      <category term="kafka" scheme="http://yoursite.com/tags/kafka/"/>
    
      <category term="vector" scheme="http://yoursite.com/tags/vector/"/>
    
      <category term="clickhouse" scheme="http://yoursite.com/tags/clickhouse/"/>
    
  </entry>
  
  <entry>
    <title>vue3插槽</title>
    <link href="http://yoursite.com/2022/03/02/vue3%E6%8F%92%E6%A7%BD/"/>
    <id>http://yoursite.com/2022/03/02/vue3插槽/</id>
    <published>2022-03-02T11:33:00.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<h3 id="基本内容"><a href="#基本内容" class="headerlink" title="基本内容"></a>基本内容</h3><p>定义一个组件com，使用slot标签占位：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.component(<span class="string">'com'</span>, &#123;</span><br><span class="line">    template: <span class="string">`&lt;div&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/div&gt;`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>使用这个组件com：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">com</span>&gt;</span>是非成败转头空，浪花淘尽英雄。<span class="tag">&lt;/<span class="name">com</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>组件com中的slot会被替换成<code>是非成败转头空，浪花淘尽英雄。</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;基本内容&quot;&gt;&lt;a href=&quot;#基本内容&quot; class=&quot;headerlink&quot; title=&quot;基本内容&quot;&gt;&lt;/a&gt;基本内容&lt;/h3&gt;&lt;p&gt;定义一个组件com，使用slot标签占位：&lt;br&gt;&lt;figure class=&quot;highlight javascript&quot;&gt;
      
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="vue" scheme="http://yoursite.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>CentOS下使用Minikube搭建k8s单机环境</title>
    <link href="http://yoursite.com/2022/02/21/CentOS%E4%B8%8B%E4%BD%BF%E7%94%A8Minikube%E6%90%AD%E5%BB%BAk8s%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83/"/>
    <id>http://yoursite.com/2022/02/21/CentOS下使用Minikube搭建k8s单机环境/</id>
    <published>2022-02-21T14:20:00.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ul><li><a href="https://yongtao.wang/2022/02/21/linux%E4%B8%8B%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%20&amp;%20selinux/" target="_blank" rel="noopener">linux下关闭【防火墙 &amp; seLinux】</a></li><li><a href="https://yongtao.wang/2022/02/18/CentOS%207%E6%9B%B4%E6%96%B0%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC/" target="_blank" rel="noopener">CentOS 7更新到最新版本</a></li><li><a href="https://yongtao.wang/2018/10/25/Docker%20install/" target="_blank" rel="noopener">Docker install</a></li><li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/" target="_blank" rel="noopener">安装kubectl</a></li><li><a href="https://minikube.sigs.k8s.io/docs/start/?spm=a2c6h.12873639.0.0.ab202043NBm9C5" target="_blank" rel="noopener">安装Minikube</a></li></ul><p>注意docker需要使用非root账户运行，minikube也需要非root账户。</p><a id="more"></a><h4 id="清理之前遗留的环境-新安装不需要执行"><a href="#清理之前遗留的环境-新安装不需要执行" class="headerlink" title="清理之前遗留的环境(新安装不需要执行)"></a>清理之前遗留的环境(新安装不需要执行)</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ minikube stop</span><br><span class="line">* Stopping node "minikube"  ...</span><br><span class="line">* Powering off "minikube" via SSH ...</span><br><span class="line">* 1 node stopped.</span><br><span class="line">[wangyt@pseudo-cluster ~]$ minikube delete</span><br><span class="line">* Deleting "minikube" in docker ...</span><br><span class="line">* Deleting container "minikube" ...</span><br><span class="line">* Removing /home/wangyt/.minikube/machines/minikube ...</span><br><span class="line">* Removed all traces of the "minikube" cluster.</span><br><span class="line">[wangyt@pseudo-cluster ~]$ rm -rf ~/.kube/</span><br><span class="line">[wangyt@pseudo-cluster ~]$ rm -rf ~/.minikube/</span><br></pre></td></tr></table></figure><h4 id="创建一个minikube虚拟机"><a href="#创建一个minikube虚拟机" class="headerlink" title="创建一个minikube虚拟机"></a>创建一个minikube虚拟机</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ minikube start</span><br><span class="line">* minikube v1.25.1 on Centos 7.9.2009</span><br><span class="line">* Automatically selected the docker driver</span><br><span class="line">* Starting control plane node minikube in cluster minikube</span><br><span class="line">* Pulling base image ...</span><br><span class="line">* Downloading Kubernetes v1.23.1 preload ...</span><br><span class="line">    &gt; preloaded-images-k8s-v16-v1...: 504.42 MiB / 504.42 MiB  100.00% 3.69 MiB</span><br><span class="line">* Creating docker container (CPUs=2, Memory=2200MB) ...</span><br><span class="line">! This container is having trouble accessing https://k8s.gcr.io</span><br><span class="line">* To pull new external images, you may need to configure a proxy: https://minikube.sigs.k8s.io/docs/reference/networking/proxy/</span><br><span class="line">* Preparing Kubernetes v1.23.1 on Docker 20.10.12 ...</span><br><span class="line">  - kubelet.housekeeping-interval=5m</span><br><span class="line">  - Generating certificates and keys ...</span><br><span class="line">  - Booting up control plane ...</span><br><span class="line">  - Configuring RBAC rules ...</span><br><span class="line">* Verifying Kubernetes components...</span><br><span class="line">  - Using image gcr.io/k8s-minikube/storage-provisioner:v5</span><br><span class="line">* Enabled addons: default-storageclass, storage-provisioner</span><br><span class="line">* Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default</span><br></pre></td></tr></table></figure><h4 id="开启dashboard"><a href="#开启dashboard" class="headerlink" title="开启dashboard"></a>开启dashboard</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ minikube dashboard --port=8899 --url=true</span><br><span class="line">* Verifying dashboard health ...</span><br><span class="line">* Launching proxy ...</span><br><span class="line">* Verifying proxy health ...</span><br><span class="line">http://127.0.0.1:8899/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 代理出去</span></span><br><span class="line">[wangyt@pseudo-cluster ~]$ kubectl proxy --port=8899 --address='192.168.101.146' --accept-hosts='^.*' &amp;</span><br></pre></td></tr></table></figure><p>访问：</p><p><a href="http://192.168.101.146:8899/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/" target="_blank" rel="noopener">http://192.168.101.146:8899/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/</a></p><h4 id="查看pod"><a href="#查看pod" class="headerlink" title="查看pod"></a>查看pod</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[wangyt@pseudo-cluster ~]$ kubectl get po -A</span><br><span class="line">NAMESPACE              NAME                                        READY   STATUS    RESTARTS        AGE</span><br><span class="line">kube-system            coredns-64897985d-xk7qf                     1/1     Running   0               4h53m</span><br><span class="line">kube-system            etcd-minikube                               1/1     Running   0               4h53m</span><br><span class="line">kube-system            kube-apiserver-minikube                     1/1     Running   0               4h53m</span><br><span class="line">kube-system            kube-controller-manager-minikube            1/1     Running   0               4h53m</span><br><span class="line">kube-system            kube-proxy-6m7sk                            1/1     Running   0               4h53m</span><br><span class="line">kube-system            kube-scheduler-minikube                     1/1     Running   0               4h53m</span><br><span class="line">kube-system            storage-provisioner                         1/1     Running   1 (4h53m ago)   4h53m</span><br><span class="line">kubernetes-dashboard   dashboard-metrics-scraper-58549894f-krr2c   1/1     Running   0               4h39m</span><br><span class="line">kubernetes-dashboard   kubernetes-dashboard-ccd587f44-84sgj        1/1     Running   0               4h39m</span><br><span class="line">[wangyt@pseudo-cluster ~]$ kubectl get pods --all-namespaces</span><br><span class="line">NAMESPACE              NAME                                        READY   STATUS    RESTARTS        AGE</span><br><span class="line">kube-system            coredns-64897985d-xk7qf                     1/1     Running   0               4h54m</span><br><span class="line">kube-system            etcd-minikube                               1/1     Running   0               4h54m</span><br><span class="line">kube-system            kube-apiserver-minikube                     1/1     Running   0               4h54m</span><br><span class="line">kube-system            kube-controller-manager-minikube            1/1     Running   0               4h54m</span><br><span class="line">kube-system            kube-proxy-6m7sk                            1/1     Running   0               4h54m</span><br><span class="line">kube-system            kube-scheduler-minikube                     1/1     Running   0               4h54m</span><br><span class="line">kube-system            storage-provisioner                         1/1     Running   1 (4h53m ago)   4h54m</span><br><span class="line">kubernetes-dashboard   dashboard-metrics-scraper-58549894f-krr2c   1/1     Running   0               4h40m</span><br><span class="line">kubernetes-dashboard   kubernetes-dashboard-ccd587f44-84sgj        1/1     Running   0               4h40m</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;准备工作&quot;&gt;&lt;a href=&quot;#准备工作&quot; class=&quot;headerlink&quot; title=&quot;准备工作&quot;&gt;&lt;/a&gt;准备工作&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://yongtao.wang/2022/02/21/linux%E4%B8%8B%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%20&amp;amp;%20selinux/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;linux下关闭【防火墙 &amp;amp; seLinux】&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://yongtao.wang/2022/02/18/CentOS%207%E6%9B%B4%E6%96%B0%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CentOS 7更新到最新版本&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://yongtao.wang/2018/10/25/Docker%20install/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Docker install&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;安装kubectl&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://minikube.sigs.k8s.io/docs/start/?spm=a2c6h.12873639.0.0.ab202043NBm9C5&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;安装Minikube&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;注意docker需要使用非root账户运行，minikube也需要非root账户。&lt;/p&gt;
    
    </summary>
    
      <category term="k8s" scheme="http://yoursite.com/categories/k8s/"/>
    
      <category term="minikube" scheme="http://yoursite.com/categories/k8s/minikube/"/>
    
    
      <category term="k8s" scheme="http://yoursite.com/tags/k8s/"/>
    
      <category term="minikube" scheme="http://yoursite.com/tags/minikube/"/>
    
  </entry>
  
  <entry>
    <title>linux下关闭【防火墙 &amp; seLinux】</title>
    <link href="http://yoursite.com/2022/02/21/linux%E4%B8%8B%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%20&amp;%20selinux/"/>
    <id>http://yoursite.com/2022/02/21/linux下关闭防火墙 &amp; selinux/</id>
    <published>2022-02-21T11:26:00.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<h3 id="禁用seLinux"><a href="#禁用seLinux" class="headerlink" title="禁用seLinux"></a>禁用seLinux</h3><h4 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#  sestatus</span><br></pre></td></tr></table></figure><h4 id="暂时关闭"><a href="#暂时关闭" class="headerlink" title="暂时关闭"></a>暂时关闭</h4><p>暂时关闭，重启失效</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#  setenforce 0</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="永久关闭"><a href="#永久关闭" class="headerlink" title="永久关闭"></a>永久关闭</h4><p>设置<code>SELINUX=disabled</code>，需要重启。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat /etc/selinux/config</span></span><br><span class="line"><span class="comment"># This file controls the state of SELinux on the system.</span></span><br><span class="line"><span class="comment"># SELINUX= can take one of these three values:</span></span><br><span class="line"><span class="comment">#     enforcing - SELinux security policy is enforced.</span></span><br><span class="line"><span class="comment">#     permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class="line"><span class="comment">#     disabled - No SELinux policy is loaded.</span></span><br><span class="line">SELINUX=disabled</span><br><span class="line"><span class="comment"># SELINUXTYPE= can take one of these two values:</span></span><br><span class="line"><span class="comment">#     targeted - Targeted processes are protected,</span></span><br><span class="line"><span class="comment">#     mls - Multi Level Security protection.</span></span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></table></figure><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><h4 id="CentOS-7"><a href="#CentOS-7" class="headerlink" title="CentOS 7"></a>CentOS 7</h4><h4 id="查看状态-1"><a href="#查看状态-1" class="headerlink" title="查看状态"></a>查看状态</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --state</span><br></pre></td></tr></table></figure><p>或者<br><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl status firewalld</span><br></pre></td></tr></table></figure></p><h5 id="暂时关闭-1"><a href="#暂时关闭-1" class="headerlink" title="暂时关闭"></a>暂时关闭</h5><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl stop firewalld.service</span><br></pre></td></tr></table></figure><h5 id="永久关闭-1"><a href="#永久关闭-1" class="headerlink" title="永久关闭"></a>永久关闭</h5><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 禁止firewall开机启动</span></span><br><span class="line">[root@localhost ~]# systemctl disable firewalld.service</span><br></pre></td></tr></table></figure><h4 id="CentOS-6"><a href="#CentOS-6" class="headerlink" title="CentOS 6"></a>CentOS 6</h4><h5 id="查看状态-2"><a href="#查看状态-2" class="headerlink" title="查看状态"></a>查看状态</h5><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service iptables status</span><br></pre></td></tr></table></figure><h5 id="暂时关闭-2"><a href="#暂时关闭-2" class="headerlink" title="暂时关闭"></a>暂时关闭</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># service iptables stop</span></span><br></pre></td></tr></table></figure><h5 id="永久关闭-2"><a href="#永久关闭-2" class="headerlink" title="永久关闭"></a>永久关闭</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># chkconfig iptables off</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;禁用seLinux&quot;&gt;&lt;a href=&quot;#禁用seLinux&quot; class=&quot;headerlink&quot; title=&quot;禁用seLinux&quot;&gt;&lt;/a&gt;禁用seLinux&lt;/h3&gt;&lt;h4 id=&quot;查看状态&quot;&gt;&lt;a href=&quot;#查看状态&quot; class=&quot;headerlink&quot; title=&quot;查看状态&quot;&gt;&lt;/a&gt;查看状态&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]#  sestatus&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;暂时关闭&quot;&gt;&lt;a href=&quot;#暂时关闭&quot; class=&quot;headerlink&quot; title=&quot;暂时关闭&quot;&gt;&lt;/a&gt;暂时关闭&lt;/h4&gt;&lt;p&gt;暂时关闭，重启失效&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]#  setenforce 0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>Vmware下CentOS网络配置</title>
    <link href="http://yoursite.com/2022/02/18/vmware%E4%B8%8Bcentos%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/"/>
    <id>http://yoursite.com/2022/02/18/vmware下centos网络配置/</id>
    <published>2022-02-18T15:23:20.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<p>前提是虚拟机使用NET网络模式。</p><h3 id="查看Vmware-VMnet8网关地址"><a href="#查看Vmware-VMnet8网关地址" class="headerlink" title="查看Vmware VMnet8网关地址"></a>查看Vmware VMnet8网关地址</h3><p>Vmware -&gt; 编辑 -&gt; 虚拟网络编辑器</p><p>选中 VMnet8：</p><p><img src="https://objects.yongtao.wang/images/20220217/20220218152047.png" alt></p><a id="more"></a><p>Net设置…</p><p><img src="https://objects.yongtao.wang/images/20220217/20220218152118.png" alt></p><h3 id="修改DNS"><a href="#修改DNS" class="headerlink" title="修改DNS"></a>修改DNS</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/resolv.conf</span><br><span class="line">; generated by /usr/sbin/dhclient-script</span><br><span class="line">search localdomain</span><br><span class="line">nameserver 192.168.101.2</span><br></pre></td></tr></table></figure><h3 id="修改DNS1-amp-IPADDR-amp-GATEWAY"><a href="#修改DNS1-amp-IPADDR-amp-GATEWAY" class="headerlink" title="修改DNS1 &amp; IPADDR &amp; GATEWAY"></a>修改DNS1 &amp; IPADDR &amp; GATEWAY</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33 </span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">DNS1=192.168.101.2</span><br><span class="line">IPADDR=192.168.101.137</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.101.2</span><br></pre></td></tr></table></figure><p>设置完成后需要重启。</p><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>新的虚拟机也可以使用dhclient自动设置;</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前提是虚拟机使用NET网络模式。&lt;/p&gt;
&lt;h3 id=&quot;查看Vmware-VMnet8网关地址&quot;&gt;&lt;a href=&quot;#查看Vmware-VMnet8网关地址&quot; class=&quot;headerlink&quot; title=&quot;查看Vmware VMnet8网关地址&quot;&gt;&lt;/a&gt;查看Vmware VMnet8网关地址&lt;/h3&gt;&lt;p&gt;Vmware -&amp;gt; 编辑 -&amp;gt; 虚拟网络编辑器&lt;/p&gt;
&lt;p&gt;选中 VMnet8：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://objects.yongtao.wang/images/20220217/20220218152047.png&quot; alt&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="CentOS" scheme="http://yoursite.com/tags/CentOS/"/>
    
      <category term="Vmware" scheme="http://yoursite.com/tags/Vmware/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7更新到最新版本(7.9.2009)</title>
    <link href="http://yoursite.com/2022/02/18/CentOS%207%E6%9B%B4%E6%96%B0%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC/"/>
    <id>http://yoursite.com/2022/02/18/CentOS 7更新到最新版本/</id>
    <published>2022-02-18T14:34:20.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<h3 id="使用阿里云镜像替换CentOS默认yum源"><a href="#使用阿里云镜像替换CentOS默认yum源" class="headerlink" title="使用阿里云镜像替换CentOS默认yum源"></a>使用阿里云镜像替换CentOS默认yum源</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">[root@localhost ~]# sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">[root@localhost ~]# yum makecache</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="查看更新前版本"><a href="#查看更新前版本" class="headerlink" title="查看更新前版本"></a>查看更新前版本</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.4.1708 (Core)</span><br></pre></td></tr></table></figure><h3 id="执行更新"><a href="#执行更新" class="headerlink" title="执行更新"></a>执行更新</h3><p>重要数据需要做好备份。</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum check-update</span><br><span class="line">[root@localhost ~]# yum clean all</span><br><span class="line">[root@localhost ~]# reboot</span><br><span class="line">[root@localhost ~]# yum update -y</span><br></pre></td></tr></table></figure><h3 id="查看更新后版本"><a href="#查看更新后版本" class="headerlink" title="查看更新后版本"></a>查看更新后版本</h3><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.9.2009 (Core)</span><br></pre></td></tr></table></figure><p>参考资料：<br>1.<a href="https://developer.aliyun.com/mirror/centos?spm=a2c6h.13651102.0.0.49fe1b11CNfeGD" target="_blank" rel="noopener">CentOS 镜像</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;使用阿里云镜像替换CentOS默认yum源&quot;&gt;&lt;a href=&quot;#使用阿里云镜像替换CentOS默认yum源&quot; class=&quot;headerlink&quot; title=&quot;使用阿里云镜像替换CentOS默认yum源&quot;&gt;&lt;/a&gt;使用阿里云镜像替换CentOS默认yum源&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]# sed -i -e &#39;/mirrors.cloud.aliyuncs.com/d&#39; -e &#39;/mirrors.aliyuncs.com/d&#39; /etc/yum.repos.d/CentOS-Base.repo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost ~]# yum makecache&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="CentOS" scheme="http://yoursite.com/tags/CentOS/"/>
    
      <category term="yum" scheme="http://yoursite.com/tags/yum/"/>
    
  </entry>
  
  <entry>
    <title>Gradle使用入门</title>
    <link href="http://yoursite.com/2022/02/17/Gradle%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/"/>
    <id>http://yoursite.com/2022/02/17/Gradle使用入门/</id>
    <published>2022-02-17T17:47:20.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装gradle</span></span><br><span class="line">choco install gradle</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>在<code>%HOMEPATH%\.gradle</code>创建<code>init.gradle</code>文件，内容如下：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url <span class="string">'https://maven.aliyun.com/repository/public/'</span> &#125;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h4&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;figcaption&gt;&lt;span&gt;script&lt;/span&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; 安装gradle&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;choco install gradle&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="gradle" scheme="http://yoursite.com/tags/gradle/"/>
    
  </entry>
  
  <entry>
    <title>Windows下的包管理器chocolatey入门</title>
    <link href="http://yoursite.com/2022/02/17/Windows%E4%B8%8B%E7%9A%84%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8chocolatey%E5%85%A5%E9%97%A8/"/>
    <id>http://yoursite.com/2022/02/17/Windows下的包管理器chocolatey入门/</id>
    <published>2022-02-17T15:16:17.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>一个<code>windows</code>包管理工具，类似<code>mac</code>下的<code>Homebrew</code>。</p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>打开powershell，执行如下命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Bypass -Scope <span class="keyword">Process</span> -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor <span class="number">3072</span>; iex ((<span class="built_in">New-Object</span> System.Net.WebClient).DownloadString(<span class="string">'https://community.chocolatey.org/install.ps1'</span>))</span><br></pre></td></tr></table></figure><a id="more"></a><p><img src="https://objects.yongtao.wang/images/20220217/20220217152250.png" alt="这里写图片描述"></p><h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 本地安装包列表</span></span><br><span class="line">choco list --local-only</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装包</span></span><br><span class="line">choco install &lt;package&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装指定版本</span></span><br><span class="line">choco install &lt;package&gt; -version &lt;版本号&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 卸载包</span></span><br><span class="line">choco uninstall &lt;package&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 升级本地包</span></span><br><span class="line">choco upgrade &lt;package&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 搜索包相关</span></span><br><span class="line">choco search &lt;package&gt;</span><br><span class="line"></span><br><span class="line">choco list &lt;package&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 搜索所有版本</span></span><br><span class="line">choco search &lt;package&gt; -all</span><br></pre></td></tr></table></figure><p>More info: <a href="https://chocolatey.org/install#individual" target="_blank" rel="noopener">chocolatey install</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h4&gt;&lt;p&gt;一个&lt;code&gt;windows&lt;/code&gt;包管理工具，类似&lt;code&gt;mac&lt;/code&gt;下的&lt;code&gt;Homebrew&lt;/code&gt;。&lt;/p&gt;
&lt;h4 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h4&gt;&lt;p&gt;打开powershell，执行如下命令：&lt;/p&gt;
&lt;figure class=&quot;highlight powershell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Set-ExecutionPolicy&lt;/span&gt; Bypass -Scope &lt;span class=&quot;keyword&quot;&gt;Process&lt;/span&gt; -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor &lt;span class=&quot;number&quot;&gt;3072&lt;/span&gt;; iex ((&lt;span class=&quot;built_in&quot;&gt;New-Object&lt;/span&gt; System.Net.WebClient).DownloadString(&lt;span class=&quot;string&quot;&gt;&#39;https://community.chocolatey.org/install.ps1&#39;&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="包管理器" scheme="http://yoursite.com/categories/%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/"/>
    
      <category term="windows" scheme="http://yoursite.com/categories/%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/windows/"/>
    
    
      <category term="chocolatey" scheme="http://yoursite.com/tags/chocolatey/"/>
    
  </entry>
  
  <entry>
    <title>后端程序员的前端入门手册</title>
    <link href="http://yoursite.com/2022/02/16/%E5%90%8E%E7%AB%AF%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E5%89%8D%E7%AB%AF%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C/"/>
    <id>http://yoursite.com/2022/02/16/后端程序员的前端入门手册/</id>
    <published>2022-02-16T20:25:00.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<h3 id="基本内容"><a href="#基本内容" class="headerlink" title="基本内容"></a>基本内容</h3><p>本系列刊文旨在让后端程序员快速熟悉上手现代前端开发流程，化繁为简，节省大家宝贵的时间，多陪陪家人，追随内心，做一些想做的事情。</p><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul><li>安装nodejs，<a href="https://nodejs.org/en/" target="_blank" rel="noopener">https://nodejs.org/en/</a></li><li>设置国内源 <code>npm config set registry https://registry.npm.taobao.org/</code></li><li>全局安装 vue-cli、webpack、webpack-dev-serve等<ul><li><code>npm i -g yarn</code></li><li><code>npm install -g vue-cli</code></li><li><code>npm install -g webpack</code></li><li><code>npm install -g webpack-cli</code></li><li><code>npm install -g webpack-dev-server</code></li></ul></li><li>yarn设置国内源 <code>yarn config set registry https://registry.npm.taobao.org/</code></li></ul><a id="more"></a><h3 id="初始化vue项目"><a href="#初始化vue项目" class="headerlink" title="初始化vue项目"></a>初始化vue项目</h3><h4 id="vue-cli初始化"><a href="#vue-cli初始化" class="headerlink" title="vue-cli初始化"></a>vue-cli初始化</h4><p><code>vue ui</code> 或 <code>vue create</code></p><p><a href="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create" target="_blank" rel="noopener">https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</a></p><h4 id="vite初始化"><a href="#vite初始化" class="headerlink" title="vite初始化"></a>vite初始化</h4><p>Vite 是一个 web 开发构建工具，由于其原生 ES 模块导入方式，可以实现闪电般的冷服务器启动。</p><p>通过在终端中运行以下命令，可以使用 Vite 快速构建 Vue 项目。</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yarn create vite &lt;project-name&gt; --template vue</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> &lt;project-name&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn dev</span></span><br></pre></td></tr></table></figure><p><a href="https://v3.cn.vuejs.org/guide/installation.html#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-cli" target="_blank" rel="noopener">https://v3.cn.vuejs.org/guide/installation.html#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-cli</a></p><a href="!---![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192215.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192444.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192509.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216194509.png)--">!---![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192215.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192444.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216192509.png)![这里写图片描述](https://objects.yongtao.wang/images/20220216/20220216194509.png)--</a>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;基本内容&quot;&gt;&lt;a href=&quot;#基本内容&quot; class=&quot;headerlink&quot; title=&quot;基本内容&quot;&gt;&lt;/a&gt;基本内容&lt;/h3&gt;&lt;p&gt;本系列刊文旨在让后端程序员快速熟悉上手现代前端开发流程，化繁为简，节省大家宝贵的时间，多陪陪家人，追随内心，做一些想做的事情。&lt;/p&gt;
&lt;h3 id=&quot;准备工作&quot;&gt;&lt;a href=&quot;#准备工作&quot; class=&quot;headerlink&quot; title=&quot;准备工作&quot;&gt;&lt;/a&gt;准备工作&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;安装nodejs，&lt;a href=&quot;https://nodejs.org/en/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://nodejs.org/en/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;设置国内源 &lt;code&gt;npm config set registry https://registry.npm.taobao.org/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;全局安装 vue-cli、webpack、webpack-dev-serve等&lt;ul&gt;
&lt;li&gt;&lt;code&gt;npm i -g yarn&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;npm install -g vue-cli&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;npm install -g webpack&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;npm install -g webpack-cli&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;npm install -g webpack-dev-server&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;yarn设置国内源 &lt;code&gt;yarn config set registry https://registry.npm.taobao.org/&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="vue" scheme="http://yoursite.com/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>Kafka集群搭建测试</title>
    <link href="http://yoursite.com/2019/08/27/kafka%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/27/kafka集群搭建测试/</id>
    <published>2019-08-27T11:04:00.000Z</published>
    <updated>2019-08-27T11:04:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>单台机器搭建一个伪Kafka集群，用于测试学习。使用kafka内嵌的zookeeper。<br>生产环境应该使用独立的kafka集群。</p><table><thead><tr><th>broker.id</th><th>配置文件</th><th>主机</th><th>客户端连接端口</th></tr></thead><tbody><tr><td>3</td><td>server.3</td><td>192.168.101.146</td><td>9092</td></tr><tr><td>5</td><td>server.5</td><td>192.168.101.146</td><td>2182</td></tr><tr><td>7</td><td>server.7</td><td>192.168.101.146</td><td>2183</td></tr></tbody></table><a id="more"></a><h4 id="准备目录"><a href="#准备目录" class="headerlink" title="准备目录"></a>准备目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster kafka-cluster-test]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/kafka-cluster-test</span><br><span class="line">[root@pseudo-cluster kafka-cluster-test]<span class="comment"># ls -lh</span></span><br><span class="line">total 76K</span><br><span class="line">drwxr-xr-x. 3 wangyt wangyt 4.0K Aug 17  2021 bin</span><br><span class="line">drwxr-xr-x. 2 wangyt wangyt 4.0K Mar 29 02:09 config</span><br><span class="line">drwxr-xr-x. 6 wangyt wangyt   95 Aug 29  2019 k_data</span><br><span class="line">drwxr-xr-x. 2 wangyt wangyt 4.0K Aug 12  2019 libs</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  32K Jun 20  2019 LICENSE</span><br><span class="line">drwxr-xr-x. 2 wangyt wangyt  12K Mar 29 01:32 logs</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  337 Jun 20  2019 NOTICE</span><br><span class="line">drwxr-xr-x. 2 wangyt wangyt   81 Aug 17  2021 pids</span><br><span class="line">-rwxr-xr-x. 1 wangyt wangyt  248 Aug 12  2019 shutdown.sh</span><br><span class="line">drwxr-xr-x. 2 wangyt wangyt   44 Aug 12  2019 site-docs</span><br><span class="line">-rwxr-xr-x. 1 wangyt wangyt  394 Aug 12  2019 startup.sh</span><br><span class="line">[root@pseudo-cluster kafka-cluster-test]<span class="comment"># cd config/</span></span><br><span class="line">[root@pseudo-cluster config]<span class="comment"># ls -lh</span></span><br><span class="line">total 84K</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  906 Jun 20  2019 connect-console-sink.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  909 Jun 20  2019 connect-console-source.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 5.2K Jun 20  2019 connect-distributed.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  883 Jun 20  2019 connect-file-sink.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt  881 Jun 20  2019 connect-file-source.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.6K Jun 20  2019 connect-log4j.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 2.3K Jun 20  2019 connect-standalone.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.2K Jun 20  2019 consumer.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 4.7K Jun 20  2019 log4j.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.9K Jun 20  2019 producer.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 6.8K Aug 29  2019 server-3.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 6.8K Aug 29  2019 server-5.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 6.8K Aug 29  2019 server-7.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.1K Jun 20  2019 tools-log4j.properties</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.2K Jun 20  2019 trogdor.conf</span><br><span class="line">-rw-r--r--. 1 wangyt wangyt 1.1K Aug 29  2019 zookeeper.properties</span><br></pre></td></tr></table></figure><h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>config目录下复制三份server.properties，分别修改server-3、server-5、server-7</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">broker.id=3</span><br><span class="line">listeners=PLAINTEXT://192.168.91.146:9092</span><br><span class="line">log.dirs=k_data/kafka-logs-node3</span><br><span class="line">zookeeper.connect=localhost:2181</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">broker.id=5</span><br><span class="line">listeners=PLAINTEXT://192.168.91.146:9093</span><br><span class="line">log.dirs=k_data/kafka-logs-node5</span><br><span class="line">zookeeper.connect=localhost:2181</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">broker.id=7</span><br><span class="line">listeners=PLAINTEXT://192.168.91.146:9094</span><br><span class="line">log.dirs=k_data/kafka-logs-node7</span><br><span class="line">zookeeper.connect=localhost:2181</span><br></pre></td></tr></table></figure><p>zookeeper.properties配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dataDir=k_data/zookeeper</span><br><span class="line"><span class="comment"># the port at which the clients will connect</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="comment"># disable the per-ip limit on the number of connections since this is a non-production config</span></span><br><span class="line">maxClientCnxns=0</span><br></pre></td></tr></table></figure><h4 id="启停脚本"><a href="#启停脚本" class="headerlink" title="启停脚本"></a>启停脚本</h4><h5 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h5><p>startup.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">pidExt=<span class="string">'.pid'</span></span><br><span class="line">propExt=<span class="string">'.properties'</span></span><br><span class="line">nodes=(server-3 server-5 server-7)</span><br><span class="line"></span><br><span class="line"><span class="comment"># start zookeeper</span></span><br><span class="line">nohup ./bin/zookeeper-server-start.sh config/zookeeper.properties &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"$!"</span> &gt; ./pids/zoo<span class="variable">$pidExt</span></span><br><span class="line">sleep 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># start kafka cluster</span></span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;nodes[@]&#125;</span>"</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        nohup ./bin/kafka-server-start.sh config/<span class="variable">$val</span><span class="variable">$propExt</span> &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"$!"</span> &gt; ./pids/<span class="variable">$val</span><span class="variable">$pidExt</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h5 id="停止脚本"><a href="#停止脚本" class="headerlink" title="停止脚本"></a>停止脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">process_dir</span></span>() &#123;</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> `ls <span class="variable">$1</span>`</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">if</span> [ -d <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span> ]</span><br><span class="line">                <span class="keyword">then</span></span><br><span class="line">                        process_dir <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                        <span class="comment">#echo $1"/"$file `cat $1"/"$file`</span></span><br><span class="line">                        <span class="built_in">kill</span> -9 `cat <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span>`</span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">process_dir ./pids</span><br><span class="line">rm -rf ./pids/*</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单台机器搭建一个伪Kafka集群，用于测试学习。使用kafka内嵌的zookeeper。&lt;br&gt;生产环境应该使用独立的kafka集群。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;broker.id&lt;/th&gt;
&lt;th&gt;配置文件&lt;/th&gt;
&lt;th&gt;主机&lt;/th&gt;
&lt;th&gt;客户端连接端口&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;server.3&lt;/td&gt;
&lt;td&gt;192.168.101.146&lt;/td&gt;
&lt;td&gt;9092&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;server.5&lt;/td&gt;
&lt;td&gt;192.168.101.146&lt;/td&gt;
&lt;td&gt;2182&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;server.7&lt;/td&gt;
&lt;td&gt;192.168.101.146&lt;/td&gt;
&lt;td&gt;2183&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="Kafka" scheme="http://yoursite.com/categories/Kafka/"/>
    
    
      <category term="Kafka" scheme="http://yoursite.com/tags/Kafka/"/>
    
  </entry>
  
  <entry>
    <title>Zookeeper集群搭建测试</title>
    <link href="http://yoursite.com/2019/08/26/Zookeeper%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/26/Zookeeper集群搭建测试/</id>
    <published>2019-08-26T15:04:00.000Z</published>
    <updated>2019-08-26T15:04:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>单台机器搭建一个伪Zookeeper集群，用于测试学习。</p><table><thead><tr><th>节点</th><th>主机</th><th>客户端连接端口</th><th>follower连接leader端口</th><th>leader选举端口</th></tr></thead><tbody><tr><td>server.1</td><td>192.168.91.146</td><td>2181</td><td>2887</td><td>3887</td></tr><tr><td>server.2</td><td>192.168.91.146</td><td>2182</td><td>2888</td><td>3888</td></tr><tr><td>server.3</td><td>192.168.91.146</td><td>2183</td><td>2889</td><td>3889</td></tr></tbody></table><a id="more"></a><h4 id="准备目录"><a href="#准备目录" class="headerlink" title="准备目录"></a>准备目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster zookeeper-cluster-test]<span class="comment"># ls -lh</span></span><br><span class="line">total 8.0K</span><br><span class="line">-rwxr-xr-x. 1 root root 147 Aug 23 11:03 shutdown.sh</span><br><span class="line">-rwxr-xr-x. 1 root root 265 Aug 23 10:53 startup.sh</span><br><span class="line">drwxr-xr-x. 8 root root 166 Aug 22 16:58 zookeeper-3.5.5-server.1</span><br><span class="line">drwxr-xr-x. 8 root root 166 Aug 22 17:26 zookeeper-3.5.5-server.2</span><br><span class="line">drwxr-xr-x. 8 root root 166 Aug 22 17:26 zookeeper-3.5.5-server.3</span><br></pre></td></tr></table></figure><h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>分别修改server.1、server.2、server.3三个节点的<code>conf/zoo.cfg</code>配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The number of milliseconds of each tick</span></span><br><span class="line">tickTime=2000</span><br><span class="line"><span class="comment"># The number of ticks that the initial </span></span><br><span class="line"><span class="comment"># synchronization phase can take</span></span><br><span class="line">initLimit=5</span><br><span class="line"><span class="comment"># The number of ticks that can pass between </span></span><br><span class="line"><span class="comment"># sending a request and getting an acknowledgement</span></span><br><span class="line">syncLimit=2</span><br><span class="line"><span class="comment"># the directory where the snapshot is stored.</span></span><br><span class="line"><span class="comment"># do not use /tmp for storage, /tmp here is just </span></span><br><span class="line"><span class="comment"># example sakes.</span></span><br><span class="line">dataDir=__DATA_ZOO__/data</span><br><span class="line">dataLogDir=__DATA_ZOO__/logs</span><br><span class="line"><span class="comment"># the port at which the clients will connect</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="comment"># server.x=[hostname]:nnnnn[:nnnnn], etc : (No Java system property) servers making up the ZooKeeper ensemble. When the server starts up, it determines which server it is by looking for the file myid in the data directory. That file contains the server number, in ASCII, and it should match x in server.x in the left hand side of this setting. The list of servers that make up ZooKeeper servers that is used by the clients must match the list of ZooKeeper servers that each ZooKeeper server has. There are two port numbers nnnnn. The first followers use to connect to the leader, and the second is for leader election. If you want to test multiple servers on a single machine, then different ports can be used for each server.</span></span><br><span class="line">server.1=192.168.91.146:2887:3887</span><br><span class="line">server.2=192.168.91.146:2888:3888</span><br><span class="line">server.3=192.168.91.146:2889:3889</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line">dataDir=__DATA_ZOO__/data</span><br><span class="line">dataLogDir=__DATA_ZOO__/logs</span><br><span class="line">clientPort=2182</span><br><span class="line">server.1=192.168.91.146:2887:3887</span><br><span class="line">server.2=192.168.91.146:2888:3888</span><br><span class="line">server.3=192.168.91.146:2889:3889</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line">dataDir=__DATA_ZOO__/data</span><br><span class="line">dataLogDir=__DATA_ZOO__/logs</span><br><span class="line">clientPort=2183</span><br><span class="line">server.1=192.168.91.146:2887:3887</span><br><span class="line">server.2=192.168.91.146:2888:3888</span><br><span class="line">server.3=192.168.91.146:2889:3889</span><br></pre></td></tr></table></figure><h4 id="启停脚本"><a href="#启停脚本" class="headerlink" title="启停脚本"></a>启停脚本</h4><h5 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line">current_path=`<span class="built_in">pwd</span>`</span><br><span class="line">nodes=(zookeeper-3.5.5-server.1 zookeeper-3.5.5-server.2 zookeeper-3.5.5-server.3)</span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;nodes[@]&#125;</span>"</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    path=<span class="variable">$current_path</span>/<span class="variable">$val</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$path</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$path</span></span><br><span class="line">        ./bin/zkServer.sh start</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">jps -l | grep QuorumPeerMain</span><br></pre></td></tr></table></figure><h5 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster zookeeper-cluster-test]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/zookeeper-cluster-test</span><br><span class="line">[root@pseudo-cluster zookeeper-cluster-test]<span class="comment"># ./startup.sh </span></span><br><span class="line">/usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.1</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.1/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">/usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.2</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.2/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">/usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.3</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/<span class="built_in">local</span>/zookeeper-cluster-test/zookeeper-3.5.5-server.3/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">56626 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">56739 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">56679 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">[root@pseudo-cluster zookeeper-cluster-test]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h5 id="查看集群"><a href="#查看集群" class="headerlink" title="查看集群"></a>查看集群</h5><h5 id="停止脚本"><a href="#停止脚本" class="headerlink" title="停止脚本"></a>停止脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">jps -l | grep QuorumPeerMain</span><br><span class="line"></span><br><span class="line"><span class="built_in">kill</span> -9 $(jps -l | grep org.apache.zookeeper.server.quorum.QuorumPeerMain | awk <span class="string">'&#123;&#123;print $1&#125;&#125;'</span>)</span><br></pre></td></tr></table></figure><h5 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster zookeeper-cluster-test]<span class="comment"># ./shutdown.sh </span></span><br><span class="line">56626 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">56739 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">56679 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单台机器搭建一个伪Zookeeper集群，用于测试学习。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;节点&lt;/th&gt;
&lt;th&gt;主机&lt;/th&gt;
&lt;th&gt;客户端连接端口&lt;/th&gt;
&lt;th&gt;follower连接leader端口&lt;/th&gt;
&lt;th&gt;leader选举端口&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;server.1&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;2181&lt;/td&gt;
&lt;td&gt;2887&lt;/td&gt;
&lt;td&gt;3887&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;server.2&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;2182&lt;/td&gt;
&lt;td&gt;2888&lt;/td&gt;
&lt;td&gt;3888&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;server.3&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;2183&lt;/td&gt;
&lt;td&gt;2889&lt;/td&gt;
&lt;td&gt;3889&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="Zookeeper" scheme="http://yoursite.com/categories/Zookeeper/"/>
    
    
      <category term="Zookeeper" scheme="http://yoursite.com/tags/Zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>The lifetime of a thread</title>
    <link href="http://yoursite.com/2019/08/22/The%20lifetime%20of%20a%20thread/"/>
    <id>http://yoursite.com/2019/08/22/The lifetime of a thread/</id>
    <published>2019-08-22T19:40:00.000Z</published>
    <updated>2019-08-22T19:40:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="The-lifetime-of-a-thread"><a href="#The-lifetime-of-a-thread" class="headerlink" title="The lifetime of a thread"></a>The lifetime of a thread</h1><h3 id="线程的状态"><a href="#线程的状态" class="headerlink" title="线程的状态"></a>线程的状态</h3><p>线程有六种状态，定义在<code>java.lang.Thread.State</code>内部枚举中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> State &#123;</span><br><span class="line">    NEW,</span><br><span class="line">    RUNNABLE,</span><br><span class="line">    BLOCKED,</span><br><span class="line">    WAITING,</span><br><span class="line">    TIMED_WAITING,</span><br><span class="line">    TERMINATED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>A thread state. A thread can be in one of the following states:</p><ul><li><strong>NEW</strong> A thread that has not yet started is in this state.</li><li><strong>RUNNABLE</strong> A thread executing in the Java virtual machine is in this state.</li><li><strong>BLOCKED</strong> A thread that is blocked waiting for a monitor lock is in this state. 处于此状态，线程被阻塞等待监视器锁</li><li><strong>WAITING</strong> A thread that is waiting indefinitely for another thread to perform a particular action is in this state. 无限期等待另外线程执行特定的动作，通常为唤醒等操作</li><li><strong>TIMED_WAITING</strong> A thread that is waiting for another thread to perform an action for up to a specified waiting time is in this state. 限期等待</li><li><strong>TERMINATED</strong> A thread that has exited is in this state.</li></ul><p>A thread can be in only one state at a given point in time. These states are virtual machine states which do not reflect any operating system thread states.</p><h3 id="线程的生命周期"><a href="#线程的生命周期" class="headerlink" title="线程的生命周期"></a>线程的生命周期</h3><p><img src="https://objects.yongtao.wang/images/20190903/java-thread-life-cycle-state.gif" alt="The lifetime of a thread.gif"><br>实现三个线程，其中Thread-01执行睡眠，Thread-02、Thread-03执行同步任务，jstack抓取堆栈信息，观察线程状态。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Thread thd01 =</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">120</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="comment">// ignore</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Thread-01"</span>);</span><br><span class="line"></span><br><span class="line">    Thread thd02 =</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            doSorting();</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Thread-02"</span>);</span><br><span class="line"></span><br><span class="line">    Thread thd03 =</span><br><span class="line">        <span class="keyword">new</span> Thread(</span><br><span class="line">        () -&gt; &#123;</span><br><span class="line">            doSorting();</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Thread-03"</span>);</span><br><span class="line"></span><br><span class="line">    thd01.start();</span><br><span class="line">    thd02.start();</span><br><span class="line">    thd03.start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSorting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">        <span class="comment">// 生成随机数组</span></span><br><span class="line">        <span class="keyword">double</span>[] a = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">100</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.length; i++) &#123;</span><br><span class="line">            a[i] = <span class="keyword">new</span> Random().nextDouble();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 对随机数组进行排序，使其消耗CPU</span></span><br><span class="line">        Arrays.sort(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>如堆栈信息所示，Thread-01处于TIMED_WAITING状态，Thread-02处于RUNNABLE状态，Thread-02处于BLOCKED状态。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&quot;Thread-03&quot; #13 prio=5 os_prio=0 tid=0x000000002092b000 nid=0x345c waiting for monitor entry [0x00000000214fe000]</span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState.doSorting(ThreadState.java:49)</span><br><span class="line">        - waiting to lock &lt;0x000000068280a830&gt; (a java.lang.Class for io.mysnippet.multithread.ThreadState)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState.lambda$main$2(ThreadState.java:37)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState$$Lambda$3/1078694789.run(Unknown Source)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line">&quot;Thread-02&quot; #12 prio=5 os_prio=0 tid=0x000000002092a000 nid=0x748 runnable [0x00000000213fe000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">        at io.mysnippet.multithread.ThreadState.doSorting(ThreadState.java:50)</span><br><span class="line">        - locked &lt;0x000000068280a830&gt; (a java.lang.Class for io.mysnippet.multithread.ThreadState)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState.lambda$main$1(ThreadState.java:30)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState$$Lambda$2/1096979270.run(Unknown Source)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line">&quot;Thread-01&quot; #11 prio=5 os_prio=0 tid=0x0000000020949800 nid=0x4494 waiting on condition [0x00000000212ff000]</span><br><span class="line">   java.lang.Thread.State: TIMED_WAITING (sleeping)</span><br><span class="line">        at java.lang.Thread.sleep(Native Method)</span><br><span class="line">        at java.lang.Thread.sleep(Thread.java:340)</span><br><span class="line">        at java.util.concurrent.TimeUnit.sleep(TimeUnit.java:386)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState.lambda$main$0(ThreadState.java:20)</span><br><span class="line">        at io.mysnippet.multithread.ThreadState$$Lambda$1/2003749087.run(Unknown Source)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;The-lifetime-of-a-thread&quot;&gt;&lt;a href=&quot;#The-lifetime-of-a-thread&quot; class=&quot;headerlink&quot; title=&quot;The lifetime of a thread&quot;&gt;&lt;/a&gt;The lifetime of a thread&lt;/h1&gt;&lt;h3 id=&quot;线程的状态&quot;&gt;&lt;a href=&quot;#线程的状态&quot; class=&quot;headerlink&quot; title=&quot;线程的状态&quot;&gt;&lt;/a&gt;线程的状态&lt;/h3&gt;&lt;p&gt;线程有六种状态，定义在&lt;code&gt;java.lang.Thread.State&lt;/code&gt;内部枚举中：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; State &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    NEW,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    RUNNABLE,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    BLOCKED,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    WAITING,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TIMED_WAITING,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    TERMINATED;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="thread" scheme="http://yoursite.com/categories/thread/"/>
    
    
      <category term="thread" scheme="http://yoursite.com/tags/thread/"/>
    
      <category term="java" scheme="http://yoursite.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearch集群搭建测试</title>
    <link href="http://yoursite.com/2019/08/21/Elasticsearch%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/21/Elasticsearch集群搭建测试/</id>
    <published>2019-08-21T14:06:30.000Z</published>
    <updated>2019-08-21T14:06:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>单台机器搭建一个伪Elasticsearch集群，用于测试学习。</p><table><thead><tr><th>节点</th><th>主机</th><th>HTTP端口</th><th>TCP端口</th></tr></thead><tbody><tr><td>node-0</td><td>192.168.91.146</td><td>9200</td><td>9300</td></tr><tr><td>node-1</td><td>192.168.91.146</td><td>9201</td><td>9301</td></tr><tr><td>node-2</td><td>192.168.91.146</td><td>9202</td><td>9302</td></tr></tbody></table><a id="more"></a><h4 id="准备目录"><a href="#准备目录" class="headerlink" title="准备目录"></a>准备目录</h4><p>下载elasticsearch安装包，按照如下目录组织</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test</span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># ls -lh</span></span><br><span class="line">total 8.0K</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 155 Aug 11 03:22 es-6.6.2-node0</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 165 Aug 11 03:22 es-6.6.2-node1</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 155 Aug 11 03:22 es-6.6.2-node2</span><br><span class="line">-rwxr-xr-x. 1 elasticsearch elasticsearch 253 Aug  9 03:07 shutdown.sh</span><br><span class="line">-rwxr-xr-x. 1 elasticsearch elasticsearch 264 Aug  9 03:13 startup.sh</span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h4 id="添加用户-amp-组-amp-赋权"><a href="#添加用户-amp-组-amp-赋权" class="headerlink" title="添加用户&amp;组&amp;赋权"></a>添加用户&amp;组&amp;赋权</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># groupadd elasticsearch</span></span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># useradd elasticsearch -g elasticsearch</span></span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># chown -R elasticsearch.elasticsearch /usr/local/es-cluser-test</span></span><br></pre></td></tr></table></figure><h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><p>分别修改node0、node1、node2三个节点的<code>config/elasticsearch.yml</code>配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: es-pseudo-cluster</span><br><span class="line">node.name: node-0</span><br><span class="line">bootstrap.memory_lock: <span class="literal">true</span></span><br><span class="line">network.host: 192.168.91.146</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"192.168.91.146:9301"</span>, <span class="string">"192.168.91.146:9302"</span>]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: es-pseudo-cluster</span><br><span class="line">node.name: node-1</span><br><span class="line">bootstrap.memory_lock: <span class="literal">true</span></span><br><span class="line">network.host: 192.168.91.146</span><br><span class="line">http.port: 9201</span><br><span class="line">transport.tcp.port: 9301</span><br><span class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"192.168.91.146:9300"</span>, <span class="string">"192.168.91.146:9302"</span>]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: es-pseudo-cluster</span><br><span class="line">node.name: node-2</span><br><span class="line">bootstrap.memory_lock: <span class="literal">true</span></span><br><span class="line">network.host: 192.168.91.146</span><br><span class="line">http.port: 9202</span><br><span class="line">transport.tcp.port: 9302</span><br><span class="line">discovery.zen.ping.unicast.hosts: [<span class="string">"192.168.91.146:9300"</span>, <span class="string">"192.168.91.146:9301"</span>]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br></pre></td></tr></table></figure><h4 id="启停脚本"><a href="#启停脚本" class="headerlink" title="启停脚本"></a>启停脚本</h4><h5 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">current_path=`<span class="built_in">pwd</span>`</span><br><span class="line">nodes=(es-6.6.2-node0 es-6.6.2-node1 es-6.6.2-node2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;nodes[@]&#125;</span>"</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    path=<span class="variable">$current_path</span>/<span class="variable">$val</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$path</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$path</span></span><br><span class="line">    ./bin/elasticsearch -d -p pid</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">ps -elf | grep -v <span class="string">'grep'</span> | grep Elasticsearch</span><br></pre></td></tr></table></figure><h5 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test</span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># ls -lh</span></span><br><span class="line">total 8.0K</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 155 Aug 14 03:52 es-6.6.2-node0</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 155 Aug 14 03:56 es-6.6.2-node1</span><br><span class="line">drwxr-xr-x. 9 elasticsearch elasticsearch 155 Aug 14 03:56 es-6.6.2-node2</span><br><span class="line">-rwxr-xr-x. 1 elasticsearch elasticsearch 253 Aug  9 03:07 shutdown.sh</span><br><span class="line">-rwxr-xr-x. 1 elasticsearch elasticsearch 264 Aug 14 03:55 startup.sh</span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># </span></span><br><span class="line">[root@pseudo-cluster es-cluser-test]<span class="comment"># su elasticsearch</span></span><br><span class="line">[elasticsearch@pseudo-cluster es-cluser-test]$ ./startup.sh </span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node0</span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node1</span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node2</span><br><span class="line">0 S elastic+  30162      1 99  80   0 - 776807 futex_ 03:57 pts/0   00:00:01 /usr/<span class="built_in">local</span>/jdk1.8.0_221/bin/java -Xms512m -Xmx512m -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=<span class="literal">true</span> -Dfile.encoding=UTF-8 -Djna.nosys=<span class="literal">true</span> -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=<span class="literal">true</span> -Dio.netty.noKeySetOptimization=<span class="literal">true</span> -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=<span class="literal">false</span> -Dlog4j2.disable.jmx=<span class="literal">true</span> -Djava.io.tmpdir=/tmp/elasticsearch-3768772128440104570 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:logs/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=32 -XX:GCLogFileSize=64m -Des.path.home=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node0 -Des.path.conf=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node0/config -Des.distribution.flavor=default -Des.distribution.type=tar -cp /usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node0/lib/* org.elasticsearch.bootstrap.Elasticsearch -d -p pid</span><br><span class="line">0 S elastic+  30238      1  0  80   0 - 773344 futex_ 03:57 pts/0   00:00:00 /usr/<span class="built_in">local</span>/jdk1.8.0_221/bin/java -Xms512m -Xmx512m -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=<span class="literal">true</span> -Dfile.encoding=UTF-8 -Djna.nosys=<span class="literal">true</span> -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=<span class="literal">true</span> -Dio.netty.noKeySetOptimization=<span class="literal">true</span> -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=<span class="literal">false</span> -Dlog4j2.disable.jmx=<span class="literal">true</span> -Djava.io.tmpdir=/tmp/elasticsearch-3776090600362042909 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:logs/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=32 -XX:GCLogFileSize=64m -Des.path.home=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node1 -Des.path.conf=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node1/config -Des.distribution.flavor=default -Des.distribution.type=tar -cp /usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node1/lib/* org.elasticsearch.bootstrap.Elasticsearch -d -p pid</span><br><span class="line">0 S elastic+  30314      1  0  80   0 - 25758 futex_ 03:57 pts/0    00:00:00 /usr/<span class="built_in">local</span>/jdk1.8.0_221/bin/java -Xms512m -Xmx512m -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=<span class="literal">true</span> -Dfile.encoding=UTF-8 -Djna.nosys=<span class="literal">true</span> -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=<span class="literal">true</span> -Dio.netty.noKeySetOptimization=<span class="literal">true</span> -Dio.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=<span class="literal">false</span> -Dlog4j2.disable.jmx=<span class="literal">true</span> -Djava.io.tmpdir=/tmp/elasticsearch-4360777951552716525 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pid%p.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:logs/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=32 -XX:GCLogFileSize=64m -Des.path.home=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node2 -Des.path.conf=/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node2/config -Des.distribution.flavor=default -Des.distribution.type=tar -cp /usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node2/lib/* org.elasticsearch.bootstrap.Elasticsearch -d -p pid</span><br><span class="line">[elasticsearch@pseudo-cluster es-cluser-test]$</span><br></pre></td></tr></table></figure><h5 id="查看集群"><a href="#查看集群" class="headerlink" title="查看集群"></a>查看集群</h5><p>通过Elasticsearch Head查看集群</p><p><img src="https://objects.yongtao.wang/images/20190821/elasticsearch-pseudo-cluster.png" alt="elasticsearch-pseudo-cluster"></p><h5 id="停止脚本"><a href="#停止脚本" class="headerlink" title="停止脚本"></a>停止脚本</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">current_path=`<span class="built_in">pwd</span>`</span><br><span class="line">nodes=(es-6.6.2-node0 es-6.6.2-node1 es-6.6.2-node2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> <span class="string">"<span class="variable">$&#123;nodes[@]&#125;</span>"</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    path=<span class="variable">$current_path</span>/<span class="variable">$val</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$path</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$path</span></span><br><span class="line">    <span class="built_in">kill</span> -9 `cat pid` </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">ps -elf | grep -v <span class="string">'grep'</span> | grep Elasticsearch</span><br></pre></td></tr></table></figure><h5 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[elasticsearch@pseudo-cluster es-cluser-test]$ ./shutdown.sh </span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node0</span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node1</span><br><span class="line">/usr/<span class="built_in">local</span>/es-cluser-test/es-6.6.2-node2</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单台机器搭建一个伪Elasticsearch集群，用于测试学习。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;节点&lt;/th&gt;
&lt;th&gt;主机&lt;/th&gt;
&lt;th&gt;HTTP端口&lt;/th&gt;
&lt;th&gt;TCP端口&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;node-0&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;9200&lt;/td&gt;
&lt;td&gt;9300&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;node-1&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;9201&lt;/td&gt;
&lt;td&gt;9301&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;node-2&lt;/td&gt;
&lt;td&gt;192.168.91.146&lt;/td&gt;
&lt;td&gt;9202&lt;/td&gt;
&lt;td&gt;9302&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="elasticsearch" scheme="http://yoursite.com/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://yoursite.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Windows 10 去除快捷方式小箭头</title>
    <link href="http://yoursite.com/2019/08/10/Windows%2010%20%E5%8E%BB%E9%99%A4%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F%E5%B0%8F%E7%AE%AD%E5%A4%B4/"/>
    <id>http://yoursite.com/2019/08/10/Windows 10 去除快捷方式小箭头/</id>
    <published>2019-08-10T20:56:00.000Z</published>
    <updated>2019-08-10T20:56:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Windows-10-去除快捷方式小箭头"><a href="#Windows-10-去除快捷方式小箭头" class="headerlink" title="Windows 10 去除快捷方式小箭头"></a>Windows 10 去除快捷方式小箭头</h3><h4 id="去掉小箭头"><a href="#去掉小箭头" class="headerlink" title="去掉小箭头"></a>去掉小箭头</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">reg add <span class="string">"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Icons"</span> /v 29 /d <span class="string">"%systemroot%\system32\imageres.dll,197"</span> /t reg_sz /f</span><br><span class="line">taskkill /f /im explorer.exe</span><br><span class="line">attrib -s -r -h <span class="string">"%userprofile%\AppData\Local\iconcache.db"</span></span><br><span class="line">del <span class="string">"%userprofile%\AppData\Local\iconcache.db"</span> /f /q</span><br><span class="line">start explorer</span><br><span class="line">pause</span><br></pre></td></tr></table></figure><h4 id="恢复小箭头"><a href="#恢复小箭头" class="headerlink" title="恢复小箭头"></a>恢复小箭头</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">reg delete <span class="string">"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Icons"</span> /v 29 /f</span><br><span class="line">taskkill /f /im explorer.exe</span><br><span class="line">attrib -s -r -h <span class="string">"%userprofile%\AppData\Local\iconcache.db"</span></span><br><span class="line">del <span class="string">"%userprofile%\AppData\Local\iconcache.db"</span> /f /q</span><br><span class="line">start explorer</span><br><span class="line">pause</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Windows-10-去除快捷方式小箭头&quot;&gt;&lt;a href=&quot;#Windows-10-去除快捷方式小箭头&quot; class=&quot;headerlink&quot; title=&quot;Windows 10 去除快捷方式小箭头&quot;&gt;&lt;/a&gt;Windows 10 去除快捷方式小箭头&lt;/h3&gt;&lt;
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Redis集群搭建测试</title>
    <link href="http://yoursite.com/2019/08/01/Redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2019/08/01/Redis集群搭建测试/</id>
    <published>2019-08-01T11:28:49.000Z</published>
    <updated>2019-08-02T10:46:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>单台机器搭建一个伪Redis集群，用于测试学习。redis-3.2.13可以使用redis源码自行编译<code>make prifix=/tmp/redis</code>。</p><h4 id="下载redis-cluster-test项目"><a href="#下载redis-cluster-test项目" class="headerlink" title="下载redis-cluster-test项目"></a>下载redis-cluster-test项目</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster <span class="built_in">local</span>]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span></span><br><span class="line">[root@pseudo-cluster <span class="built_in">local</span>]<span class="comment"># git clone https://github.com/wyt/redis-cluster-test.git</span></span><br><span class="line">[root@pseudo-cluster bin]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/redis-cluster-test/redis-3.2.13/bin</span><br><span class="line">[root@pseudo-cluster bin]<span class="comment"># chmod +x ./*</span></span><br><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/redis-cluster-test</span><br><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># chmod +x shutdown.sh startup.sh</span></span><br></pre></td></tr></table></figure><h4 id="安装ruby环境等"><a href="#安装ruby环境等" class="headerlink" title="安装ruby环境等"></a>安装ruby环境等</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装ruby环境</span></span><br><span class="line">[root@pseudo-cluster redis-cluster-test] yum install centos-release-scl-rh</span><br><span class="line">[root@pseudo-cluster redis-cluster-test] yum install rh-ruby23 -y</span><br><span class="line"><span class="comment"># 当前session生效</span></span><br><span class="line">[root@pseudo-cluster redis-cluster-test] scl <span class="built_in">enable</span> rh-ruby23 bash</span><br><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># ruby -v</span></span><br><span class="line">ruby 2.3.8p459 (2018-10-18 revision 65136) [x86_64-linux]</span><br><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># gem install redis</span></span><br><span class="line">Fetching: redis-4.1.2.gem (100%)</span><br><span class="line">Successfully installed redis-4.1.2</span><br><span class="line">Parsing documentation <span class="keyword">for</span> redis-4.1.2</span><br><span class="line">Installing ri documentation <span class="keyword">for</span> redis-4.1</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="规划集群"><a href="#规划集群" class="headerlink" title="规划集群"></a>规划集群</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/redis-cluster-test</span><br><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># ls -lh</span></span><br><span class="line">total 16K</span><br><span class="line">drwxr-xr-x. 2 root root   64 Aug  1 18:57 7000</span><br><span class="line">drwxr-xr-x. 2 root root   64 Aug  1 18:57 7001</span><br><span class="line">drwxr-xr-x. 2 root root   64 Aug  1 18:57 7002</span><br><span class="line">drwxr-xr-x. 2 root root   64 Aug  1 18:57 7003</span><br><span class="line">drwxr-xr-x. 2 root root   64 Aug  1 18:57 7004</span><br><span class="line">drwxr-xr-x. 2 root root   64 Aug  1 18:57 7005</span><br><span class="line">-rw-r--r--. 1 root root 7.1K Aug  1 18:56 README.md</span><br><span class="line">drwxr-xr-x. 3 root root   35 Aug  1 18:54 redis-3.2.13</span><br><span class="line">-rwxr-xr-x. 1 root root   75 Aug  1 18:54 shutdown.sh</span><br><span class="line">-rwxr-xr-x. 1 root root  635 Aug  1 18:54 startup.sh</span><br><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># ./startup.sh </span></span><br><span class="line">/usr/<span class="built_in">local</span>/redis-cluster-test/7000</span><br><span class="line">/usr/<span class="built_in">local</span>/redis-cluster-test/7001</span><br><span class="line">/usr/<span class="built_in">local</span>/redis-cluster-test/7002</span><br><span class="line">/usr/<span class="built_in">local</span>/redis-cluster-test/7003</span><br><span class="line">/usr/<span class="built_in">local</span>/redis-cluster-test/7004</span><br><span class="line">/usr/<span class="built_in">local</span>/redis-cluster-test/7005</span><br><span class="line">5 S root      14845      1  0  80   0 - 35257 ep_pol 18:59 ?        00:00:00 ../redis-3.2.13/bin/redis-server *:7000 [cluster]</span><br><span class="line">5 S root      14849      1  0  80   0 - 35257 ep_pol 18:59 ?        00:00:00 ../redis-3.2.13/bin/redis-server *:7001 [cluster]</span><br><span class="line">5 S root      14853      1  0  80   0 - 35257 ep_pol 18:59 ?        00:00:00 ../redis-3.2.13/bin/redis-server *:7002 [cluster]</span><br><span class="line">5 S root      14857      1  0  80   0 - 35257 ep_pol 18:59 ?        00:00:00 ../redis-3.2.13/bin/redis-server *:7003 [cluster]</span><br><span class="line">5 S root      14861      1  0  80   0 - 35257 ep_pol 18:59 ?        00:00:00 ../redis-3.2.13/bin/redis-server *:7004 [cluster]</span><br><span class="line">5 S root      14865      1  0  80   0 - 35257 ep_pol 18:59 ?        00:00:00 ../redis-3.2.13/bin/redis-server *:7005 [cluster]</span><br><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># ./redis-3.2.13/bin/redis-trib.rb create --replicas 1 192.168.91.146:7000 192.168.91.146:7001 192.168.91.146:7002 192.168.91.146:7003 192.168.91.146:7004 192.168.91.146:7005</span></span><br><span class="line">&gt;&gt;&gt; Creating cluster</span><br><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Using 3 masters:</span><br><span class="line">192.168.91.146:7000</span><br><span class="line">192.168.91.146:7001</span><br><span class="line">192.168.91.146:7002</span><br><span class="line">Adding replica 192.168.91.146:7003 to 192.168.91.146:7000</span><br><span class="line">Adding replica 192.168.91.146:7004 to 192.168.91.146:7001</span><br><span class="line">Adding replica 192.168.91.146:7005 to 192.168.91.146:7002</span><br><span class="line">M: 50925d802a5f1be70521fafea196e8b112c122ca 192.168.91.146:7000</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">M: c4a38513a633aab450a3d491c30ec6b305b7abef 192.168.91.146:7001</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">M: 963dd0cac7581f29464624cb0df8a678cdfc54cd 192.168.91.146:7002</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">S: 6f3aa71e0d754d54738d746bd617d31adabd0d3f 192.168.91.146:7003</span><br><span class="line">   replicates 50925d802a5f1be70521fafea196e8b112c122ca</span><br><span class="line">S: 60cd05e9ed0350bd271fabacf00483bc9a34c2da 192.168.91.146:7004</span><br><span class="line">   replicates c4a38513a633aab450a3d491c30ec6b305b7abef</span><br><span class="line">S: 2755ff19dcb8d00967e66f7d19bf95603fa352dc 192.168.91.146:7005</span><br><span class="line">   replicates 963dd0cac7581f29464624cb0df8a678cdfc54cd</span><br><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">'yes'</span> to accept): yes</span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting <span class="keyword">for</span> the cluster to join...</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 192.168.91.146:7000)</span><br><span class="line">M: 50925d802a5f1be70521fafea196e8b112c122ca 192.168.91.146:7000</span><br><span class="line">   slots:0-5460 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 963dd0cac7581f29464624cb0df8a678cdfc54cd 192.168.91.146:7002</span><br><span class="line">   slots:10923-16383 (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 2755ff19dcb8d00967e66f7d19bf95603fa352dc 192.168.91.146:7005</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 963dd0cac7581f29464624cb0df8a678cdfc54cd</span><br><span class="line">M: c4a38513a633aab450a3d491c30ec6b305b7abef 192.168.91.146:7001</span><br><span class="line">   slots:5461-10922 (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 6f3aa71e0d754d54738d746bd617d31adabd0d3f 192.168.91.146:7003</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 50925d802a5f1be70521fafea196e8b112c122ca</span><br><span class="line">S: 60cd05e9ed0350bd271fabacf00483bc9a34c2da 192.168.91.146:7004</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates c4a38513a633aab450a3d491c30ec6b305b7abef</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure><h4 id="查看集群信息"><a href="#查看集群信息" class="headerlink" title="查看集群信息"></a>查看集群信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># ./redis-3.2.13/bin/redis-cli -c -p 7000</span></span><br><span class="line">127.0.0.1:7000&gt; CLUSTER NODES</span><br><span class="line">963dd0cac7581f29464624cb0df8a678cdfc54cd 192.168.91.146:7002 master - 0 1564657233357 3 connected 10923-16383</span><br><span class="line">2755ff19dcb8d00967e66f7d19bf95603fa352dc 192.168.91.146:7005 slave 963dd0cac7581f29464624cb0df8a678cdfc54cd 0 1564657233862 6 connected</span><br><span class="line">50925d802a5f1be70521fafea196e8b112c122ca 192.168.91.146:7000 myself,master - 0 0 1 connected 0-5460</span><br><span class="line">c4a38513a633aab450a3d491c30ec6b305b7abef 192.168.91.146:7001 master - 0 1564657234365 2 connected 5461-10922</span><br><span class="line">6f3aa71e0d754d54738d746bd617d31adabd0d3f 192.168.91.146:7003 slave 50925d802a5f1be70521fafea196e8b112c122ca 0 1564657235373 4 connected</span><br><span class="line">60cd05e9ed0350bd271fabacf00483bc9a34c2da 192.168.91.146:7004 slave c4a38513a633aab450a3d491c30ec6b305b7abef 0 1564657234868 5 connected</span><br><span class="line">127.0.0.1:7000&gt; CLUSTER INFO</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_sent:207</span><br><span class="line">cluster_stats_messages_received:207</span><br></pre></td></tr></table></figure><h4 id="集群数据操作"><a href="#集群数据操作" class="headerlink" title="集群数据操作"></a>集群数据操作</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># ./redis-3.2.13/bin/redis-cli -c -p 7000</span></span><br><span class="line">127.0.0.1:7000&gt; <span class="built_in">set</span> foo bar</span><br><span class="line">-&gt; Redirected to slot [12182] located at 192.168.91.146:7002</span><br><span class="line">OK</span><br><span class="line">192.168.91.146:7002&gt; <span class="built_in">set</span> hello world</span><br><span class="line">-&gt; Redirected to slot [866] located at 192.168.91.146:7000</span><br><span class="line">OK</span><br><span class="line">192.168.91.146:7000&gt; <span class="built_in">set</span> name sunwukong</span><br><span class="line">-&gt; Redirected to slot [5798] located at 192.168.91.146:7001</span><br><span class="line">OK</span><br><span class="line">192.168.91.146:7001&gt; get foo</span><br><span class="line">-&gt; Redirected to slot [12182] located at 192.168.91.146:7002</span><br><span class="line"><span class="string">"bar"</span></span><br><span class="line">192.168.91.146:7002&gt; get hello</span><br><span class="line">-&gt; Redirected to slot [866] located at 192.168.91.146:7000</span><br><span class="line"><span class="string">"world"</span></span><br><span class="line">192.168.91.146:7000&gt; get name</span><br><span class="line">-&gt; Redirected to slot [5798] located at 192.168.91.146:7001</span><br><span class="line"><span class="string">"sunwukong"</span></span><br><span class="line">192.168.91.146:7001&gt; </span><br><span class="line"><span class="comment"># 从节点默认不能写入</span></span><br><span class="line">[root@pseudo-cluster redis-cluster-test]<span class="comment"># ./redis-3.2.13/bin/redis-cli -c -p 7004</span></span><br><span class="line">127.0.0.1:7004&gt; <span class="built_in">set</span> key001 value001</span><br><span class="line">-&gt; Redirected to slot [12657] located at 192.168.91.146:7002</span><br><span class="line">OK</span><br><span class="line">192.168.91.146:7002&gt; get key001</span><br><span class="line"><span class="string">"value001"</span></span><br><span class="line">192.168.91.146:7002&gt;</span><br></pre></td></tr></table></figure><p>参考：<br><a href="https://github.com/wyt/redis-cluster-test" target="_blank" rel="noopener">redis-cluster-test</a>，wyt<br><a href="http://www.redis.cn/topics/cluster-tutorial.html" target="_blank" rel="noopener">cluster-tutorial</a>，redis.cn</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;单台机器搭建一个伪Redis集群，用于测试学习。redis-3.2.13可以使用redis源码自行编译&lt;code&gt;make prifix=/tmp/redis&lt;/code&gt;。&lt;/p&gt;
&lt;h4 id=&quot;下载redis-cluster-test项目&quot;&gt;&lt;a href=&quot;#下载redis-cluster-test项目&quot; class=&quot;headerlink&quot; title=&quot;下载redis-cluster-test项目&quot;&gt;&lt;/a&gt;下载redis-cluster-test项目&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster &lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;# pwd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster &lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;# git clone https://github.com/wyt/redis-cluster-test.git&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster bin]&lt;span class=&quot;comment&quot;&gt;# pwd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/redis-cluster-test/redis-3.2.13/bin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster bin]&lt;span class=&quot;comment&quot;&gt;# chmod +x ./*&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster redis-cluster-test]&lt;span class=&quot;comment&quot;&gt;# pwd&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/usr/&lt;span class=&quot;built_in&quot;&gt;local&lt;/span&gt;/redis-cluster-test&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster redis-cluster-test]&lt;span class=&quot;comment&quot;&gt;# chmod +x shutdown.sh startup.sh&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;安装ruby环境等&quot;&gt;&lt;a href=&quot;#安装ruby环境等&quot; class=&quot;headerlink&quot; title=&quot;安装ruby环境等&quot;&gt;&lt;/a&gt;安装ruby环境等&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 安装ruby环境&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster redis-cluster-test] yum install centos-release-scl-rh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster redis-cluster-test] yum install rh-ruby23 -y&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 当前session生效&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster redis-cluster-test] scl &lt;span class=&quot;built_in&quot;&gt;enable&lt;/span&gt; rh-ruby23 bash&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster redis-cluster-test]&lt;span class=&quot;comment&quot;&gt;# ruby -v&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ruby 2.3.8p459 (2018-10-18 revision 65136) [x86_64-linux]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@pseudo-cluster redis-cluster-test]&lt;span class=&quot;comment&quot;&gt;# gem install redis&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Fetching: redis-4.1.2.gem (100%)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Successfully installed redis-4.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Parsing documentation &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; redis-4.1.2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Installing ri documentation &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; redis-4.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="缓存" scheme="http://yoursite.com/categories/%E7%BC%93%E5%AD%98/"/>
    
      <category term="Redis" scheme="http://yoursite.com/categories/%E7%BC%93%E5%AD%98/Redis/"/>
    
    
      <category term="缓存" scheme="http://yoursite.com/tags/%E7%BC%93%E5%AD%98/"/>
    
      <category term="Redis" scheme="http://yoursite.com/tags/Redis/"/>
    
      <category term="Cluster" scheme="http://yoursite.com/tags/Cluster/"/>
    
  </entry>
  
  <entry>
    <title>CAP定理</title>
    <link href="http://yoursite.com/2019/07/24/CAP%E5%AE%9A%E7%90%86/"/>
    <id>http://yoursite.com/2019/07/24/CAP定理/</id>
    <published>2019-07-24T00:01:45.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<h4 id="基本内容"><a href="#基本内容" class="headerlink" title="基本内容"></a>基本内容</h4><ul><li><p>Consistency: all nodes see the same data at the same time. 即所有的节点在同一时刻读到同样的数据。</p></li><li><p>Availability: a guarantee that every request receives a response about whether it was successful or failed. 请求无论成功还是失败，都能收到一个响应。</p></li><li><p>Partition-Tolerance: the system continues to operate despite arbitrary message loss or failure of part of the system. 系统仍能运行尽管部分节点出问题或者丢失消息</p></li></ul><h4 id="CAP选择"><a href="#CAP选择" class="headerlink" title="CAP选择"></a>CAP选择</h4><p>分布式系统中不能同时满足C、A、P</p><ul><li><p>CA，加强一致性&amp;可用性，放弃分区容忍性，例如传统单机数据库;</p></li><li><p>AP，加强可用性&amp;分区容忍性，放弃强一致性，例如大多数NoSQL系统;</p></li><li><p>CP，加强一致性&amp;分区容忍性，可用性比较差，例如Zookeeper; </p><p>如果ZooKeeper集群中出现了网络分割的故障（注：由于交换机故障导致交换机底下的子网间不能互访）；那么ZooKeeper会将它们都从自己管理范围中剔除出去，外界就不能访问到这些节点了，即便这些节点本身是“健康”的，可以正常提供服务的；所以导致到达这些节点的请求被丢失了。</p></li></ul><h4 id="BASE理论"><a href="#BASE理论" class="headerlink" title="BASE理论"></a>BASE理论</h4><p>在分布式系统中，一般选择加强可用性和分区容忍性而牺牲一致性。</p><ul><li><p>Basically Available：基本可用，允许分区失败；</p></li><li><p>Soft state：软状态，接受一段时间的状态不同步；</p></li><li><p>Eventually consistent：最终一致，保证最终的数据状态是一致的。</p><p>在没有发生故障的前提下，数据达到一致状态的时间延迟，取决于网络延迟，系统负载和数据复制方案设计等因素。</p></li></ul><p>More info: <a href="https://www.cnblogs.com/jeffwongishandsome/p/talk-about-arch-design-and-load-balance-and-hign-availability-in-system-architecture.html" target="_blank" rel="noopener">系统架构设计理论与原则、负载均衡及高可用系统设计速记</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;基本内容&quot;&gt;&lt;a href=&quot;#基本内容&quot; class=&quot;headerlink&quot; title=&quot;基本内容&quot;&gt;&lt;/a&gt;基本内容&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Consistency: all nodes see the same data at the same 
      
    
    </summary>
    
      <category term="分布式" scheme="http://yoursite.com/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
      <category term="CAP" scheme="http://yoursite.com/tags/CAP/"/>
    
  </entry>
  
  <entry>
    <title>Ansible Playbook安装docker</title>
    <link href="http://yoursite.com/2019/07/11/Ansible%20Playbook%E7%A4%BA%E4%BE%8B/"/>
    <id>http://yoursite.com/2019/07/11/Ansible Playbook示例/</id>
    <published>2019-07-11T13:32:18.000Z</published>
    <updated>2022-04-07T02:47:38.271Z</updated>
    
    <content type="html"><![CDATA[<p>展示一个安装docker示例，Ansible playbook内容如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: all</span><br><span class="line">  tasks:</span><br><span class="line">  - name: Remove docker</span><br><span class="line">    yum:</span><br><span class="line">      name: [<span class="string">'docker'</span>, <span class="string">'docker-client'</span>, <span class="string">'docker-client-latest'</span>, <span class="string">'docker-common'</span>, <span class="string">'docker-latest'</span>, <span class="string">'docker-latest-logrotate'</span>, <span class="string">'docker-logrotate'</span>, <span class="string">'docker-selinux'</span>, <span class="string">'docker-engine-selinux'</span>]</span><br><span class="line">      state: removed</span><br><span class="line">  - name: Install yum utils</span><br><span class="line">    yum:</span><br><span class="line">      name: [<span class="string">'yum-utils'</span>, <span class="string">'device-mapper-persistent-data'</span>, <span class="string">'lvm2'</span>]</span><br><span class="line">      state: installed</span><br><span class="line">  - name: <span class="built_in">Set</span> aliyun repo</span><br><span class="line">    shell: yum-config-manager --add-repo http:<span class="comment">//mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo;yum makecache fast</span></span><br><span class="line">  - name: Install docker-ce</span><br><span class="line">    yum: name=docker-ce state=installed</span><br><span class="line">  - name: Registry mirrors</span><br><span class="line">    script: ./registry_mirrors.sh</span><br><span class="line">  - name: After registry mirrors</span><br><span class="line">    shell: systemctl daemon-reload;systemctl restart docker;systemctl enable docker</span><br><span class="line">  - name: Show docker version</span><br><span class="line">    command: docker -v</span><br><span class="line">    register: result</span><br><span class="line">  - name: Debug info</span><br><span class="line">    debug: msg=<span class="string">'&#123;&#123;result.stdout_lines&#125;&#125;'</span></span><br></pre></td></tr></table></figure><p>registry_mirrors.sh脚本内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">mkdir -p /etc/docker</span><br><span class="line">tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://kc0hk0ee.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook install_docker.yml</span><br></pre></td></tr></table></figure><p>More info: <a href="https://yongtao.wang/2018/10/25/Docker%20install/" target="_blank" rel="noopener">Docker install</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;展示一个安装docker示例，Ansible playbook内容如下：&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/sp
      
    
    </summary>
    
      <category term="ansible" scheme="http://yoursite.com/categories/ansible/"/>
    
    
      <category term="ansible" scheme="http://yoursite.com/tags/ansible/"/>
    
      <category term="playbook" scheme="http://yoursite.com/tags/playbook/"/>
    
  </entry>
  
  <entry>
    <title>Linux下ssh公钥认证</title>
    <link href="http://yoursite.com/2019/07/01/Linux%E4%B8%8Bssh%E5%85%AC%E9%92%A5%E8%AE%A4%E8%AF%81/"/>
    <id>http://yoursite.com/2019/07/01/Linux下ssh公钥认证/</id>
    <published>2019-07-01T19:15:33.000Z</published>
    <updated>2019-07-01T19:15:37.000Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th style="text-align:center">编号</th><th style="text-align:center">机器名</th><th style="text-align:center">IP</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">ansible-manager</td><td style="text-align:center">192.168.91.140</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">cluster_001</td><td style="text-align:center">192.168.91.141</td></tr><tr><td style="text-align:center">…</td><td style="text-align:center">…</td><td style="text-align:center">…</td></tr></tbody></table><h4 id="创建密钥对"><a href="#创建密钥对" class="headerlink" title="创建密钥对"></a>创建密钥对</h4><p>在ansible-manager上执行ssh-keygen命令，一路回车。</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible-manager .ssh]<span class="comment"># ssh-keygen</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:PQtPisFEFbco9jI1loIXyK7y/xr9n6vp562aQ/OkJJs root@ansible-manager</span><br><span class="line">The key<span class="string">'s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|   . .o.o..      |</span></span><br><span class="line"><span class="string">|    oo . + .     |</span></span><br><span class="line"><span class="string">|   .. * * .      |</span></span><br><span class="line"><span class="string">|    .= * o       |</span></span><br><span class="line"><span class="string">|   .  = S +      |</span></span><br><span class="line"><span class="string">|. .  ..=+=.o     |</span></span><br><span class="line"><span class="string">| o  . o*.=o      |</span></span><br><span class="line"><span class="string">|  .  .E.oooo     |</span></span><br><span class="line"><span class="string">|   .oo..BB*o.    |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 生成密钥对id_rsa &amp; id_rsa.pub，其中id_rsa.pub是公钥。</span></span><br><span class="line"><span class="string">[root@ansible-manager .ssh]# ls -lh</span></span><br><span class="line"><span class="string">total 8.0K</span></span><br><span class="line"><span class="string">-rw-------. 1 root root 1.7K Jul  2 03:25 id_rsa</span></span><br><span class="line"><span class="string">-rw-r--r--. 1 root root  402 Jul  2 03:25 id_rsa.pub</span></span><br><span class="line"><span class="string">-rw-r--r--. 1 root root    0 Jul  2 03:24 known_hosts</span></span><br></pre></td></tr></table></figure><h4 id="发送公钥"><a href="#发送公钥" class="headerlink" title="发送公钥"></a>发送公钥</h4><p>将ansible-manager公钥发送给cluster_001，第一次发送公钥的时候，需要输入密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible-manager .ssh]<span class="comment"># ssh-copy-id -i ./id_rsa.pub "root@192.168.91.141"</span></span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: <span class="string">"./id_rsa.pub"</span></span><br><span class="line">The authenticity of host <span class="string">'192.168.91.141 (192.168.91.141)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:HcrnywII1gZEW3uk2muw+V+JyD0tbedR8hbdvWNrFMM.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is MD5:55:76:c1:5a:f5:ec:f6:3d:74:e7:d3:ec:ab:49:80:4d.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span></span><br><span class="line"><span class="string">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span></span><br><span class="line"><span class="string">root@192.168.91.141'</span>s password: </span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   <span class="string">"ssh 'root@192.168.91.141'"</span></span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>检查被管理机器cluster_001<code>/root/.ssh/authorized_keys</code>中，写入了ansible-manager 公钥内容。ansible-manager使用ssh连接cluster_001:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ansible-manager .ssh]<span class="comment"># ssh 192.168.91.141</span></span><br><span class="line">Last login: Tue Jul  2 03:39:14 2019 from 192.168.91.140</span><br><span class="line">[root@cluster_001 ~]<span class="comment"># hostname</span></span><br><span class="line">cluster_001</span><br></pre></td></tr></table></figure><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol><li>管理机上创建ssh密钥对；</li><li>将管理机公钥分发给被管理机；</li><li>实现互免认证，可在另一台机器上执行上述流程。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;编号&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;机器名&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;IP&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;1&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;ansible-manager&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;192.168.91.140&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;cluster_001&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;192.168.91.141&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;…&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;…&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&quot;创建密钥对&quot;&gt;&lt;a href=&quot;#创建密钥对&quot; class=&quot;headerlink&quot; title=&quot;创建密钥对&quot;&gt;&lt;/a&gt;创建密钥对&lt;/h4&gt;&lt;p&gt;在ansible-manager上执行ssh-keygen命令，一路回车。&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="http://yoursite.com/categories/linux/"/>
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="ssh" scheme="http://yoursite.com/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>生产环境下的Elasticsearch参数调整</title>
    <link href="http://yoursite.com/2019/06/28/%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84Elasticsearch%E5%8F%82%E6%95%B0%E8%B0%83%E6%95%B4/"/>
    <id>http://yoursite.com/2019/06/28/生产环境下的Elasticsearch参数调整/</id>
    <published>2019-06-28T09:37:00.000Z</published>
    <updated>2019-06-28T09:37:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>开启<code>config/elasticsearch.yml</code>中<code>network.host</code>配置后，ES启动时会切换为生产模式，开发模式下的警告会升级为异常，导致ES节点无法启动。</p><h4 id="禁止swapping"><a href="#禁止swapping" class="headerlink" title="禁止swapping"></a>禁止swapping</h4><p>设置Elasticsearch可锁定的、不被交换出的内存不受限制。编辑<code>config/elasticsearch.yml</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置为true</span></span><br><span class="line">bootstrap.memory_lock: <span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p>编辑<code>/etc/security/limits.conf</code>文件，追加下述配置：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># elasticsearch用户锁定内存(不会被swap)不受限制</span></span><br><span class="line">elasticsearch  -  memlock unlimited</span><br></pre></td></tr></table></figure></p><a id="more"></a><h4 id="增大文件描述符"><a href="#增大文件描述符" class="headerlink" title="增大文件描述符"></a>增大文件描述符</h4><p>编辑<code>/etc/security/limits.conf</code>文件，追加下述配置：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># elasticsearch用户最多打开文件描述符的数量</span></span><br><span class="line">elasticsearch  -  nofile  65536</span><br></pre></td></tr></table></figure></p><h4 id="保证足够的线程数"><a href="#保证足够的线程数" class="headerlink" title="保证足够的线程数"></a>保证足够的线程数</h4><p>编辑<code>/etc/security/limits.conf</code>文件，追加下述配置：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置elasticsearch用户最多创建线程数</span></span><br><span class="line">elasticsearch  -  nproc 4096</span><br></pre></td></tr></table></figure></p><h4 id="保证足够的虚拟内存"><a href="#保证足够的虚拟内存" class="headerlink" title="保证足够的虚拟内存"></a>保证足够的虚拟内存</h4><p>编辑<code>/etc/sysctl.conf</code>文件，追加下述配置：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count=262144</span><br></pre></td></tr></table></figure></p><h4 id="使设置生效"><a href="#使设置生效" class="headerlink" title="使设置生效"></a>使设置生效</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载系统配置参数</span></span><br><span class="line">[root@elasticstack-server filebeat-6.6.2-nginx]<span class="comment"># sysctl -p</span></span><br><span class="line">[root@elasticstack-server filebeat-6.6.2-nginx]<span class="comment"># sysctl vm.max_map_count</span></span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到elasticsearch用户使ulimit设置生效</span></span><br><span class="line">[root@elasticstack-server filebeat-6.6.2-nginx]<span class="comment"># su elasticsearch</span></span><br><span class="line">[elasticsearch@elasticstack-server elasticsearch-6.6.2]$ <span class="built_in">ulimit</span> -a</span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 31140</span><br><span class="line">max locked memory       (kbytes, -l) unlimited</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 65536</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 4096</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Elasticsearch</span></span><br><span class="line">[elasticsearch@elasticstack-server elasticsearch-6.6.2]$ ./bin/elasticsearch -d -p pid</span><br></pre></td></tr></table></figure><h4 id="检查设置"><a href="#检查设置" class="headerlink" title="检查设置"></a>检查设置</h4><p>Elasticsearch启动成功后，检查设置项：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置成功</span></span><br><span class="line">[root@elasticstack-server ~]<span class="comment"># curl -X GET "localhost:9200/_nodes?filter_path=**.mlockall"</span></span><br><span class="line">&#123;<span class="string">"nodes"</span>:&#123;<span class="string">"yW_SUaDnS6WED2QPm5y4TA"</span>:&#123;<span class="string">"process"</span>:&#123;<span class="string">"mlockall"</span>:<span class="literal">true</span>&#125;&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">[root@elasticstack-server ~]<span class="comment"># curl -X GET "localhost:9200/_nodes/stats/process?filter_path=**.max_file_descriptors"</span></span><br><span class="line">&#123;<span class="string">"nodes"</span>:&#123;<span class="string">"yW_SUaDnS6WED2QPm5y4TA"</span>:&#123;<span class="string">"process"</span>:&#123;<span class="string">"max_file_descriptors"</span>:65536&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/system-config.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.2/system-config.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;开启&lt;code&gt;config/elasticsearch.yml&lt;/code&gt;中&lt;code&gt;network.host&lt;/code&gt;配置后，ES启动时会切换为生产模式，开发模式下的警告会升级为异常，导致ES节点无法启动。&lt;/p&gt;
&lt;h4 id=&quot;禁止swapping&quot;&gt;&lt;a href=&quot;#禁止swapping&quot; class=&quot;headerlink&quot; title=&quot;禁止swapping&quot;&gt;&lt;/a&gt;禁止swapping&lt;/h4&gt;&lt;p&gt;设置Elasticsearch可锁定的、不被交换出的内存不受限制。编辑&lt;code&gt;config/elasticsearch.yml&lt;/code&gt;&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 设置为true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bootstrap.memory_lock: &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;编辑&lt;code&gt;/etc/security/limits.conf&lt;/code&gt;文件，追加下述配置：&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# elasticsearch用户锁定内存(不会被swap)不受限制&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;elasticsearch  -  memlock unlimited&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="elasticsearch" scheme="http://yoursite.com/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://yoursite.com/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Docker swarm删除节点</title>
    <link href="http://yoursite.com/2019/05/15/Docker%20swarm%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9/"/>
    <id>http://yoursite.com/2019/05/15/Docker swarm删除节点/</id>
    <published>2019-05-15T11:31:49.000Z</published>
    <updated>2019-05-15T11:31:54.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Docker-swarm删除节点"><a href="#Docker-swarm删除节点" class="headerlink" title="Docker swarm删除节点"></a>Docker swarm删除节点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在管理节点上先排空节点</span></span><br><span class="line">docker node update --availability drain yyxh5zbei71kq7c5tadoq19ri</span><br><span class="line"><span class="comment"># 移除节点</span></span><br><span class="line">docker node rm yyxh5zbei71kq7c5tadoq19ri</span><br><span class="line"><span class="comment"># 或者强制删除</span></span><br><span class="line">docker node rm --force yyxh5zbei71kq7c5tadoq19ri</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在所要删除的节点上执行</span></span><br><span class="line">docker swarm leave</span><br><span class="line"><span class="comment"># 或强制离开</span></span><br><span class="line">docker swarm leave --force</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Docker-swarm删除节点&quot;&gt;&lt;a href=&quot;#Docker-swarm删除节点&quot; class=&quot;headerlink&quot; title=&quot;Docker swarm删除节点&quot;&gt;&lt;/a&gt;Docker swarm删除节点&lt;/h3&gt;&lt;figure class=&quot;hi
      
    
    </summary>
    
      <category term="docker" scheme="http://yoursite.com/categories/docker/"/>
    
    
      <category term="docker" scheme="http://yoursite.com/tags/docker/"/>
    
  </entry>
  
</feed>
